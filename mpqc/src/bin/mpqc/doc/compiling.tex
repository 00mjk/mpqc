
\chapter{Compiling MPQC}
\index{compiling}
\index{installing}


These instructions are for a machine running unix or a clone. The codes
work under Linux, IRIX (4.0.5F, 5.3, 6.0.1), and AIX, at least.  The code
can also be built under MS Windows NT using the Cygnus development tools.

\section{Prerequisites}
 Make sure that you have the following programs available. Most can be
found at any GNU software ftp repository.
  \begin{itemize}
    \item Compilers for the C and C++ languages are needed.
          There are special considerations for non
          GNU compilers. I currently use GNU gcc 2.7.2.f.1 on Linux Redhat 4.0
          with a recent kernel and a few other updates. I also use
          xlC on an SP2 routinely. Some compilers that work include:
      \begin{itemize}
        \item  gcc 2.7.2 (this should compile SC on any Unix-like platform)
        \item  a recent (3.1.3 works) xlC (IBM)
        \item  CC -64 and CC -32 from IRIX IDO 6.0.1 (SGI)
      \end{itemize}
    \item GNU libg++: Mainly genclass and the prototype classes are needed.
          It isn't necessary to link with libg++.
    \item GNU flex (version 2.5.2 or greater): This is a lexical analyzer
          generator used to generate code to read input files. Make sure that
          FlexLexer.h from flex is in your include path. You may need to
          give that path to configure with an argument that looks something
          like: \type{--with-include=-I/usr/local/include}
    \item GNU bison (version 1.24 or greater): This is a parser generator used
          to generate code to read input files.
    \item GNU gmake (version 3.70 or greater): GNU specific extensions to make
          are used extensively.
    \item perl (5.003 works, maybe older versions work too): This is used to
          convert template classes to macros, generate documentation, etc.
  \end{itemize}

\section{Configuration}

 You can optionally make a sister directory to \filnm{SC} which will be
used to hold all of the files generated by the compilation.  This directory
is usually named to indicate the architecture (e.g. \filnm{SC.i686-linux})
and will be referred to as the target directory below.

 In the target directory execute the "configure" command which is located
in the SC source directory. This command should build a hierarchy of
target directories and the necessary makefiles. Do a \type{configure
--help} to see a list of options.  Useful options to configure
include:

\begin{description}
\item[\type{--enable-debug}] Options for debugging will be given to
the compiler.
\item[\type{--disable-parallel}] Do not try to find communications
libraries.
\item[\type{--enable-ref-debug}] Check for overwrites and overflows
for reference counts.  Implied by ``--enable-debug''.
\item[\type{--disable-ref-macros}] Use template classes for reference
counting.  This doesn't work with any known compiler.  The default is to
use a CPP macro to generate a class definition.
\item[\type{--enable-cross-compile}] If this option is set then the
configure script will take care to not execute any compiled test programs.
\item[\type{--enable-shared-libs}] This will generate shared objects and
link with them instead of standard ``.a'' libraries.  This works on a
Linux-ELF system.
\item[\type{--with-cc}] Gives the name of the C compiler.
\item[\type{--with-cxx}] Gives the name of the C++ compiler.
\item[\type{--with-ranlib}] Gives the name of the archive indexing utility.
\item[\type{--with-ar}] Gives the name of the program than makes libraries.
\item[\type{--with-ld}] Gives the name of the object linker.
\item[\type{--with-include}] Gives directories in which include files
should be sought.  For example, \type{--with-include=-I/u/local/inc -I/u/cljanss/include}
\item[\type{--with-libs}] Specifies libraries that executables should be
linked with.
\item[\type{--with-libdirs}] Gives the directories in which libraries
should be sought.
\end{description}

  If you would like to further customize your target directory,
you can edit \filnm{src/lib/config.h} and \filnm{lib/LocalMakefile} to
suit your needs.

\section{Compiling the Utility Program}

 There is one utility program that determines what libraries an executable
needs.  There are two versions, a shell script, \exenm{listlibs.sh} and a
C++ program \exenm{listlibs}.  If the configure script does not find
\exenm{listlibs} in your path it will automatically use
\exenm{listlibs.sh}, so it is not necessary to compile \exenm{listlibs}.
However, \exenm{listlibs.sh} is wretchedly slow so if you can compile
\exenm{listlibs} you ought to.  The C++ \exenm{listlibs} uses the C++
Standard Template Library and, thus, might not compile with your compiler.
It will compile with GNU gcc 2.7.2, however.  To compile \exenm{listlibs},
change directory to the \filnm{src/tools/listlibs} subdirectory of your
target directory and run make.

 After you compile \exenm{listlibs} move it into your path and
rerun \exenm{configure} so it will find the new executable.  Alternately,
you can modify \filnm{lib/LocalMakefile} in your target directory.
Change the line beginning with \type{LISTLIBS=} appropiately.

\section{Compiling MPQC}

 First you need to generate several include files to satisify
cross-dependencies between libraries.  Do these by changing directory into
your target directory and type \type{make interface}.  If you get error
messages in this step do a \type{make distclean} after correcting the
problem since there might be some incorrectly generated include or source
files remaining.

 Now you are ready to build the libraries and executable.  Do this
by typing \type{make} in your target directory.  All the libraries and
a single executable, \exenm{src/bin/mpqc/mpqc}, should be built.

