
\chapter{MPQC Input}
\index{input}

MPQC is an object-oriented program that directly allows the user to specify
objects that MPQC then manipulates to obtain energies, properties, etc.
Thus, the input may seem a bit complex to the beginner; however, most
calculations should be quite similar to the one of the examples given later
in this chapter.  The best way to get started is to use one of the example
input files and modify it to meet your needs.

MPQC starts off by creating a
\hyperref{\clsnm{ParsedKeyVal}}
         {\clsnm{ParsedKeyVal} (see Section~}
         {)}
         {ParsedKeyVal}
object that parses the input file specified on the command line.
It is the \clsnm{ParsedKeyVal} object that dictates the format
of the input file.  It is basically a free format input that
associates keywords and logical groupings of keywords with
values.  The values can be scalars, arrays, or objects.

The keywords recognized by MPQC begin with the \keywd{mpqc} prefix.
That is, they must be nested between an \keywd{mpqc:(} and a \keywd{)}.
Alternately, each keyword can be individually prefixed by \keywd{mpqc:}.
If they are not found with the \keywd{mpqc} prefix, the prefix
\keywd{default} will also be considered.  The primary keywords are given
below.  Some of the keywords specify \htmlref{objects}{pkvobject}, in which
case the object will require more \clsnmref{KeyVal} input.  These objects
are created from the input by using their \clsnmref{KeyVal} constructors,
which are documented in
\begin{latexonly}
Chapters~\ref{firstclasschapt} through~\ref{lastclasschapt}.
\end{latexonly}
\begin{htmlonly}
several chapters that follow.
\end{htmlonly}

\begin{description}
\item[\keywd{mole}] This is the most important keyword for \exenm{mpqc}.
        It specifies the \clsnmref{MolecularEnergy}
        \htmlref{object}{pkvobject}.  This is an object that knows how to
        compute the energy of a molecule.  The specializations of
        \clsnmref{MolecularEnergy} that are most commonly used here are
        \clsnmref{CLSCF}, \clsnmref{HSOSSCF}, and \clsnmref{MBPT2}.
\item[\keywd{opt}] This keyword must be specified for optimizations.  It
        specifies an \clsnmref{Optimize} \htmlref{object}{pkvobject}.
        Usually, \clsnmref{QNewtonOpt} is best for finding minima and
        \clsnmref{EFCOpt} is best for transition states.
\item[\keywd{freq}] This keyword must be specified to compute frequencies.
        It specifies an \clsnmref{MolecularFrequencies}
        \htmlref{object}{pkvobject}.
\item[\keywd{thread}] This specifies an \htmlref{object}{pkvobject} of type
        \clsnmref{ThreadGrp} that can be used to advantage on shared-memory
        multiprocessor machines for certain types of calculations.  This
        keyword can be overridden by giving the \clsnmref{ThreadGrp} in the
        environment or command line.  See
        \hyperref{the section on running MPQC}{Section~}{}{running MPQC}
        for more information.
        This feature is not fully implemented in the current release.
\item[\keywd{checkpoint}] The value of this keyword is boolean.  If true,
        then optimizations will be checkpointed after each iteraction.  The
        default is to checkpoint.
\item[\keywd{savestate}] The value of this keyword is boolean.  If true,
        then the states of the optimizer and wavefunction objects will be
        saved after the calculation completes.  The default is to save
        state.
\item[\keywd{restart}] The value of this keyword is boolean.  If true
        \exenm{mpqc} will attempt to restart the calculation.  If the
        checkpoint file is not found, the calculation will continue as if
        the value were false. The default is true.
\item[\keywd{restart\_file}] This gives the name of a file from which
        restart information is read.  If the file name ends in
        \filnm{.wfn} the \keywd{mole} object will be restored.  Otherwise,
        the \keywd{opt} object will be restored.  The default file name
        is formed by appending \filnm{.ckpt} to the input file name
        with the extension removed.
\item[\keywd{do\_energy}] The value of this keyword is boolean.  If
        true a single point energy calculation will be done for the
        \clsnmref{MolecularEnergy} object given with the \keywd{mole}
        keyword.  The default is true.
\item[\keywd{do\_gradient}] The value of this keyword is boolean.  If
        true a single point gradient calculation will be done for the
        \clsnmref{MolecularEnergy} object given with the \keywd{mole}
        keyword.  The default is false.
\item[\keywd{optimize}] The value of this keyword is boolean.  If
        true and the \keywd{opt} keyword was set to a valid value,
        then an optimization will be performed.  The default is true.
\item[\keywd{write\_pdb}] The value of this keyword is boolean.  If
        true a PDB file with the molecular coordinates will be written.
\item[\keywd{filename}] The value of this keyword is a string that
        gives a name from which checkpoint and other filenames are
        constructed.  The default is the basename of the input file.
\end{description}

There also some utility keywords that tell mpqc some technical
details about how to do the calculation:
\begin{description}
\item[\keywd{debug}] This optional keyword gives a \clsnmref{Debugger}
        \htmlref{object}{pkvojbect} which can used to help find the problem
        if MPQC encounters a catastrophic error.
\item[\keywd{matrixkit}]
        This optional keyword gives a \clsnmref{SCMatrixKit} specialization
        which is used to produce matrices of the desired type.
        The default is a \clsnmref{ReplSCMatrixKit} which replicates
        matrices on all of the nodes.
\end{description}

\input{util/keyval/doc/ParsedKeyVal.doc.tex}

\section{Sample Input Files}

The easiest way to get started with \exenm{mpqc} is to start with
one of sample inputs that most nearly matches your problem.  All
of the samples inputs shown here can be found in the directory
\filnm{src/bin/mpqc/samples}.

\subsection{SCF Energy}
\index{SCF!example}
\index{examples!SCF}

The following input will compute the SCF energy of water.

\input{scf.in.tex}

\subsection{MP2 Energy}
\index{MP2!example}
\index{examples!MP2}

The following input will compute the MP2 energy of water.

\input{mp2.in.tex}

\subsection{SCF Optimization}
\index{optimization!example}
\index{examples!optimization}

The following input will optimize the geometry of water using
the quasi-newton method.

\input{scfopt.in.tex}

\subsection{SCF Frequencies}
\index{frequencies!example}
\index{examples!frequencies}

The following input will compute SCF frequencies by finite
displacements.  A thermodynamic analysis will also be
performed.  If optimization input is also provided, then the
optimization will be run first, then the frequencies.

\input{scffreq.in.tex}

\subsection{Giving Coordinates and a Guess Hessian}
\index{fixed coordinates!example}
\index{examples!fixed coordinates}
\index{guess hessian!example}
\index{examples!guess hessian}
\index{coordinates!example}
\index{examples!coordinates}

The following example shows several features that are really independent.
The variable coordinates are explicitly given, rather than generated
automatically.  This is especially useful when a guess hessian is to be
provided, as it is here.  This hessian, as given by the user, is not
complete and the \clsnmref{QNewtonOpt} object will fill in the missing
values using a guess the hessian provided by the \clsnmref{MolecularEnergy}
object.  Also, fixed coordinates are given in this sample input.

\input{mancoor.in.tex}

\subsection{Optimization with a Hydrogen Bond}
\index{hydrogen bonds!example}
\index{examples!hydrogen bonds}

The automatic internal coordinate generator will fail if it cannot find
enough redundant internal coordinates.  In this case, the internal
coordinate generator must be explicitly created in the input and given
extra connectivity information, as is shown below.

\input{hbondopt.in.tex}

\subsection{Fixed Coordinate Optimization}
\label{fixedexample}
\index{fixed coordinates!example}
\index{frozen coordinates!example}
\index{examples!fixed coordinates}

 This example shows how to selectively fix internal coordinates in an
optimization.  Any number of linearly independent coordinates can be given.
These coordinates must remain linearly independent throughout the
optimization, a condition that might not hold since the coordinates can be
nonlinear.

 By default, the initial fixed coordinates' values are taken from the
cartesian geometry given by the \clsnmref{Molecule} object; however, the
molecule will be displaced to the internal coordinate values given with the
fixed internal coordinates if \keywd{have\_fixed\_values} keyword is set to
true, as shown in this example.  In this case, the initial cartesian
geometry should be reasonably close to the desired initial geometry and all
of the variable coordinates will be frozen to their original values during
the initial displacement.

\input{fixed.in.tex}

\subsection{Transition State Optimization}
\label{tsexample}
\index{transition state!example}
\index{examples!transition state}

This example shows a transition state optimization of the N-inversion in
$\mathrm{CH}_3\mathrm{NH}_2$ using mode following.  The initial geometry
was obtained by doing a few fixed coordinate optimizations along the
inversion coordinate.

\input{ts.in.tex}
