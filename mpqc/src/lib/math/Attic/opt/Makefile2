#!/usr/local/bin/gmake
#
#
# Use the AT&T compiler
#
CC = CC -DATandT
NEWMAT = newmat7/newmat7.a 
#
# Use the gnu complier
#
#CC = /net/munin/usr/local/bin/g++ -DGNUG
#NEWMAT = gnewmat7.a /usr/local/lib/libg++.a
#
#
CFLAGS = -c -g 
NEWTOBJS = optnewton.o newton.o qnewton.o fdnewton.o
OBJS  = tstopt.o tstfcn.o nlp.o $(NEWTOBJS) optcg.o nlcg.o deriv.o
LIBS  = nlp.a $(NEWMAT) -lm

c.o:
	cc $(CFLAGS) $<
cc.o:    
	$(CC) $(CFLAGS) $(DEFINES) $<


%.o:    %.cc
	$(CC) $(CFLAGS) $(DEFINES) $<

%.d: %.c
	$(CC) -M $(CPPFLAGS) $< | sed 's/$*.o/& $@/g' > $@

tstopt.o: optxx tstopt.cc
tstvec.o: optxx tstvec.cc
tstfcn.o: optxx tstfcn.cc
nlcg.o: optxx nlcg.cc
newton.o: optxx newton.cc
qnewton.o: optxx qnewton.cc
optnewton.o: optxx optnewton.cc
optcg.o: optxx optcg.cc
search.o: optxx search.cc
nlpfcn.o: optxx nlpfcn.cc
cblas.o: optxx cblas.cc
cholesky.o: optxx cholesky.cc
mcholesky.o: optxx mcholesky.cc
print.o: optxx print.cc
newmat6.o: optxx newmat6.cc
newmat7.o: optxx newmat7.cc

optxx:  include.h newmat.h newmatap.h tstfcn.h cblas.h opt.h nlp.h
	rm -f optxx
	echo "main .h files uptodate?" > optxx

tlnsrch: $(OBJS)
	$(CC) -o tlnsrch tstsrch.o $(OBJS) $(LIBS)

tvec: tstvec.o cblas.o cholesky.o mcholesky.o
	$(CC) -o tvec tstvec.o cblas.o cholesky.o mcholesky.o $(LIBS)

tform: tstform.o cblas.o cholesky.o mcholesky.o
	$(CC) -o tform tstform.o $(LIBS)

topt: optxx $(OBJS) nlp.a 
	$(CC) $(DEFINES) -o topt $(OBJS) $(LIBS)

testit: testit.o ljeval.o
	cc -o testit testit.o ljeval.o -lm

testit.o: testit.c
	cc -c -g testit.c
ljeval.o: ljeval.c
	cc -c -g ljeval.c
linalg.o: linalg.c
	cc -c -g linalg.c

nlp.a:  search.o cblas.o linalg.o mcholesky.o print.o
	ar rcv nlp.a search.o cblas.o linalg.o mcholesky.o print.o

lint: $(SRCS)
	lint $(SRCS)

clean:
	/bin/rm *.o
