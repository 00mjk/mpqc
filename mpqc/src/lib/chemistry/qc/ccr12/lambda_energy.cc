//
// lambda_energy.cc
//
// Copyright (C) 2009 Toru Shiozaki
//
// Author: Toru Shiozaki <shiozaki@qtp.ufl.edu>
// Maintainer: TS
//
// This file is part of the SC Toolkit.
//
// The SC Toolkit is free software; you can redistribute it and/or modify
// it under the terms of the GNU Library General Public License as published by
// the Free Software Foundation; either version 2, or (at your option)
// any later version.
//
// The SC Toolkit is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU Library General Public License for more details.
//
// You should have received a copy of the GNU Library General Public License
// along with the SC Toolkit; see the file COPYING.LIB.  If not, write to
// the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
//
// The U.S. Government is granted a limited license as per AL 91-7.
//
  
// This is a C++ code generated by SMITH
  
#include <algorithm>
#include <chemistry/qc/ccr12/lambda_energy.h>
#include <chemistry/qc/ccr12/tensor.h>
using namespace sc;
  
  
LAMBDA_ENERGY::LAMBDA_ENERGY(CCR12_Info* info):z(info){};
LAMBDA_ENERGY::~LAMBDA_ENERGY(){};
  
  
  
void LAMBDA_ENERGY::compute_amp(Ref<Tensor>& out){ //k_i0_offset,z->bs2(),z->gt2(),z->f1(),z->in.at(0),z->glambda2(),z->lx(),z->ly(),z->ps2(),z->qx(),z->qy(),z->t1(),z->t2(),z->v2(),z->vd2(),z->vr2()=>z->xs2()
  
in.resize(8);
kn.resize(64);
  
kn.at(0)=new Tensor("lambda_energy_k0",z->mem());
offset_k0();
smith_k0(); //z->t2(),z->ly()=>kn.at(0)
kn.at(1)=new Tensor("lambda_energy_k1",z->mem());
offset_k1();
smith_k1(); //z->glambda2(),z->xs2()=>kn.at(1)
kn.at(2)=new Tensor("lambda_energy_k2",z->mem());
offset_k2();
smith_k2(); //z->t1(),z->ly()=>kn.at(2)
kn.at(3)=new Tensor("lambda_energy_k3",z->mem());
offset_k3();
smith_k3(); //z->qx(),z->lx()=>kn.at(3)
kn.at(4)=new Tensor("lambda_energy_k4",z->mem());
offset_k4();
smith_k4(); //z->qx(),z->ly()=>kn.at(4)
kn.at(5)=new Tensor("lambda_energy_k5",z->mem());
offset_k5();
smith_k5(); //z->qy(),z->lx()=>kn.at(5)
kn.at(6)=new Tensor("lambda_energy_k6",z->mem());
offset_k6();
smith_k6(); //z->qy(),z->ly()=>kn.at(6)
kn.at(7)=new Tensor("lambda_energy_k7",z->mem());
offset_k7();
smith_k7(); //z->qx(),z->lx()=>kn.at(7)
kn.at(8)=new Tensor("lambda_energy_k8",z->mem());
offset_k8();
smith_k8(); //z->qy(),z->ly()=>kn.at(8)
kn.at(9)=new Tensor("lambda_energy_k9",z->mem());
offset_k9();
smith_k9(); //z->qx(),z->ly()=>kn.at(9)
kn.at(10)=new Tensor("lambda_energy_k10",z->mem());
offset_k10();
smith_k10(); //z->qy(),z->lx()=>kn.at(10)
kn.at(11)=new Tensor("lambda_energy_k11",z->mem());
offset_k11();
smith_k11(); //z->qy(),z->ly()=>kn.at(11)
kn.at(12)=new Tensor("lambda_energy_k12",z->mem());
offset_k12();
smith_k12(); //z->gt2(),kn.at(1)=>kn.at(12)
kn.at(13)=new Tensor("lambda_energy_k13",z->mem());
offset_k13();
smith_k13(); //z->qy(),kn.at(2)=>kn.at(13)
kn.at(14)=new Tensor("lambda_energy_k14",z->mem());
offset_k14();
smith_k14(); //z->gt2(),kn.at(1)=>kn.at(14)
smith_0_1(out); //z->f1(),kn.at(0)=>out
smith_0_2(out); //z->f1(),kn.at(12)=>out
in.at(1)=new Tensor("lambda_energy_1_0",z->mem());
offset_smith_0_3();
in.at(2)=new Tensor("lambda_energy_2_0",z->mem());
offset_smith_1_3();
smith_1_3_0(); //z->bs2()=>in.at(2)
smith_1_3_1(); //z->ps2()=>in.at(2)
smith_1_3(); //z->glambda2(),in.at(2)=>in.at(1)
delete in.at(2);
in.at(2)=new Tensor("lambda_energy_2_1",z->mem());
offset_smith_1_46();
in.at(3)=new Tensor("lambda_energy_3_46",z->mem());
offset_smith_2_46();
smith_3_46(); //z->t2(),z->v2()=>in.at(3)
smith_2_46(); //z->glambda2(),in.at(3)=>in.at(2)
delete in.at(3);
in.at(3)=new Tensor("lambda_energy_3_47",z->mem());
offset_smith_2_47();
smith_3_47(); //z->t2(),z->v2()=>in.at(3)
smith_2_47(); //z->glambda2(),in.at(3)=>in.at(2)
delete in.at(3);
smith_1_46(); //z->xs2(),in.at(2)=>in.at(1)
delete in.at(2);
smith_1_68(); //z->vr2(),kn.at(14)=>in.at(1)
smith_1_69(); //z->vr2(),kn.at(12)=>in.at(1)
smith_0_3(out); //z->gt2(),in.at(1)=>out
delete in.at(1);
in.at(1)=new Tensor("lambda_energy_1_1",z->mem());
offset_smith_0_4();
smith_1_4(); //z->f1(),kn.at(12)=>in.at(1)
in.at(2)=new Tensor("lambda_energy_2_0",z->mem());
offset_smith_1_5();
smith_1_5_0(); //z->v2()=>in.at(2)
smith_2_5(); //z->qx(),z->f1()=>in.at(2)
in.at(3)=new Tensor("lambda_energy_3_0",z->mem());
offset_smith_2_10();
smith_2_10_0(); //z->v2()=>in.at(3)
smith_3_21(); //z->t1(),z->v2()=>in.at(3)
smith_2_10(); //z->t1(),in.at(3)=>in.at(2)
delete in.at(3);
smith_2_24(); //z->t2(),z->v2()=>in.at(2)
smith_2_32(); //z->qx(),z->v2()=>in.at(2)
smith_2_33(); //z->qy(),z->v2()=>in.at(2)
smith_2_39(); //z->gt2(),z->vr2()=>in.at(2)
smith_1_5(); //z->ly(),in.at(2)=>in.at(1)
delete in.at(2);
smith_1_9(); //z->glambda2(),z->vd2()=>in.at(1)
in.at(2)=new Tensor("lambda_energy_2_11",z->mem());
offset_smith_1_11();
smith_2_11(); //z->t1(),z->glambda2()=>in.at(2)
smith_1_11(); //z->vd2(),in.at(2)=>in.at(1)
delete in.at(2);
in.at(2)=new Tensor("lambda_energy_2_1",z->mem());
offset_smith_1_22();
smith_1_22_0(); //kn.at(0)=>in.at(2)
smith_1_22_1(); //kn.at(10)=>in.at(2)
smith_1_22(); //z->v2(),in.at(2)=>in.at(1)
delete in.at(2);
in.at(2)=new Tensor("lambda_energy_2_2",z->mem());
offset_smith_1_23();
smith_1_23_0(); //kn.at(5)=>in.at(2)
smith_2_23(); //z->t2(),z->ly()=>in.at(2)
smith_1_23(); //z->v2(),in.at(2)=>in.at(1)
delete in.at(2);
smith_1_25(); //z->v2(),kn.at(12)=>in.at(1)
smith_1_26(); //z->v2(),kn.at(14)=>in.at(1)
in.at(2)=new Tensor("lambda_energy_2_3",z->mem());
offset_smith_1_27();
smith_1_27_0(); //kn.at(7)=>in.at(2)
smith_1_27_1(); //kn.at(8)=>in.at(2)
smith_1_27(); //z->v2(),in.at(2)=>in.at(1)
delete in.at(2);
smith_1_29(); //z->v2(),kn.at(9)=>in.at(1)
smith_1_31(); //z->v2(),kn.at(11)=>in.at(1)
in.at(2)=new Tensor("lambda_energy_2_4",z->mem());
offset_smith_1_34();
smith_1_34_0(); //kn.at(3)=>in.at(2)
smith_2_35(); //z->qy(),z->ly()=>in.at(2)
smith_1_34(); //z->v2(),in.at(2)=>in.at(1)
delete in.at(2);
smith_1_36(); //z->v2(),kn.at(4)=>in.at(1)
smith_1_38(); //z->v2(),kn.at(6)=>in.at(1)
in.at(2)=new Tensor("lambda_energy_2_5",z->mem());
offset_smith_1_40();
smith_1_40_0(); //kn.at(13)=>in.at(2)
smith_2_40(); //z->t1(),kn.at(12)=>in.at(2)
smith_1_40(); //z->v2(),in.at(2)=>in.at(1)
delete in.at(2);
in.at(2)=new Tensor("lambda_energy_2_6",z->mem());
offset_smith_1_41();
smith_2_41(); //z->t1(),kn.at(14)=>in.at(2)
smith_2_45(); //z->qy(),kn.at(2)=>in.at(2)
smith_1_41(); //z->v2(),in.at(2)=>in.at(1)
delete in.at(2);
in.at(2)=new Tensor("lambda_energy_2_42",z->mem());
offset_smith_1_42();
smith_2_42(); //z->qx(),kn.at(2)=>in.at(2)
smith_1_42(); //z->v2(),in.at(2)=>in.at(1)
delete in.at(2);
in.at(2)=new Tensor("lambda_energy_2_44",z->mem());
offset_smith_1_44();
smith_2_44(); //z->qx(),kn.at(2)=>in.at(2)
smith_1_44(); //z->v2(),in.at(2)=>in.at(1)
delete in.at(2);
smith_0_4(out); //z->t1(),in.at(1)=>out
delete in.at(1);
smith_0_6(out); //z->f1(),kn.at(13)=>out
in.at(1)=new Tensor("lambda_energy_1_2",z->mem());
offset_smith_0_7();
smith_0_7_0(); //z->vd2()=>in.at(1)
smith_1_13(); //z->t2(),z->vd2()=>in.at(1)
smith_0_7(out); //z->glambda2(),in.at(1)=>out
delete in.at(1);
in.at(1)=new Tensor("lambda_energy_1_3",z->mem());
offset_smith_0_12();
smith_1_12(); //z->ly(),z->v2()=>in.at(1)
smith_1_48(); //z->v2(),kn.at(9)=>in.at(1)
smith_1_50(); //z->v2(),kn.at(4)=>in.at(1)
in.at(2)=new Tensor("lambda_energy_2_52",z->mem());
offset_smith_1_52();
smith_2_52(); //z->qx(),z->v2()=>in.at(2)
smith_1_52(); //z->ly(),in.at(2)=>in.at(1)
delete in.at(2);
smith_0_12(out); //z->t2(),in.at(1)=>out
delete in.at(1);
smith_0_14(out); //z->v2(),kn.at(14)=>out
smith_0_15(out); //z->v2(),kn.at(3)=>out
in.at(1)=new Tensor("lambda_energy_1_4",z->mem());
offset_smith_0_16();
smith_1_16(); //z->ly(),z->v2()=>in.at(1)
smith_1_56(); //z->v2(),kn.at(4)=>in.at(1)
in.at(2)=new Tensor("lambda_energy_2_62",z->mem());
offset_smith_1_62();
smith_2_62(); //z->qx(),z->v2()=>in.at(2)
smith_1_62(); //z->ly(),in.at(2)=>in.at(1)
delete in.at(2);
smith_1_63(); //z->v2(),kn.at(7)=>in.at(1)
smith_0_16(out); //z->qy(),in.at(1)=>out
delete in.at(1);
smith_0_17(out); //z->v2(),kn.at(4)=>out
smith_0_18(out); //z->v2(),kn.at(5)=>out
smith_0_19(out); //z->v2(),kn.at(6)=>out
in.at(1)=new Tensor("lambda_energy_1_5",z->mem());
offset_smith_0_49();
smith_1_49(); //z->t2(),kn.at(11)=>in.at(1)
smith_1_51(); //z->t2(),kn.at(6)=>in.at(1)
in.at(2)=new Tensor("lambda_energy_2_0",z->mem());
offset_smith_1_53();
smith_1_53_0(); //kn.at(0)=>in.at(2)
smith_1_53_1(); //kn.at(10)=>in.at(2)
smith_1_53(); //z->qy(),in.at(2)=>in.at(1)
delete in.at(2);
smith_1_59(); //z->qy(),kn.at(5)=>in.at(1)
smith_0_49(out); //z->v2(),in.at(1)=>out
delete in.at(1);
in.at(1)=new Tensor("lambda_energy_1_6",z->mem());
offset_smith_0_54();
smith_1_54(); //z->qx(),kn.at(3)=>in.at(1)
smith_1_60(); //z->qx(),kn.at(7)=>in.at(1)
smith_0_54(out); //z->v2(),in.at(1)=>out
delete in.at(1);
in.at(1)=new Tensor("lambda_energy_1_7",z->mem());
offset_smith_0_55();
in.at(2)=new Tensor("lambda_energy_2_55",z->mem());
offset_smith_1_55();
smith_2_55(); //z->qy(),z->v2()=>in.at(2)
smith_1_55(); //z->qx(),in.at(2)=>in.at(1)
delete in.at(2);
in.at(2)=new Tensor("lambda_energy_2_61",z->mem());
offset_smith_1_61();
smith_2_61(); //z->qy(),z->v2()=>in.at(2)
smith_1_61(); //z->qx(),in.at(2)=>in.at(1)
delete in.at(2);
smith_0_55(out); //z->ly(),in.at(1)=>out
delete in.at(1);
in.at(1)=new Tensor("lambda_energy_1_8",z->mem());
offset_smith_0_57();
smith_1_57(); //z->qx(),kn.at(5)=>in.at(1)
smith_1_58(); //z->qy(),kn.at(6)=>in.at(1)
smith_1_64(); //z->qy(),kn.at(8)=>in.at(1)
smith_1_65(); //z->qx(),kn.at(10)=>in.at(1)
smith_1_66(); //z->qy(),kn.at(11)=>in.at(1)
smith_0_57(out); //z->v2(),in.at(1)=>out
delete in.at(1);
delete kn.at(14);
delete kn.at(13);
delete kn.at(12);
delete kn.at(11);
delete kn.at(10);
delete kn.at(9);
delete kn.at(8);
delete kn.at(7);
delete kn.at(6);
delete kn.at(5);
delete kn.at(4);
delete kn.at(3);
delete kn.at(2);
delete kn.at(1);
delete kn.at(0);
  
}
  
void LAMBDA_ENERGY::offset_k0(){ 
 
long size=0L; 
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  if (z->get_spin(p4b)==z->get_spin(q5b)) { 
   if ((z->get_sym(p4b)^z->get_sym(q5b))==(z->irrep_t()^z->irrep_y())) { 
    if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q5b)!=4L) { 
     kn[0]->input_offset(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),size); 
     size+=z->get_range(p4b)*z->get_range(q5b); 
    } 
   } 
  } 
 } 
} 
kn[0]->set_filesize(size); 
kn[0]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k10(){ 
 
long size=0L; 
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  if (z->get_spin(p4b)==z->get_spin(q5b)) { 
   if ((z->get_sym(p4b)^z->get_sym(q5b))==(z->irrep_e()^z->irrep_y())) { 
    if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q5b)!=4L) { 
     kn[10]->input_offset(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),size); 
     size+=z->get_range(p4b)*z->get_range(q5b); 
    } 
   } 
  } 
 } 
} 
kn[10]->set_filesize(size); 
kn[10]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k11(){ 
 
long size=0L; 
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  if (z->get_spin(p3b)==z->get_spin(p5b)) { 
   if ((z->get_sym(p3b)^z->get_sym(p5b))==(z->irrep_e()^z->irrep_y())) { 
    if (!z->restricted() || z->get_spin(p3b)+z->get_spin(p5b)!=4L) { 
     kn[11]->input_offset(p5b-z->noab()+z->nvab()*(p3b-z->noab()),size); 
     size+=z->get_range(p3b)*z->get_range(p5b); 
    } 
   } 
  } 
 } 
} 
kn[11]->set_filesize(size); 
kn[11]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k12(){ 
 
long size=0L; 
for (long h4b=0L;h4b<z->noab();++h4b) { 
 for (long h5b=0L;h5b<z->noab();++h5b) { 
  if (z->get_spin(h4b)==z->get_spin(h5b)) { 
   if ((z->get_sym(h4b)^z->get_sym(h5b))==(z->irrep_t()^z->irrep_v())) { 
    if (!z->restricted() || z->get_spin(h4b)+z->get_spin(h5b)!=4L) { 
     kn[12]->input_offset(h5b+z->noab()*(h4b),size); 
     size+=z->get_range(h4b)*z->get_range(h5b); 
    } 
   } 
  } 
 } 
} 
kn[12]->set_filesize(size); 
kn[12]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k13(){ 
 
long size=0L; 
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long h3b=0L;h3b<z->noab();++h3b) { 
  if (z->get_spin(p4b)==z->get_spin(h3b)) { 
   if ((z->get_sym(p4b)^z->get_sym(h3b))==(z->irrep_e()^z->irrep_v())) { 
    if (!z->restricted() || z->get_spin(p4b)+z->get_spin(h3b)!=4L) { 
     kn[13]->input_offset(h3b+z->noab()*(p4b-z->noab()),size); 
     size+=z->get_range(p4b)*z->get_range(h3b); 
    } 
   } 
  } 
 } 
} 
kn[13]->set_filesize(size); 
kn[13]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k14(){ 
 
long size=0L; 
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h5b=0L;h5b<z->noab();++h5b) { 
   for (long h6b=h5b;h6b<z->noab();++h6b) { 
    if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h5b)+z->get_spin(h6b)) { 
     if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h5b)^z->get_sym(h6b))))==(z->irrep_t()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h5b)+z->get_spin(h6b)!=8L) { 
       kn[14]->input_offset(h6b+z->noab()*(h5b+z->noab()*(h4b+z->noab()*(h3b))),size); 
       size+=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h5b)*z->get_range(h6b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
kn[14]->set_filesize(size); 
kn[14]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k1(){ 
 
long size=0L; 
for (long h4b=0L;h4b<z->noab();++h4b) { 
 for (long h8b=h4b;h8b<z->noab();++h8b) { 
  for (long h6b=0L;h6b<z->noab();++h6b) { 
   for (long h7b=h6b;h7b<z->noab();++h7b) { 
    if (z->get_spin(h4b)+z->get_spin(h8b)==z->get_spin(h6b)+z->get_spin(h7b)) { 
     if ((z->get_sym(h4b)^(z->get_sym(h8b)^(z->get_sym(h6b)^z->get_sym(h7b))))==(z->irrep_y()^z->irrep_e())) { 
      if (!z->restricted() || z->get_spin(h4b)+z->get_spin(h8b)+z->get_spin(h6b)+z->get_spin(h7b)!=8L) { 
       kn[1]->input_offset(h7b+z->noab()*(h6b+z->noab()*(h8b+z->noab()*(h4b))),size); 
       size+=z->get_range(h4b)*z->get_range(h8b)*z->get_range(h6b)*z->get_range(h7b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
kn[1]->set_filesize(size); 
kn[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k2(){ 
 
long size=0L; 
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long h7b=h2b;h7b<z->noab();++h7b) { 
  for (long h4b=0L;h4b<z->noab();++h4b) { 
   for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
    if (z->get_spin(h2b)+z->get_spin(h7b)==z->get_spin(h4b)+z->get_spin(q6b)) { 
     if ((z->get_sym(h2b)^(z->get_sym(h7b)^(z->get_sym(h4b)^z->get_sym(q6b))))==(z->irrep_t()^z->irrep_y())) { 
      if (!z->restricted() || z->get_spin(h2b)+z->get_spin(h7b)+z->get_spin(h4b)+z->get_spin(q6b)!=8L) { 
       kn[2]->input_offset(q6b-z->noab()-z->nvab()+z->ncab()*(h4b+z->noab()*(h7b+z->noab()*(h2b))),size); 
       size+=z->get_range(h2b)*z->get_range(h7b)*z->get_range(h4b)*z->get_range(q6b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
kn[2]->set_filesize(size); 
kn[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k3(){ 
 
long size=0L; 
for (long h6b=0L;h6b<z->noab();++h6b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h2b=0L;h2b<z->noab();++h2b) { 
   for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
    if (z->get_spin(h6b)+z->get_spin(q4b)==z->get_spin(h2b)+z->get_spin(q5b)) { 
     if ((z->get_sym(h6b)^(z->get_sym(q4b)^(z->get_sym(h2b)^z->get_sym(q5b))))==(z->irrep_e()^z->irrep_y())) { 
      if (!z->restricted() || z->get_spin(h6b)+z->get_spin(q4b)+z->get_spin(h2b)+z->get_spin(q5b)!=8L) { 
       kn[3]->input_offset(q5b-z->noab()-z->nvab()+z->ncab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(h6b))),size); 
       size+=z->get_range(h6b)*z->get_range(q4b)*z->get_range(h2b)*z->get_range(q5b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
kn[3]->set_filesize(size); 
kn[3]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k4(){ 
 
long size=0L; 
for (long h4b=0L;h4b<z->noab();++h4b) { 
 for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
  for (long h5b=0L;h5b<z->noab();++h5b) { 
   for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
    if (z->get_spin(h4b)+z->get_spin(q6b)==z->get_spin(h5b)+z->get_spin(p1b)) { 
     if ((z->get_sym(h4b)^(z->get_sym(q6b)^(z->get_sym(h5b)^z->get_sym(p1b))))==(z->irrep_e()^z->irrep_y())) { 
      if (!z->restricted() || z->get_spin(h4b)+z->get_spin(q6b)+z->get_spin(h5b)+z->get_spin(p1b)!=8L) { 
       kn[4]->input_offset(p1b-z->noab()+z->nvab()*(h5b+z->noab()*(q6b-z->noab()-z->nvab()+z->ncab()*(h4b))),size); 
       size+=z->get_range(h4b)*z->get_range(q6b)*z->get_range(h5b)*z->get_range(p1b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
kn[4]->set_filesize(size); 
kn[4]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k5(){ 
 
long size=0L; 
for (long h6b=0L;h6b<z->noab();++h6b) { 
 for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
  for (long h2b=0L;h2b<z->noab();++h2b) { 
   for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
    if (z->get_spin(h6b)+z->get_spin(p4b)==z->get_spin(h2b)+z->get_spin(q5b)) { 
     if ((z->get_sym(h6b)^(z->get_sym(p4b)^(z->get_sym(h2b)^z->get_sym(q5b))))==(z->irrep_e()^z->irrep_y())) { 
      if (!z->restricted() || z->get_spin(h6b)+z->get_spin(p4b)+z->get_spin(h2b)+z->get_spin(q5b)!=8L) { 
       kn[5]->input_offset(q5b-z->noab()-z->nvab()+z->ncab()*(h2b+z->noab()*(p4b-z->noab()+z->nvab()*(h6b))),size); 
       size+=z->get_range(h6b)*z->get_range(p4b)*z->get_range(h2b)*z->get_range(q5b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
kn[5]->set_filesize(size); 
kn[5]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k6(){ 
 
long size=0L; 
for (long h6b=0L;h6b<z->noab();++h6b) { 
 for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
  for (long h2b=0L;h2b<z->noab();++h2b) { 
   for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
    if (z->get_spin(h6b)+z->get_spin(p3b)==z->get_spin(h2b)+z->get_spin(p5b)) { 
     if ((z->get_sym(h6b)^(z->get_sym(p3b)^(z->get_sym(h2b)^z->get_sym(p5b))))==(z->irrep_e()^z->irrep_y())) { 
      if (!z->restricted() || z->get_spin(h6b)+z->get_spin(p3b)+z->get_spin(h2b)+z->get_spin(p5b)!=8L) { 
       kn[6]->input_offset(p5b-z->noab()+z->nvab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(h6b))),size); 
       size+=z->get_range(h6b)*z->get_range(p3b)*z->get_range(h2b)*z->get_range(p5b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
kn[6]->set_filesize(size); 
kn[6]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k7(){ 
 
long size=0L; 
for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
 for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
  if (z->get_spin(q5b)==z->get_spin(q2b)) { 
   if ((z->get_sym(q5b)^z->get_sym(q2b))==(z->irrep_e()^z->irrep_y())) { 
    if (!z->restricted() || z->get_spin(q5b)+z->get_spin(q2b)!=4L) { 
     kn[7]->input_offset(q2b-z->noab()-z->nvab()+z->ncab()*(q5b-z->noab()-z->nvab()),size); 
     size+=z->get_range(q5b)*z->get_range(q2b); 
    } 
   } 
  } 
 } 
} 
kn[7]->set_filesize(size); 
kn[7]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k8(){ 
 
long size=0L; 
for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  if (z->get_spin(q4b)==z->get_spin(q5b)) { 
   if ((z->get_sym(q4b)^z->get_sym(q5b))==(z->irrep_e()^z->irrep_y())) { 
    if (!z->restricted() || z->get_spin(q4b)+z->get_spin(q5b)!=4L) { 
     kn[8]->input_offset(q5b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab()),size); 
     size+=z->get_range(q4b)*z->get_range(q5b); 
    } 
   } 
  } 
 } 
} 
kn[8]->set_filesize(size); 
kn[8]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_k9(){ 
 
long size=0L; 
for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
 for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
  if (z->get_spin(q5b)==z->get_spin(p2b)) { 
   if ((z->get_sym(q5b)^z->get_sym(p2b))==(z->irrep_e()^z->irrep_y())) { 
    if (!z->restricted() || z->get_spin(q5b)+z->get_spin(p2b)!=4L) { 
     kn[9]->input_offset(p2b-z->noab()+z->nvab()*(q5b-z->noab()-z->nvab()),size); 
     size+=z->get_range(q5b)*z->get_range(p2b); 
    } 
   } 
  } 
 } 
} 
kn[9]->set_filesize(size); 
kn[9]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_1(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_f()^z->irrep_v())) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
   for (long q1b=z->noab()+z->nvab();q1b<z->nab();++q1b) { 
    if (z->get_spin(q1b)==z->get_spin(p2b)) { 
     if ((z->get_sym(q1b)^z->get_sym(p2b))==z->irrep_f()) { 
      long q1b_0,p2b_0; 
      z->restricted_2(q1b,p2b,q1b_0,p2b_0); 
      long p2b_1,q1b_1; 
      z->restricted_2(p2b,q1b,p2b_1,q1b_1); 
      long dim_common=z->get_range(p2b)*z->get_range(q1b); 
      long dima0_sort=1L; 
      long dima0=dim_common*dima0_sort; 
      long dima1_sort=1L; 
      long dima1=dim_common*dima1_sort; 
      if (dima0>0L && dima1>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       z->f1()->get_block(p2b_0+(z->nab())*(q1b_0),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(q1b),z->get_range(p2b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
       double* k_a1=z->mem()->malloc_local_double(dima1); 
       kn[0]->get_block(q1b_1-z->noab()-z->nvab()+z->ncab()*(p2b_1-z->noab()),k_a1); 
       z->sort_indices2(k_a1,k_a1_sort,z->get_range(p2b),z->get_range(q1b),1,0,+1.0,false); 
       z->mem()->free_local_double(k_a1); 
       double factor=1.0; 
       z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
       z->mem()->free_local_double(k_a1_sort); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_12(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_t()^(z->irrep_y()^z->irrep_v()))) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
     for (long p2b=p1b;p2b<z->noab()+z->nvab();++p2b) { 
      if (z->get_spin(p1b)+z->get_spin(p2b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(p1b)^(z->get_sym(p2b)^(z->get_sym(h3b)^z->get_sym(h4b))))==z->irrep_t()) { 
        long p1b_0,p2b_0,h3b_0,h4b_0; 
        z->restricted_4(p1b,p2b,h3b,h4b,p1b_0,p2b_0,h3b_0,h4b_0); 
        long h3b_1,h4b_1,p1b_1,p2b_1; 
        z->restricted_4(h3b,h4b,p1b,p2b,h3b_1,h4b_1,p1b_1,p2b_1); 
        long dim_common=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(p2b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->t2()->get_block(h4b_0+z->noab()*(h3b_0+z->noab()*(p2b_0-z->noab()+z->nvab()*(p1b_0-z->noab()))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(p1b),z->get_range(p2b),z->get_range(h3b),z->get_range(h4b),1,0,3,2,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         in[1]->get_block(p2b_1-z->noab()+z->nvab()*(p1b_1-z->noab()+z->nvab()*(h4b_1+z->noab()*(h3b_1))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(p2b),3,2,1,0,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         if (h3b==h4b) { 
          factor=factor/2.0; 
         } 
         if (p1b==p2b) { 
          factor=factor/2.0; 
         } 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_0_12(){ 
 
long size=0L; 
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long p2b=p1b;p2b<z->noab()+z->nvab();++p2b) { 
    if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(p2b)) { 
     if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(p2b))))==(z->irrep_y()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(p2b)!=8L) { 
       in[1]->input_offset(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),size); 
       size+=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(p2b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[1]->set_filesize(size); 
in[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_14(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_v()^z->irrep_v())) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    for (long h3b=0L;h3b<z->noab();++h3b) { 
     for (long h4b=h3b;h4b<z->noab();++h4b) { 
      if (z->get_spin(h1b)+z->get_spin(h2b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(h2b)^(z->get_sym(h3b)^z->get_sym(h4b))))==z->irrep_v()) { 
        long h1b_0,h2b_0,h3b_0,h4b_0; 
        z->restricted_4(h1b,h2b,h3b,h4b,h1b_0,h2b_0,h3b_0,h4b_0); 
        long h3b_1,h4b_1,h1b_1,h2b_1; 
        z->restricted_4(h3b,h4b,h1b,h2b,h3b_1,h4b_1,h1b_1,h2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h2b)*z->get_range(h3b)*z->get_range(h4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(h4b_0+(z->nab())*(h3b_0+(z->nab())*(h2b_0+(z->nab())*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(h2b),z->get_range(h3b),z->get_range(h4b),3,2,1,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         kn[14]->get_block(h2b_1+z->noab()*(h1b_1+z->noab()*(h4b_1+z->noab()*(h3b_1))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h1b),z->get_range(h2b),1,0,3,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         if (h1b==h2b) { 
          factor=factor/2.0; 
         } 
         if (h3b==h4b) { 
          factor=factor/2.0; 
         } 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_15(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_v()^z->irrep_v())) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h3b=0L;h3b<z->noab();++h3b) { 
    for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
     for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
      if (z->get_spin(h1b)+z->get_spin(q2b)==z->get_spin(h3b)+z->get_spin(q4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(q2b)^(z->get_sym(h3b)^z->get_sym(q4b))))==z->irrep_v()) { 
        long h1b_0,q2b_0,h3b_0,q4b_0; 
        z->restricted_4(h1b,q2b,h3b,q4b,h1b_0,q2b_0,h3b_0,q4b_0); 
        long h3b_1,q4b_1,h1b_1,q2b_1; 
        z->restricted_4(h3b,q4b,h1b,q2b,h3b_1,q4b_1,h1b_1,q2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h3b)*z->get_range(q2b)*z->get_range(q4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(q4b_0+(z->nab())*(h3b_0+(z->nab())*(q2b_0+(z->nab())*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(q2b),z->get_range(h3b),z->get_range(q4b),3,1,2,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         kn[3]->get_block(q2b_1-z->noab()-z->nvab()+z->ncab()*(h1b_1+z->noab()*(q4b_1-z->noab()-z->nvab()+z->ncab()*(h3b_1))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(q4b),z->get_range(h1b),z->get_range(q2b),1,3,0,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_16(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_e()^(z->irrep_y()^z->irrep_v()))) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
     for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
      if (z->get_spin(p1b)+z->get_spin(q2b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(p1b)^(z->get_sym(q2b)^(z->get_sym(h3b)^z->get_sym(h4b))))==z->irrep_e()) { 
        long p1b_0,q2b_0,h3b_0,h4b_0; 
        z->restricted_4(p1b,q2b,h3b,h4b,p1b_0,q2b_0,h3b_0,h4b_0); 
        long h3b_1,h4b_1,p1b_1,q2b_1; 
        z->restricted_4(h3b,h4b,p1b,q2b,h3b_1,h4b_1,p1b_1,q2b_1); 
        long dim_common=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(q2b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->qy()->get_block(h4b_0+z->noab()*(h3b_0+z->noab()*(q2b_0-z->noab()-z->nvab()+z->ncab()*(p1b_0-z->noab()))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(p1b),z->get_range(q2b),z->get_range(h3b),z->get_range(h4b),1,0,3,2,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         in[1]->get_block(q2b_1-z->noab()-z->nvab()+z->ncab()*(p1b_1-z->noab()+z->nvab()*(h4b_1+z->noab()*(h3b_1))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(q2b),3,2,1,0,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         if (h3b==h4b) { 
          factor=factor/2.0; 
         } 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_0_16(){ 
 
long size=0L; 
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
    if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q2b)) { 
     if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q2b))))==(z->irrep_y()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(q2b)!=8L) { 
       in[1]->input_offset(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),size); 
       size+=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(q2b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[1]->set_filesize(size); 
in[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_17(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_v()^z->irrep_v())) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h3b=0L;h3b<z->noab();++h3b) { 
    for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
     for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
      if (z->get_spin(h1b)+z->get_spin(p2b)==z->get_spin(h3b)+z->get_spin(q4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(p2b)^(z->get_sym(h3b)^z->get_sym(q4b))))==z->irrep_v()) { 
        long h1b_0,p2b_0,h3b_0,q4b_0; 
        z->restricted_4(h1b,p2b,h3b,q4b,h1b_0,p2b_0,h3b_0,q4b_0); 
        long h3b_1,q4b_1,h1b_1,p2b_1; 
        z->restricted_4(h3b,q4b,h1b,p2b,h3b_1,q4b_1,h1b_1,p2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h3b)*z->get_range(p2b)*z->get_range(q4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(q4b_0+(z->nab())*(h3b_0+(z->nab())*(p2b_0+(z->nab())*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(p2b),z->get_range(h3b),z->get_range(q4b),3,1,2,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         kn[4]->get_block(p2b_1-z->noab()+z->nvab()*(h1b_1+z->noab()*(q4b_1-z->noab()-z->nvab()+z->ncab()*(h3b_1))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(q4b),z->get_range(h1b),z->get_range(p2b),1,3,0,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_18(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_v()^z->irrep_v())) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h3b=0L;h3b<z->noab();++h3b) { 
    for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
     for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
      if (z->get_spin(h1b)+z->get_spin(q2b)==z->get_spin(h3b)+z->get_spin(p4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(q2b)^(z->get_sym(h3b)^z->get_sym(p4b))))==z->irrep_v()) { 
        long h1b_0,q2b_0,h3b_0,p4b_0; 
        z->restricted_4(h1b,q2b,h3b,p4b,h1b_0,q2b_0,h3b_0,p4b_0); 
        long h3b_1,p4b_1,h1b_1,q2b_1; 
        z->restricted_4(h3b,p4b,h1b,q2b,h3b_1,p4b_1,h1b_1,q2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h3b)*z->get_range(p4b)*z->get_range(q2b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(p4b_0+(z->nab())*(h3b_0+(z->nab())*(q2b_0+(z->nab())*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(q2b),z->get_range(h3b),z->get_range(p4b),1,3,2,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         kn[5]->get_block(q2b_1-z->noab()-z->nvab()+z->ncab()*(h1b_1+z->noab()*(p4b_1-z->noab()+z->nvab()*(h3b_1))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(p4b),z->get_range(h1b),z->get_range(q2b),3,1,0,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_19(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_v()^z->irrep_v())) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h3b=0L;h3b<z->noab();++h3b) { 
    for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
     for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
      if (z->get_spin(h1b)+z->get_spin(p2b)==z->get_spin(h3b)+z->get_spin(p4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(p2b)^(z->get_sym(h3b)^z->get_sym(p4b))))==z->irrep_v()) { 
        long h1b_0,p2b_0,h3b_0,p4b_0; 
        z->restricted_4(h1b,p2b,h3b,p4b,h1b_0,p2b_0,h3b_0,p4b_0); 
        long h3b_1,p4b_1,h1b_1,p2b_1; 
        z->restricted_4(h3b,p4b,h1b,p2b,h3b_1,p4b_1,h1b_1,p2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h3b)*z->get_range(p2b)*z->get_range(p4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(p4b_0+(z->nab())*(h3b_0+(z->nab())*(p2b_0+(z->nab())*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(p2b),z->get_range(h3b),z->get_range(p4b),3,1,2,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         kn[6]->get_block(p2b_1-z->noab()+z->nvab()*(h1b_1+z->noab()*(p4b_1-z->noab()+z->nvab()*(h3b_1))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(p4b),z->get_range(h1b),z->get_range(p2b),1,3,0,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_2(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_f()^z->irrep_v())) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=0L;h2b<z->noab();++h2b) { 
    if (z->get_spin(h1b)==z->get_spin(h2b)) { 
     if ((z->get_sym(h1b)^z->get_sym(h2b))==z->irrep_f()) { 
      long h1b_0,h2b_0; 
      z->restricted_2(h1b,h2b,h1b_0,h2b_0); 
      long h2b_1,h1b_1; 
      z->restricted_2(h2b,h1b,h2b_1,h1b_1); 
      long dim_common=z->get_range(h1b)*z->get_range(h2b); 
      long dima0_sort=1L; 
      long dima0=dim_common*dima0_sort; 
      long dima1_sort=1L; 
      long dima1=dim_common*dima1_sort; 
      if (dima0>0L && dima1>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       z->f1()->get_block(h2b_0+(z->nab())*(h1b_0),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(h2b),1,0,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
       double* k_a1=z->mem()->malloc_local_double(dima1); 
       kn[12]->get_block(h1b_1+z->noab()*(h2b_1),k_a1); 
       z->sort_indices2(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h1b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a1); 
       double factor=1.0; 
       z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
       z->mem()->free_local_double(k_a1_sort); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_3(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_t()^(z->irrep_y()^z->irrep_e()))) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    for (long h3b=0L;h3b<z->noab();++h3b) { 
     for (long h4b=h3b;h4b<z->noab();++h4b) { 
      if (z->get_spin(h1b)+z->get_spin(h2b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(h2b)^(z->get_sym(h3b)^z->get_sym(h4b))))==z->irrep_t()) { 
        long h1b_0,h2b_0,h3b_0,h4b_0; 
        z->restricted_4(h1b,h2b,h3b,h4b,h1b_0,h2b_0,h3b_0,h4b_0); 
        long h3b_1,h4b_1,h1b_1,h2b_1; 
        z->restricted_4(h3b,h4b,h1b,h2b,h3b_1,h4b_1,h1b_1,h2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h2b)*z->get_range(h3b)*z->get_range(h4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->gt2()->get_block(h4b_0+z->noab()*(h3b_0+z->noab()*(h2b_0+z->noab()*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(h2b),z->get_range(h3b),z->get_range(h4b),3,2,1,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         in[1]->get_block(h2b_1+z->noab()*(h1b_1+z->noab()*(h4b_1+z->noab()*(h3b_1))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h1b),z->get_range(h2b),1,0,3,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         if (h1b==h2b) { 
          factor=factor/2.0; 
         } 
         if (h3b==h4b) { 
          factor=factor/2.0; 
         } 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_0_3(){ 
 
long size=0L; 
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
     if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_y()^z->irrep_e())) { 
      if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
       in[1]->input_offset(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b))),size); 
       size+=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h1b)*z->get_range(h2b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[1]->set_filesize(size); 
in[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_4(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_t()^(z->irrep_f()^z->irrep_v()))) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h2b=0L;h2b<z->noab();++h2b) { 
   for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
    if (z->get_spin(p1b)==z->get_spin(h2b)) { 
     if ((z->get_sym(p1b)^z->get_sym(h2b))==z->irrep_t()) { 
      long p1b_0,h2b_0; 
      z->restricted_2(p1b,h2b,p1b_0,h2b_0); 
      long h2b_1,p1b_1; 
      z->restricted_2(h2b,p1b,h2b_1,p1b_1); 
      long dim_common=z->get_range(h2b)*z->get_range(p1b); 
      long dima0_sort=1L; 
      long dima0=dim_common*dima0_sort; 
      long dima1_sort=1L; 
      long dima1=dim_common*dima1_sort; 
      if (dima0>0L && dima1>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       z->t1()->get_block(h2b_0+z->noab()*(p1b_0-z->noab()),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(p1b),z->get_range(h2b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
       double* k_a1=z->mem()->malloc_local_double(dima1); 
       in[1]->get_block(p1b_1-z->noab()+z->nvab()*(h2b_1),k_a1); 
       z->sort_indices2(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(p1b),1,0,+1.0,false); 
       z->mem()->free_local_double(k_a1); 
       double factor=1.0; 
       z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
       z->mem()->free_local_double(k_a1_sort); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_49(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_v()^(z->irrep_t()^z->irrep_v()))) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
     for (long p4b=p3b;p4b<z->noab()+z->nvab();++p4b) { 
      if (z->get_spin(h1b)+z->get_spin(h2b)==z->get_spin(p3b)+z->get_spin(p4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(h2b)^(z->get_sym(p3b)^z->get_sym(p4b))))==z->irrep_v()) { 
        long h1b_0,h2b_0,p3b_0,p4b_0; 
        z->restricted_4(h1b,h2b,p3b,p4b,h1b_0,h2b_0,p3b_0,p4b_0); 
        long p3b_1,p4b_1,h1b_1,h2b_1; 
        z->restricted_4(p3b,p4b,h1b,h2b,p3b_1,p4b_1,h1b_1,h2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h2b)*z->get_range(p3b)*z->get_range(p4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(p4b_0+(z->nab())*(p3b_0+(z->nab())*(h2b_0+(z->nab())*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(h2b),z->get_range(p3b),z->get_range(p4b),3,2,1,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         in[1]->get_block(h2b_1+z->noab()*(h1b_1+z->noab()*(p4b_1-z->noab()+z->nvab()*(p3b_1-z->noab()))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(p3b),z->get_range(p4b),z->get_range(h1b),z->get_range(h2b),1,0,3,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         if (h1b==h2b) { 
          factor=factor/2.0; 
         } 
         if (p3b==p4b) { 
          factor=factor/2.0; 
         } 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_0_49(){ 
 
long size=0L; 
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long p4b=p3b;p4b<z->noab()+z->nvab();++p4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    if (z->get_spin(p3b)+z->get_spin(p4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
     if ((z->get_sym(p3b)^(z->get_sym(p4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_t()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(p3b)+z->get_spin(p4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
       in[1]->input_offset(h2b+z->noab()*(h1b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab()))),size); 
       size+=z->get_range(p3b)*z->get_range(p4b)*z->get_range(h1b)*z->get_range(h2b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[1]->set_filesize(size); 
in[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_0_4(){ 
 
long size=0L; 
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  if (z->get_spin(h2b)==z->get_spin(p1b)) { 
   if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_f()^z->irrep_v())) { 
    if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
     in[1]->input_offset(p1b-z->noab()+z->nvab()*(h2b),size); 
     size+=z->get_range(h2b)*z->get_range(p1b); 
    } 
   } 
  } 
 } 
} 
in[1]->set_filesize(size); 
in[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_54(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_v()^(z->irrep_e()^z->irrep_v()))) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
     for (long q4b=q3b;q4b<z->nab();++q4b) { 
      if (z->get_spin(h1b)+z->get_spin(h2b)==z->get_spin(q3b)+z->get_spin(q4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(h2b)^(z->get_sym(q3b)^z->get_sym(q4b))))==z->irrep_v()) { 
        long h1b_0,h2b_0,q3b_0,q4b_0; 
        z->restricted_4(h1b,h2b,q3b,q4b,h1b_0,h2b_0,q3b_0,q4b_0); 
        long q3b_1,q4b_1,h1b_1,h2b_1; 
        z->restricted_4(q3b,q4b,h1b,h2b,q3b_1,q4b_1,h1b_1,h2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h2b)*z->get_range(q3b)*z->get_range(q4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(q4b_0+(z->nab())*(q3b_0+(z->nab())*(h2b_0+(z->nab())*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(h2b),z->get_range(q3b),z->get_range(q4b),3,2,1,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         in[1]->get_block(h2b_1+z->noab()*(h1b_1+z->noab()*(q4b_1-z->noab()-z->nvab()+z->ncab()*(q3b_1-z->noab()-z->nvab()))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(q3b),z->get_range(q4b),z->get_range(h1b),z->get_range(h2b),1,0,3,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         if (h1b==h2b) { 
          factor=factor/2.0; 
         } 
         if (q3b==q4b) { 
          factor=factor/2.0; 
         } 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_0_54(){ 
 
long size=0L; 
for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
 for (long q4b=q3b;q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    if (z->get_spin(q3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
     if ((z->get_sym(q3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(q3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
       in[1]->input_offset(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(q3b-z->noab()-z->nvab()))),size); 
       size+=z->get_range(q3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[1]->set_filesize(size); 
in[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_55(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_y()^(z->irrep_e()^(z->irrep_e()^z->irrep_v())))) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
     for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
      if (z->get_spin(h1b)+z->get_spin(h2b)==z->get_spin(p3b)+z->get_spin(q4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(h2b)^(z->get_sym(p3b)^z->get_sym(q4b))))==z->irrep_y()) { 
        long h1b_0,h2b_0,p3b_0,q4b_0; 
        z->restricted_4(h1b,h2b,p3b,q4b,h1b_0,h2b_0,p3b_0,q4b_0); 
        long p3b_1,q4b_1,h1b_1,h2b_1; 
        z->restricted_4(p3b,q4b,h1b,h2b,p3b_1,q4b_1,h1b_1,h2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h2b)*z->get_range(p3b)*z->get_range(q4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->ly()->get_block(q4b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()+z->nvab()*(h2b_0+z->noab()*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(h2b),z->get_range(p3b),z->get_range(q4b),3,2,1,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         in[1]->get_block(h2b_1+z->noab()*(h1b_1+z->noab()*(q4b_1-z->noab()-z->nvab()+z->ncab()*(p3b_1-z->noab()))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(p3b),z->get_range(q4b),z->get_range(h1b),z->get_range(h2b),1,0,3,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         if (h1b==h2b) { 
          factor=factor/2.0; 
         } 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_0_55(){ 
 
long size=0L; 
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    if (z->get_spin(p3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
     if ((z->get_sym(p3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^(z->irrep_e()^z->irrep_v()))) { 
      if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
       in[1]->input_offset(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),size); 
       size+=z->get_range(p3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[1]->set_filesize(size); 
in[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_57(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_v()^(z->irrep_e()^z->irrep_v()))) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
     for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
      if (z->get_spin(h1b)+z->get_spin(h2b)==z->get_spin(p3b)+z->get_spin(q4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(h2b)^(z->get_sym(p3b)^z->get_sym(q4b))))==z->irrep_v()) { 
        long h1b_0,h2b_0,p3b_0,q4b_0; 
        z->restricted_4(h1b,h2b,p3b,q4b,h1b_0,h2b_0,p3b_0,q4b_0); 
        long p3b_1,q4b_1,h1b_1,h2b_1; 
        z->restricted_4(p3b,q4b,h1b,h2b,p3b_1,q4b_1,h1b_1,h2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h2b)*z->get_range(p3b)*z->get_range(q4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(q4b_0+(z->nab())*(p3b_0+(z->nab())*(h2b_0+(z->nab())*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(h2b),z->get_range(p3b),z->get_range(q4b),3,2,1,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         in[1]->get_block(h2b_1+z->noab()*(h1b_1+z->noab()*(q4b_1-z->noab()-z->nvab()+z->ncab()*(p3b_1-z->noab()))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(p3b),z->get_range(q4b),z->get_range(h1b),z->get_range(h2b),1,0,3,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         if (h1b==h2b) { 
          factor=factor/2.0; 
         } 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_0_57(){ 
 
long size=0L; 
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    if (z->get_spin(p3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
     if ((z->get_sym(p3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
       in[1]->input_offset(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),size); 
       size+=z->get_range(p3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[1]->set_filesize(size); 
in[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_6(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_f()^z->irrep_v())) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
    if (z->get_spin(h1b)==z->get_spin(p2b)) { 
     if ((z->get_sym(h1b)^z->get_sym(p2b))==z->irrep_f()) { 
      long h1b_0,p2b_0; 
      z->restricted_2(h1b,p2b,h1b_0,p2b_0); 
      long p2b_1,h1b_1; 
      z->restricted_2(p2b,h1b,p2b_1,h1b_1); 
      long dim_common=z->get_range(h1b)*z->get_range(p2b); 
      long dima0_sort=1L; 
      long dima0=dim_common*dima0_sort; 
      long dima1_sort=1L; 
      long dima1=dim_common*dima1_sort; 
      if (dima0>0L && dima1>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       z->f1()->get_block(p2b_0+(z->nab())*(h1b_0),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(p2b),1,0,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
       double* k_a1=z->mem()->malloc_local_double(dima1); 
       kn[13]->get_block(h1b_1+z->noab()*(p2b_1-z->noab()),k_a1); 
       z->sort_indices2(k_a1,k_a1_sort,z->get_range(p2b),z->get_range(h1b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a1); 
       double factor=1.0; 
       z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
       z->mem()->free_local_double(k_a1_sort); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_7(Ref<Tensor>& out){ 
      
long tileoffset; 
if (out->is_this_local(0L)) { 
 if (z->irrep_e()==(z->irrep_y()^z->irrep_e())) { 
  long dimc=1; 
  double* k_c_sort=z->mem()->malloc_local_double(dimc); 
  std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    for (long h3b=0L;h3b<z->noab();++h3b) { 
     for (long h4b=h3b;h4b<z->noab();++h4b) { 
      if (z->get_spin(h1b)+z->get_spin(h2b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h1b)^(z->get_sym(h2b)^(z->get_sym(h3b)^z->get_sym(h4b))))==z->irrep_y()) { 
        long h1b_0,h2b_0,h3b_0,h4b_0; 
        z->restricted_4(h1b,h2b,h3b,h4b,h1b_0,h2b_0,h3b_0,h4b_0); 
        long h3b_1,h4b_1,h1b_1,h2b_1; 
        z->restricted_4(h3b,h4b,h1b,h2b,h3b_1,h4b_1,h1b_1,h2b_1); 
        long dim_common=z->get_range(h1b)*z->get_range(h2b)*z->get_range(h3b)*z->get_range(h4b); 
        long dima0_sort=1L; 
        long dima0=dim_common*dima0_sort; 
        long dima1_sort=1L; 
        long dima1=dim_common*dima1_sort; 
        if (dima0>0L && dima1>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->glambda2()->get_block(h4b_0+z->noab()*(h3b_0+z->noab()*(h2b_0+z->noab()*(h1b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h1b),z->get_range(h2b),z->get_range(h3b),z->get_range(h4b),3,2,1,0,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
         double* k_a1=z->mem()->malloc_local_double(dima1); 
         in[1]->get_block(h2b_1+z->noab()*(h1b_1+z->noab()*(h4b_1+z->noab()*(h3b_1))),k_a1); 
         z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h1b),z->get_range(h2b),1,0,3,2,+1.0,false); 
         z->mem()->free_local_double(k_a1); 
         double factor=1.0; 
         if (h1b==h2b) { 
          factor=factor/2.0; 
         } 
         if (h3b==h4b) { 
          factor=factor/2.0; 
         } 
         z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
         z->mem()->free_local_double(k_a1_sort); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
  double* k_c=z->mem()->malloc_local_double(dimc); 
  z->sort_indices0(k_c_sort,k_c,1.0,false); 
  out->add_block((0),k_c); 
  z->mem()->free_local_double(k_c); 
  z->mem()->free_local_double(k_c_sort); 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_0_7_0(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b)))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h1b)*z->get_range(h2b); 
        long h3b_0,h4b_0,h1b_0,h2b_0; 
        z->restricted_4(h3b,h4b,h1b,h2b,h3b_0,h4b_0,h1b_0,h2b_0); 
        long dim_common=1L; 
        long dima0_sort=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h1b)*z->get_range(h2b); 
        long dima0=dim_common*dima0_sort; 
        if (dima0>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->vd2()->get_block(h2b_0+(z->nab())*(h1b_0+(z->nab())*(h4b_0+z->noab()*(h3b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h1b),z->get_range(h2b),0,1,2,3,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_c=z->mem()->malloc_local_double(dimc); 
         z->sort_indices4(k_a0_sort,k_c,z->get_range(h3b),z->get_range(h4b),z->get_range(h1b),z->get_range(h2b),0,1,2,3,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
         z->mem()->free_local_double(k_c); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_0_7(){ 
 
long size=0L; 
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
     if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_t()^z->irrep_e())) { 
      if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
       in[1]->input_offset(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b))),size); 
       size+=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h1b)*z->get_range(h2b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[1]->set_filesize(size); 
in[1]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_11(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_e()^(z->irrep_t()^z->irrep_y()))) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long h4b=h3b;h4b<z->noab();++h4b) { 
        for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
         if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(p5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(p5b))))==z->irrep_e()) { 
           long h3b_0,h4b_0,p1b_0,p5b_0; 
           z->restricted_4(h3b,h4b,p1b,p5b,h3b_0,h4b_0,p1b_0,p5b_0); 
           long h2b_1,p5b_1,h3b_1,h4b_1; 
           z->restricted_4(h2b,p5b,h3b,h4b,h2b_1,p5b_1,h3b_1,h4b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p5b); 
           long dima0_sort=z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (p1b<p5b) { 
             z->vd2()->get_block(p5b_0+(z->nab())*(p1b_0+(z->nab())*(h4b_0+z->noab()*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(p5b),2,3,1,0,+1.0,false); 
            } 
            else if (p5b<=p1b) { 
             z->vd2()->get_block(p1b_0+(z->nab())*(p5b_0+(z->nab())*(h4b_0+z->noab()*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p5b),z->get_range(p1b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(p5b_1-z->noab()+z->nvab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(p5b),z->get_range(h3b),z->get_range(h4b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h3b==h4b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,+0.5/0.5,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_11(){ 
 
long size=0L; 
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    if (z->get_spin(h2b)+z->get_spin(p5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
     if ((z->get_sym(h2b)^(z->get_sym(p5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_t()^z->irrep_y())) { 
      if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
       in[2]->input_offset(h4b+z->noab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b))),size); 
       size+=z->get_range(h2b)*z->get_range(p5b)*z->get_range(h3b)*z->get_range(h4b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_12(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=0L;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
    long tileoffset; 
    if (h3b<h4b && p1b<p2b) { 
     tileoffset=(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (h3b<h4b && p2b<=p1b) { 
     tileoffset=(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (h4b<=h3b && p1b<p2b) { 
     tileoffset=(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b)))); 
    } 
    else if (h4b<=h3b && p2b<=p1b) { 
     tileoffset=(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b)))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(p2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(p2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(p2b))))==(z->irrep_y()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(p2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h5b=0L;h5b<z->noab();++h5b) { 
         for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
          if (z->get_spin(h3b)+z->get_spin(h5b)==z->get_spin(p1b)+z->get_spin(q6b)) { 
           if ((z->get_sym(h3b)^(z->get_sym(h5b)^(z->get_sym(p1b)^z->get_sym(q6b))))==z->irrep_y()) { 
            long h3b_0,h5b_0,p1b_0,q6b_0; 
            z->restricted_4(h3b,h5b,p1b,q6b,h3b_0,h5b_0,p1b_0,q6b_0); 
            long h4b_1,q6b_1,h5b_1,p2b_1; 
            z->restricted_4(h4b,q6b,h5b,p2b,h4b_1,q6b_1,h5b_1,p2b_1); 
            long dim_common=z->get_range(h5b)*z->get_range(q6b); 
            long dima0_sort=z->get_range(h3b)*z->get_range(p1b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h4b)*z->get_range(p2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h3b<h5b) { 
              z->ly()->get_block(q6b_0-z->noab()-z->nvab()+z->ncab()*(p1b_0-z->noab()+z->nvab()*(h5b_0+z->noab()*(h3b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h5b),z->get_range(p1b),z->get_range(q6b),2,0,3,1,+1.0,false); 
             } 
             else if (h5b<=h3b) { 
              z->ly()->get_block(q6b_0-z->noab()-z->nvab()+z->ncab()*(p1b_0-z->noab()+z->nvab()*(h3b_0+z->noab()*(h5b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h3b),z->get_range(p1b),z->get_range(q6b),2,1,3,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             z->v2()->get_block(p2b_1+(z->nab())*(h5b_1+(z->nab())*(q6b_1+(z->nab())*(h4b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(q6b),z->get_range(h5b),z->get_range(p2b),3,0,1,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b && p2b>=p1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),3,1,2,0,-1.0,false); 
         in[1]->add_block(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (h4b>=h3b && p1b>=p2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),3,1,0,2,+1.0,false); 
         in[1]->add_block(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (h3b>=h4b && p2b>=p1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),1,3,2,0,+1.0,false); 
         in[1]->add_block(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b))),k_c); 
        } 
        if (h3b>=h4b && p1b>=p2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),1,3,0,2,-1.0,false); 
         in[1]->add_block(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_13(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b)))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_t()^z->irrep_e())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
         for (long p6b=p5b;p6b<z->noab()+z->nvab();++p6b) { 
          if (z->get_spin(p5b)+z->get_spin(p6b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
           if ((z->get_sym(p5b)^(z->get_sym(p6b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_t()) { 
            long p5b_0,p6b_0,h1b_0,h2b_0; 
            z->restricted_4(p5b,p6b,h1b,h2b,p5b_0,p6b_0,h1b_0,h2b_0); 
            long h3b_1,h4b_1,p5b_1,p6b_1; 
            z->restricted_4(h3b,h4b,p5b,p6b,h3b_1,h4b_1,p5b_1,p6b_1); 
            long dim_common=z->get_range(p5b)*z->get_range(p6b); 
            long dima0_sort=z->get_range(h1b)*z->get_range(h2b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h3b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->t2()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(p6b_0-z->noab()+z->nvab()*(p5b_0-z->noab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(p6b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             z->vd2()->get_block(p6b_1+(z->nab())*(p5b_1+(z->nab())*(h4b_1+z->noab()*(h3b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p5b),z->get_range(p6b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (p5b==p6b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h3b),z->get_range(h2b),z->get_range(h1b),1,0,3,2,+0.5/0.5,false); 
        in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_16(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=0L;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
    long tileoffset; 
    if (h3b<h4b) { 
     tileoffset=(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (h4b<=h3b) { 
     tileoffset=(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b)))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(q2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q2b))))==(z->irrep_y()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(q2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h5b=0L;h5b<z->noab();++h5b) { 
         for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
          if (z->get_spin(h3b)+z->get_spin(h5b)==z->get_spin(p1b)+z->get_spin(q6b)) { 
           if ((z->get_sym(h3b)^(z->get_sym(h5b)^(z->get_sym(p1b)^z->get_sym(q6b))))==z->irrep_y()) { 
            long h3b_0,h5b_0,p1b_0,q6b_0; 
            z->restricted_4(h3b,h5b,p1b,q6b,h3b_0,h5b_0,p1b_0,q6b_0); 
            long h4b_1,q6b_1,h5b_1,q2b_1; 
            z->restricted_4(h4b,q6b,h5b,q2b,h4b_1,q6b_1,h5b_1,q2b_1); 
            long dim_common=z->get_range(h5b)*z->get_range(q6b); 
            long dima0_sort=z->get_range(h3b)*z->get_range(p1b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h4b)*z->get_range(q2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h3b<h5b) { 
              z->ly()->get_block(q6b_0-z->noab()-z->nvab()+z->ncab()*(p1b_0-z->noab()+z->nvab()*(h5b_0+z->noab()*(h3b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h5b),z->get_range(p1b),z->get_range(q6b),2,0,3,1,+1.0,false); 
             } 
             else if (h5b<=h3b) { 
              z->ly()->get_block(q6b_0-z->noab()-z->nvab()+z->ncab()*(p1b_0-z->noab()+z->nvab()*(h3b_0+z->noab()*(h5b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h3b),z->get_range(p1b),z->get_range(q6b),2,1,3,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             z->v2()->get_block(q2b_1+(z->nab())*(h5b_1+(z->nab())*(q6b_1+(z->nab())*(h4b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(q6b),z->get_range(h5b),z->get_range(q2b),3,0,1,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(q2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),3,1,2,0,-1.0,false); 
         in[1]->add_block(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (h3b>=h4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(q2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),1,3,2,0,+1.0,false); 
         in[1]->add_block(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_22(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
       for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
        if (z->get_spin(h2b)+z->get_spin(q3b)==z->get_spin(p1b)+z->get_spin(p4b)) { 
         if ((z->get_sym(h2b)^(z->get_sym(q3b)^(z->get_sym(p1b)^z->get_sym(p4b))))==z->irrep_v()) { 
          long h2b_0,q3b_0,p1b_0,p4b_0; 
          z->restricted_4(h2b,q3b,p1b,p4b,h2b_0,q3b_0,p1b_0,p4b_0); 
          long p4b_1,q3b_1; 
          z->restricted_2(p4b,q3b,p4b_1,q3b_1); 
          long dim_common=z->get_range(p4b)*z->get_range(q3b); 
          long dima0_sort=z->get_range(h2b)*z->get_range(p1b); 
          long dima0=dim_common*dima0_sort; 
          long dima1_sort=1L; 
          long dima1=dim_common*dima1_sort; 
          if (dima0>0L && dima1>0L) { 
           double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
           double* k_a0=z->mem()->malloc_local_double(dima0); 
           if (p1b<p4b) { 
            z->v2()->get_block(p4b_0+(z->nab())*(p1b_0+(z->nab())*(q3b_0+(z->nab())*(h2b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(q3b),z->get_range(p1b),z->get_range(p4b),2,0,1,3,+1.0,false); 
           } 
           else if (p4b<=p1b) { 
            z->v2()->get_block(p1b_0+(z->nab())*(p4b_0+(z->nab())*(q3b_0+(z->nab())*(h2b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(q3b),z->get_range(p4b),z->get_range(p1b),3,0,1,2,-1.0,false); 
           } 
           z->mem()->free_local_double(k_a0); 
           double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
           double* k_a1=z->mem()->malloc_local_double(dima1); 
           in[2]->get_block(q3b_1-z->noab()-z->nvab()+z->ncab()*(p4b_1-z->noab()),k_a1); 
           z->sort_indices2(k_a1,k_a1_sort,z->get_range(p4b),z->get_range(q3b),1,0,+1.0,false); 
           z->mem()->free_local_double(k_a1); 
           double factor=1.0; 
           z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
           z->mem()->free_local_double(k_a1_sort); 
           z->mem()->free_local_double(k_a0_sort); 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p1b),z->get_range(h2b),1,0,+1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_22_0(){ 
      
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
  long tileoffset; 
  tileoffset=(q3b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q3b)!=4L) { 
    if (z->get_spin(p4b)==z->get_spin(q3b)) { 
     if ((z->get_sym(p4b)^z->get_sym(q3b))==z->irrep_v()) { 
      long dimc=z->get_range(p4b)*z->get_range(q3b); 
      long p4b_0,q3b_0; 
      z->restricted_2(p4b,q3b,p4b_0,q3b_0); 
      long dim_common=1L; 
      long dima0_sort=z->get_range(p4b)*z->get_range(q3b); 
      long dima0=dim_common*dima0_sort; 
      if (dima0>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       kn[0]->get_block(q3b_0-z->noab()-z->nvab()+z->ncab()*(p4b_0-z->noab()),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(q3b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_c=z->mem()->malloc_local_double(dimc); 
       z->sort_indices2(k_a0_sort,k_c,z->get_range(p4b),z->get_range(q3b),0,1,-1.0,false); 
       in[2]->add_block(q3b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),k_c); 
       z->mem()->free_local_double(k_c); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_22_1(){ 
      
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
  long tileoffset; 
  tileoffset=(q3b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q3b)!=4L) { 
    if (z->get_spin(p4b)==z->get_spin(q3b)) { 
     if ((z->get_sym(p4b)^z->get_sym(q3b))==z->irrep_v()) { 
      long dimc=z->get_range(p4b)*z->get_range(q3b); 
      long p4b_0,q3b_0; 
      z->restricted_2(p4b,q3b,p4b_0,q3b_0); 
      long dim_common=1L; 
      long dima0_sort=z->get_range(p4b)*z->get_range(q3b); 
      long dima0=dim_common*dima0_sort; 
      if (dima0>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       kn[10]->get_block(q3b_0-z->noab()-z->nvab()+z->ncab()*(p4b_0-z->noab()),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(q3b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_c=z->mem()->malloc_local_double(dimc); 
       z->sort_indices2(k_a0_sort,k_c,z->get_range(p4b),z->get_range(q3b),0,1,+1.0,false); 
       in[2]->add_block(q3b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),k_c); 
       z->mem()->free_local_double(k_c); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_22(){ 
 
long size=0L; 
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
  if (z->get_spin(p4b)==z->get_spin(q3b)) { 
   if ((z->get_sym(p4b)^z->get_sym(q3b))==z->irrep_v()) { 
    if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q3b)!=4L) { 
     in[2]->input_offset(q3b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),size); 
     size+=z->get_range(p4b)*z->get_range(q3b); 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_23(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^(z->irrep_t()^z->irrep_y()))) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
        for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
         if (z->get_spin(h3b)+z->get_spin(q4b)==z->get_spin(p1b)+z->get_spin(p5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(q4b)^(z->get_sym(p1b)^z->get_sym(p5b))))==z->irrep_v()) { 
           long h3b_0,q4b_0,p1b_0,p5b_0; 
           z->restricted_4(h3b,q4b,p1b,p5b,h3b_0,q4b_0,p1b_0,p5b_0); 
           long h2b_1,p5b_1,h3b_1,q4b_1; 
           z->restricted_4(h2b,p5b,h3b,q4b,h2b_1,p5b_1,h3b_1,q4b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(p5b)*z->get_range(q4b); 
           long dima0_sort=z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (p1b<p5b) { 
             z->v2()->get_block(p5b_0+(z->nab())*(p1b_0+(z->nab())*(q4b_0+(z->nab())*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(q4b),z->get_range(p1b),z->get_range(p5b),2,1,3,0,+1.0,false); 
            } 
            else if (p5b<=p1b) { 
             z->v2()->get_block(p1b_0+(z->nab())*(p5b_0+(z->nab())*(q4b_0+(z->nab())*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(q4b),z->get_range(p5b),z->get_range(p1b),3,1,2,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(q4b_1-z->noab()-z->nvab()+z->ncab()*(h3b_1+z->noab()*(p5b_1-z->noab()+z->nvab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(p5b),z->get_range(h3b),z->get_range(q4b),0,3,1,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,+1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_23_0(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
    long tileoffset; 
    tileoffset=(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p5b)+z->get_spin(h3b)+z->get_spin(q4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(p5b)==z->get_spin(h3b)+z->get_spin(q4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(p5b)^(z->get_sym(h3b)^z->get_sym(q4b))))==(z->irrep_t()^z->irrep_y())) { 
        long dimc=z->get_range(h2b)*z->get_range(p5b)*z->get_range(h3b)*z->get_range(q4b); 
        long h2b_0,p5b_0,h3b_0,q4b_0; 
        z->restricted_4(h2b,p5b,h3b,q4b,h2b_0,p5b_0,h3b_0,q4b_0); 
        long dim_common=1L; 
        long dima0_sort=z->get_range(h2b)*z->get_range(p5b)*z->get_range(h3b)*z->get_range(q4b); 
        long dima0=dim_common*dima0_sort; 
        if (dima0>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         kn[5]->get_block(q4b_0-z->noab()-z->nvab()+z->ncab()*(h3b_0+z->noab()*(p5b_0-z->noab()+z->nvab()*(h2b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(p5b),z->get_range(h3b),z->get_range(q4b),0,1,2,3,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_c=z->mem()->malloc_local_double(dimc); 
         z->sort_indices4(k_a0_sort,k_c,z->get_range(h2b),z->get_range(p5b),z->get_range(h3b),z->get_range(q4b),0,1,2,3,-1.0,false); 
         in[2]->add_block(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b))),k_c); 
         z->mem()->free_local_double(k_c); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_23(){ 
 
long size=0L; 
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
    if (z->get_spin(h2b)+z->get_spin(p5b)==z->get_spin(h3b)+z->get_spin(q4b)) { 
     if ((z->get_sym(h2b)^(z->get_sym(p5b)^(z->get_sym(h3b)^z->get_sym(q4b))))==(z->irrep_t()^z->irrep_y())) { 
      if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p5b)+z->get_spin(h3b)+z->get_spin(q4b)!=8L) { 
       in[2]->input_offset(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b))),size); 
       size+=z->get_range(h2b)*z->get_range(p5b)*z->get_range(h3b)*z->get_range(q4b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_25(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long h4b=0L;h4b<z->noab();++h4b) { 
        if (z->get_spin(h2b)+z->get_spin(h3b)==z->get_spin(h4b)+z->get_spin(p1b)) { 
         if ((z->get_sym(h2b)^(z->get_sym(h3b)^(z->get_sym(h4b)^z->get_sym(p1b))))==z->irrep_v()) { 
          long h2b_0,h3b_0,h4b_0,p1b_0; 
          z->restricted_4(h2b,h3b,h4b,p1b,h2b_0,h3b_0,h4b_0,p1b_0); 
          long h4b_1,h3b_1; 
          z->restricted_2(h4b,h3b,h4b_1,h3b_1); 
          long dim_common=z->get_range(h3b)*z->get_range(h4b); 
          long dima0_sort=z->get_range(h2b)*z->get_range(p1b); 
          long dima0=dim_common*dima0_sort; 
          long dima1_sort=1L; 
          long dima1=dim_common*dima1_sort; 
          if (dima0>0L && dima1>0L) { 
           double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
           double* k_a0=z->mem()->malloc_local_double(dima0); 
           if (h2b<h3b) { 
            z->v2()->get_block(p1b_0+(z->nab())*(h4b_0+(z->nab())*(h3b_0+(z->nab())*(h2b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),3,0,2,1,+1.0,false); 
           } 
           else if (h3b<=h2b) { 
            z->v2()->get_block(p1b_0+(z->nab())*(h4b_0+(z->nab())*(h2b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h2b),z->get_range(h4b),z->get_range(p1b),3,1,2,0,-1.0,false); 
           } 
           z->mem()->free_local_double(k_a0); 
           double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
           double* k_a1=z->mem()->malloc_local_double(dima1); 
           kn[12]->get_block(h3b_1+z->noab()*(h4b_1),k_a1); 
           z->sort_indices2(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(h3b),0,1,+1.0,false); 
           z->mem()->free_local_double(k_a1); 
           double factor=1.0; 
           z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
           z->mem()->free_local_double(k_a1_sort); 
           z->mem()->free_local_double(k_a0_sort); 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p1b),z->get_range(h2b),1,0,+1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_26(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long h4b=h3b;h4b<z->noab();++h4b) { 
        for (long h5b=0L;h5b<z->noab();++h5b) { 
         if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h5b)+z->get_spin(p1b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h5b)^z->get_sym(p1b))))==z->irrep_v()) { 
           long h3b_0,h4b_0,h5b_0,p1b_0; 
           z->restricted_4(h3b,h4b,h5b,p1b,h3b_0,h4b_0,h5b_0,p1b_0); 
           long h2b_1,h5b_1,h3b_1,h4b_1; 
           z->restricted_4(h2b,h5b,h3b,h4b,h2b_1,h5b_1,h3b_1,h4b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h5b); 
           long dima0_sort=z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->v2()->get_block(p1b_0+(z->nab())*(h5b_0+(z->nab())*(h4b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h5b),z->get_range(p1b),3,2,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (h2b<h5b) { 
             kn[14]->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(h5b_1+z->noab()*(h2b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h5b),z->get_range(h3b),z->get_range(h4b),0,1,3,2,+1.0,false); 
            } 
            else if (h5b<=h2b) { 
             kn[14]->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(h2b_1+z->noab()*(h5b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h5b),z->get_range(h2b),z->get_range(h3b),z->get_range(h4b),1,0,3,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h3b==h4b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,-0.5/0.5,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_27(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
       for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
        if (z->get_spin(h2b)+z->get_spin(q3b)==z->get_spin(p1b)+z->get_spin(q4b)) { 
         if ((z->get_sym(h2b)^(z->get_sym(q3b)^(z->get_sym(p1b)^z->get_sym(q4b))))==z->irrep_v()) { 
          long h2b_0,q3b_0,p1b_0,q4b_0; 
          z->restricted_4(h2b,q3b,p1b,q4b,h2b_0,q3b_0,p1b_0,q4b_0); 
          long q4b_1,q3b_1; 
          z->restricted_2(q4b,q3b,q4b_1,q3b_1); 
          long dim_common=z->get_range(q3b)*z->get_range(q4b); 
          long dima0_sort=z->get_range(h2b)*z->get_range(p1b); 
          long dima0=dim_common*dima0_sort; 
          long dima1_sort=1L; 
          long dima1=dim_common*dima1_sort; 
          if (dima0>0L && dima1>0L) { 
           double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
           double* k_a0=z->mem()->malloc_local_double(dima0); 
           z->v2()->get_block(q4b_0+(z->nab())*(p1b_0+(z->nab())*(q3b_0+(z->nab())*(h2b_0))),k_a0); 
           z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(q3b),z->get_range(p1b),z->get_range(q4b),2,0,3,1,+1.0,false); 
           z->mem()->free_local_double(k_a0); 
           double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
           double* k_a1=z->mem()->malloc_local_double(dima1); 
           in[2]->get_block(q3b_1-z->noab()-z->nvab()+z->ncab()*(q4b_1-z->noab()-z->nvab()),k_a1); 
           z->sort_indices2(k_a1,k_a1_sort,z->get_range(q4b),z->get_range(q3b),0,1,+1.0,false); 
           z->mem()->free_local_double(k_a1); 
           double factor=1.0; 
           z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
           z->mem()->free_local_double(k_a1_sort); 
           z->mem()->free_local_double(k_a0_sort); 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p1b),z->get_range(h2b),1,0,+1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_27_0(){ 
      
for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
 for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
  long tileoffset; 
  tileoffset=(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(q4b)+z->get_spin(q3b)!=4L) { 
    if (z->get_spin(q4b)==z->get_spin(q3b)) { 
     if ((z->get_sym(q4b)^z->get_sym(q3b))==z->irrep_v()) { 
      long dimc=z->get_range(q4b)*z->get_range(q3b); 
      long q4b_0,q3b_0; 
      z->restricted_2(q4b,q3b,q4b_0,q3b_0); 
      long dim_common=1L; 
      long dima0_sort=z->get_range(q4b)*z->get_range(q3b); 
      long dima0=dim_common*dima0_sort; 
      if (dima0>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       kn[7]->get_block(q3b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q3b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_c=z->mem()->malloc_local_double(dimc); 
       z->sort_indices2(k_a0_sort,k_c,z->get_range(q4b),z->get_range(q3b),0,1,+1.0,false); 
       in[2]->add_block(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab()),k_c); 
       z->mem()->free_local_double(k_c); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_27_1(){ 
      
for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
 for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
  long tileoffset; 
  tileoffset=(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(q4b)+z->get_spin(q3b)!=4L) { 
    if (z->get_spin(q4b)==z->get_spin(q3b)) { 
     if ((z->get_sym(q4b)^z->get_sym(q3b))==z->irrep_v()) { 
      long dimc=z->get_range(q4b)*z->get_range(q3b); 
      long q4b_0,q3b_0; 
      z->restricted_2(q4b,q3b,q4b_0,q3b_0); 
      long dim_common=1L; 
      long dima0_sort=z->get_range(q4b)*z->get_range(q3b); 
      long dima0=dim_common*dima0_sort; 
      if (dima0>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       kn[8]->get_block(q3b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q3b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_c=z->mem()->malloc_local_double(dimc); 
       z->sort_indices2(k_a0_sort,k_c,z->get_range(q4b),z->get_range(q3b),0,1,+1.0,false); 
       in[2]->add_block(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab()),k_c); 
       z->mem()->free_local_double(k_c); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_27(){ 
 
long size=0L; 
for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
 for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
  if (z->get_spin(q4b)==z->get_spin(q3b)) { 
   if ((z->get_sym(q4b)^z->get_sym(q3b))==z->irrep_v()) { 
    if (!z->restricted() || z->get_spin(q4b)+z->get_spin(q3b)!=4L) { 
     in[2]->input_offset(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab()),size); 
     size+=z->get_range(q4b)*z->get_range(q3b); 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_29(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
       for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
        if (z->get_spin(h2b)+z->get_spin(p3b)==z->get_spin(p1b)+z->get_spin(q4b)) { 
         if ((z->get_sym(h2b)^(z->get_sym(p3b)^(z->get_sym(p1b)^z->get_sym(q4b))))==z->irrep_v()) { 
          long h2b_0,p3b_0,p1b_0,q4b_0; 
          z->restricted_4(h2b,p3b,p1b,q4b,h2b_0,p3b_0,p1b_0,q4b_0); 
          long q4b_1,p3b_1; 
          z->restricted_2(q4b,p3b,q4b_1,p3b_1); 
          long dim_common=z->get_range(p3b)*z->get_range(q4b); 
          long dima0_sort=z->get_range(h2b)*z->get_range(p1b); 
          long dima0=dim_common*dima0_sort; 
          long dima1_sort=1L; 
          long dima1=dim_common*dima1_sort; 
          if (dima0>0L && dima1>0L) { 
           double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
           double* k_a0=z->mem()->malloc_local_double(dima0); 
           z->v2()->get_block(q4b_0+(z->nab())*(p1b_0+(z->nab())*(p3b_0+(z->nab())*(h2b_0))),k_a0); 
           z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(p3b),z->get_range(p1b),z->get_range(q4b),2,0,3,1,+1.0,false); 
           z->mem()->free_local_double(k_a0); 
           double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
           double* k_a1=z->mem()->malloc_local_double(dima1); 
           kn[9]->get_block(p3b_1-z->noab()+z->nvab()*(q4b_1-z->noab()-z->nvab()),k_a1); 
           z->sort_indices2(k_a1,k_a1_sort,z->get_range(q4b),z->get_range(p3b),0,1,+1.0,false); 
           z->mem()->free_local_double(k_a1); 
           double factor=1.0; 
           z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
           z->mem()->free_local_double(k_a1_sort); 
           z->mem()->free_local_double(k_a0_sort); 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p1b),z->get_range(h2b),1,0,+1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_3(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b)))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_y()^z->irrep_e())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h5b=0L;h5b<z->noab();++h5b) { 
         for (long h6b=h5b;h6b<z->noab();++h6b) { 
          if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h5b)+z->get_spin(h6b)) { 
           if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h5b)^z->get_sym(h6b))))==z->irrep_y()) { 
            long h3b_0,h4b_0,h5b_0,h6b_0; 
            z->restricted_4(h3b,h4b,h5b,h6b,h3b_0,h4b_0,h5b_0,h6b_0); 
            long h5b_1,h6b_1,h1b_1,h2b_1; 
            z->restricted_4(h5b,h6b,h1b,h2b,h5b_1,h6b_1,h1b_1,h2b_1); 
            long dim_common=z->get_range(h5b)*z->get_range(h6b); 
            long dima0_sort=z->get_range(h3b)*z->get_range(h4b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h1b)*z->get_range(h2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->glambda2()->get_block(h6b_0+z->noab()*(h5b_0+z->noab()*(h4b_0+z->noab()*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h5b),z->get_range(h6b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             in[2]->get_block(h2b_1+z->noab()*(h1b_1+z->noab()*(h6b_1+z->noab()*(h5b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h5b),z->get_range(h6b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (h5b==h6b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(h1b),z->get_range(h4b),z->get_range(h3b),3,2,1,0,+0.5/0.5,false); 
        in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_31(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
       for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
        if (z->get_spin(h2b)+z->get_spin(p3b)==z->get_spin(p1b)+z->get_spin(p4b)) { 
         if ((z->get_sym(h2b)^(z->get_sym(p3b)^(z->get_sym(p1b)^z->get_sym(p4b))))==z->irrep_v()) { 
          long h2b_0,p3b_0,p1b_0,p4b_0; 
          z->restricted_4(h2b,p3b,p1b,p4b,h2b_0,p3b_0,p1b_0,p4b_0); 
          long p4b_1,p3b_1; 
          z->restricted_2(p4b,p3b,p4b_1,p3b_1); 
          long dim_common=z->get_range(p3b)*z->get_range(p4b); 
          long dima0_sort=z->get_range(h2b)*z->get_range(p1b); 
          long dima0=dim_common*dima0_sort; 
          long dima1_sort=1L; 
          long dima1=dim_common*dima1_sort; 
          if (dima0>0L && dima1>0L) { 
           double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
           double* k_a0=z->mem()->malloc_local_double(dima0); 
           if (p1b<p4b) { 
            z->v2()->get_block(p4b_0+(z->nab())*(p1b_0+(z->nab())*(p3b_0+(z->nab())*(h2b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(p3b),z->get_range(p1b),z->get_range(p4b),2,0,3,1,+1.0,false); 
           } 
           else if (p4b<=p1b) { 
            z->v2()->get_block(p1b_0+(z->nab())*(p4b_0+(z->nab())*(p3b_0+(z->nab())*(h2b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(p3b),z->get_range(p4b),z->get_range(p1b),3,0,2,1,-1.0,false); 
           } 
           z->mem()->free_local_double(k_a0); 
           double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
           double* k_a1=z->mem()->malloc_local_double(dima1); 
           kn[11]->get_block(p3b_1-z->noab()+z->nvab()*(p4b_1-z->noab()),k_a1); 
           z->sort_indices2(k_a1,k_a1_sort,z->get_range(p4b),z->get_range(p3b),0,1,+1.0,false); 
           z->mem()->free_local_double(k_a1); 
           double factor=1.0; 
           z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
           z->mem()->free_local_double(k_a1_sort); 
           z->mem()->free_local_double(k_a0_sort); 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p1b),z->get_range(h2b),1,0,+1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_34(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(h3b)+z->get_spin(q4b)==z->get_spin(p1b)+z->get_spin(q5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(q4b)^(z->get_sym(p1b)^z->get_sym(q5b))))==z->irrep_v()) { 
           long h3b_0,q4b_0,p1b_0,q5b_0; 
           z->restricted_4(h3b,q4b,p1b,q5b,h3b_0,q4b_0,p1b_0,q5b_0); 
           long h2b_1,q5b_1,h3b_1,q4b_1; 
           z->restricted_4(h2b,q5b,h3b,q4b,h2b_1,q5b_1,h3b_1,q4b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(q4b)*z->get_range(q5b); 
           long dima0_sort=z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->v2()->get_block(q5b_0+(z->nab())*(p1b_0+(z->nab())*(q4b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(q4b),z->get_range(p1b),z->get_range(q5b),2,3,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(q4b_1-z->noab()-z->nvab()+z->ncab()*(h3b_1+z->noab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(h3b),z->get_range(q4b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,+1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_34_0(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
    long tileoffset; 
    tileoffset=(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(q4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(q4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(q4b))))==z->irrep_v()) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(q4b); 
        long h2b_0,q5b_0,h3b_0,q4b_0; 
        z->restricted_4(h2b,q5b,h3b,q4b,h2b_0,q5b_0,h3b_0,q4b_0); 
        long dim_common=1L; 
        long dima0_sort=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(q4b); 
        long dima0=dim_common*dima0_sort; 
        if (dima0>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         kn[3]->get_block(q4b_0-z->noab()-z->nvab()+z->ncab()*(h3b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(h2b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(h3b),z->get_range(q4b),0,1,2,3,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_c=z->mem()->malloc_local_double(dimc); 
         z->sort_indices4(k_a0_sort,k_c,z->get_range(h2b),z->get_range(q5b),z->get_range(h3b),z->get_range(q4b),0,1,2,3,-1.0,false); 
         in[2]->add_block(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
         z->mem()->free_local_double(k_c); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_34(){ 
 
long size=0L; 
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
    if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(q4b)) { 
     if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(q4b))))==(z->irrep_e()^z->irrep_y())) { 
      if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(q4b)!=8L) { 
       in[2]->input_offset(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),size); 
       size+=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(q4b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_36(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(h3b)+z->get_spin(p4b)==z->get_spin(p1b)+z->get_spin(q5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(p4b)^(z->get_sym(p1b)^z->get_sym(q5b))))==z->irrep_v()) { 
           long h3b_0,p4b_0,p1b_0,q5b_0; 
           z->restricted_4(h3b,p4b,p1b,q5b,h3b_0,p4b_0,p1b_0,q5b_0); 
           long h2b_1,q5b_1,h3b_1,p4b_1; 
           z->restricted_4(h2b,q5b,h3b,p4b,h2b_1,q5b_1,h3b_1,p4b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(p4b)*z->get_range(q5b); 
           long dima0_sort=z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->v2()->get_block(q5b_0+(z->nab())*(p1b_0+(z->nab())*(p4b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(p4b),z->get_range(p1b),z->get_range(q5b),2,3,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[4]->get_block(p4b_1-z->noab()+z->nvab()*(h3b_1+z->noab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(h3b),z->get_range(p4b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,-1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_38(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
        for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
         if (z->get_spin(h3b)+z->get_spin(p4b)==z->get_spin(p1b)+z->get_spin(p5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(p4b)^(z->get_sym(p1b)^z->get_sym(p5b))))==z->irrep_v()) { 
           long h3b_0,p4b_0,p1b_0,p5b_0; 
           z->restricted_4(h3b,p4b,p1b,p5b,h3b_0,p4b_0,p1b_0,p5b_0); 
           long h2b_1,p5b_1,h3b_1,p4b_1; 
           z->restricted_4(h2b,p5b,h3b,p4b,h2b_1,p5b_1,h3b_1,p4b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(p4b)*z->get_range(p5b); 
           long dima0_sort=z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (p1b<p5b) { 
             z->v2()->get_block(p5b_0+(z->nab())*(p1b_0+(z->nab())*(p4b_0+(z->nab())*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(p4b),z->get_range(p1b),z->get_range(p5b),2,3,1,0,+1.0,false); 
            } 
            else if (p5b<=p1b) { 
             z->v2()->get_block(p1b_0+(z->nab())*(p5b_0+(z->nab())*(p4b_0+(z->nab())*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(p4b),z->get_range(p5b),z->get_range(p1b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[6]->get_block(p4b_1-z->noab()+z->nvab()*(h3b_1+z->noab()*(p5b_1-z->noab()+z->nvab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(p5b),z->get_range(h3b),z->get_range(p4b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,-1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_3_0(){ 
      
for (long h5b=0L;h5b<z->noab();++h5b) { 
 for (long h6b=h5b;h6b<z->noab();++h6b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(h6b+z->noab()*(h5b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h5b)+z->get_spin(h6b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(h5b)+z->get_spin(h6b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(h5b)^(z->get_sym(h6b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
        long dimc=z->get_range(h5b)*z->get_range(h6b)*z->get_range(h1b)*z->get_range(h2b); 
        long h5b_0,h6b_0,h1b_0,h2b_0; 
        z->restricted_4(h5b,h6b,h1b,h2b,h5b_0,h6b_0,h1b_0,h2b_0); 
        long dim_common=1L; 
        long dima0_sort=z->get_range(h5b)*z->get_range(h6b)*z->get_range(h1b)*z->get_range(h2b); 
        long dima0=dim_common*dima0_sort; 
        if (dima0>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->bs2()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(h6b_0+z->noab()*(h5b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h6b),z->get_range(h1b),z->get_range(h2b),0,1,2,3,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_c=z->mem()->malloc_local_double(dimc); 
         z->sort_indices4(k_a0_sort,k_c,z->get_range(h5b),z->get_range(h6b),z->get_range(h1b),z->get_range(h2b),0,1,2,3,+1.0,false); 
         in[2]->add_block(h2b+z->noab()*(h1b+z->noab()*(h6b+z->noab()*(h5b))),k_c); 
         z->mem()->free_local_double(k_c); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_3_1(){ 
      
for (long h5b=0L;h5b<z->noab();++h5b) { 
 for (long h6b=h5b;h6b<z->noab();++h6b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(h6b+z->noab()*(h5b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h5b)+z->get_spin(h6b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(h5b)+z->get_spin(h6b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(h5b)^(z->get_sym(h6b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
        long dimc=z->get_range(h5b)*z->get_range(h6b)*z->get_range(h1b)*z->get_range(h2b); 
        long h5b_0,h6b_0,h1b_0,h2b_0; 
        z->restricted_4(h5b,h6b,h1b,h2b,h5b_0,h6b_0,h1b_0,h2b_0); 
        long dim_common=1L; 
        long dima0_sort=z->get_range(h5b)*z->get_range(h6b)*z->get_range(h1b)*z->get_range(h2b); 
        long dima0=dim_common*dima0_sort; 
        if (dima0>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->ps2()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(h6b_0+z->noab()*(h5b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h6b),z->get_range(h1b),z->get_range(h2b),0,1,2,3,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_c=z->mem()->malloc_local_double(dimc); 
         z->sort_indices4(k_a0_sort,k_c,z->get_range(h5b),z->get_range(h6b),z->get_range(h1b),z->get_range(h2b),0,1,2,3,+1.0,false); 
         in[2]->add_block(h2b+z->noab()*(h1b+z->noab()*(h6b+z->noab()*(h5b))),k_c); 
         z->mem()->free_local_double(k_c); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_3(){ 
 
long size=0L; 
for (long h5b=0L;h5b<z->noab();++h5b) { 
 for (long h6b=h5b;h6b<z->noab();++h6b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    if (z->get_spin(h5b)+z->get_spin(h6b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
     if ((z->get_sym(h5b)^(z->get_sym(h6b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
      if (!z->restricted() || z->get_spin(h5b)+z->get_spin(h6b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
       in[2]->input_offset(h2b+z->noab()*(h1b+z->noab()*(h6b+z->noab()*(h5b))),size); 
       size+=z->get_range(h5b)*z->get_range(h6b)*z->get_range(h1b)*z->get_range(h2b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_4(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_f()^z->irrep_v())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       if (z->get_spin(h3b)==z->get_spin(p1b)) { 
        if ((z->get_sym(h3b)^z->get_sym(p1b))==z->irrep_f()) { 
         long h3b_0,p1b_0; 
         z->restricted_2(h3b,p1b,h3b_0,p1b_0); 
         long h2b_1,h3b_1; 
         z->restricted_2(h2b,h3b,h2b_1,h3b_1); 
         long dim_common=z->get_range(h3b); 
         long dima0_sort=z->get_range(p1b); 
         long dima0=dim_common*dima0_sort; 
         long dima1_sort=z->get_range(h2b); 
         long dima1=dim_common*dima1_sort; 
         if (dima0>0L && dima1>0L) { 
          double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
          double* k_a0=z->mem()->malloc_local_double(dima0); 
          z->f1()->get_block(p1b_0+(z->nab())*(h3b_0),k_a0); 
          z->sort_indices2(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(p1b),1,0,+1.0,false); 
          z->mem()->free_local_double(k_a0); 
          double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
          double* k_a1=z->mem()->malloc_local_double(dima1); 
          kn[12]->get_block(h3b_1+z->noab()*(h2b_1),k_a1); 
          z->sort_indices2(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h3b),0,1,+1.0,false); 
          z->mem()->free_local_double(k_a1); 
          double factor=1.0; 
          z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
          z->mem()->free_local_double(k_a1_sort); 
          z->mem()->free_local_double(k_a0_sort); 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,-1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_40(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^(z->irrep_t()^z->irrep_v()))) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
        if (z->get_spin(h2b)+z->get_spin(h3b)==z->get_spin(p1b)+z->get_spin(p4b)) { 
         if ((z->get_sym(h2b)^(z->get_sym(h3b)^(z->get_sym(p1b)^z->get_sym(p4b))))==z->irrep_v()) { 
          long h2b_0,h3b_0,p1b_0,p4b_0; 
          z->restricted_4(h2b,h3b,p1b,p4b,h2b_0,h3b_0,p1b_0,p4b_0); 
          long p4b_1,h3b_1; 
          z->restricted_2(p4b,h3b,p4b_1,h3b_1); 
          long dim_common=z->get_range(h3b)*z->get_range(p4b); 
          long dima0_sort=z->get_range(h2b)*z->get_range(p1b); 
          long dima0=dim_common*dima0_sort; 
          long dima1_sort=1L; 
          long dima1=dim_common*dima1_sort; 
          if (dima0>0L && dima1>0L) { 
           double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
           double* k_a0=z->mem()->malloc_local_double(dima0); 
           if (h2b<h3b && p1b<p4b) { 
            z->v2()->get_block(p4b_0+(z->nab())*(p1b_0+(z->nab())*(h3b_0+(z->nab())*(h2b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(h3b),z->get_range(p1b),z->get_range(p4b),2,0,3,1,+1.0,false); 
           } 
           else if (h2b<h3b && p4b<=p1b) { 
            z->v2()->get_block(p1b_0+(z->nab())*(p4b_0+(z->nab())*(h3b_0+(z->nab())*(h2b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(h3b),z->get_range(p4b),z->get_range(p1b),3,0,2,1,-1.0,false); 
           } 
           else if (h3b<=h2b && p1b<p4b) { 
            z->v2()->get_block(p4b_0+(z->nab())*(p1b_0+(z->nab())*(h2b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h2b),z->get_range(p1b),z->get_range(p4b),2,1,3,0,-1.0,false); 
           } 
           else if (h3b<=h2b && p4b<=p1b) { 
            z->v2()->get_block(p1b_0+(z->nab())*(p4b_0+(z->nab())*(h2b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h2b),z->get_range(p4b),z->get_range(p1b),3,1,2,0,+1.0,false); 
           } 
           z->mem()->free_local_double(k_a0); 
           double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
           double* k_a1=z->mem()->malloc_local_double(dima1); 
           in[2]->get_block(h3b_1+z->noab()*(p4b_1-z->noab()),k_a1); 
           z->sort_indices2(k_a1,k_a1_sort,z->get_range(p4b),z->get_range(h3b),0,1,+1.0,false); 
           z->mem()->free_local_double(k_a1); 
           double factor=1.0; 
           z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
           z->mem()->free_local_double(k_a1_sort); 
           z->mem()->free_local_double(k_a0_sort); 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p1b),z->get_range(h2b),1,0,+1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_40_0(){ 
      
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long h3b=0L;h3b<z->noab();++h3b) { 
  long tileoffset; 
  tileoffset=(h3b+z->noab()*(p4b-z->noab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p4b)+z->get_spin(h3b)!=4L) { 
    if (z->get_spin(p4b)==z->get_spin(h3b)) { 
     if ((z->get_sym(p4b)^z->get_sym(h3b))==(z->irrep_t()^z->irrep_v())) { 
      long dimc=z->get_range(p4b)*z->get_range(h3b); 
      long p4b_0,h3b_0; 
      z->restricted_2(p4b,h3b,p4b_0,h3b_0); 
      long dim_common=1L; 
      long dima0_sort=z->get_range(p4b)*z->get_range(h3b); 
      long dima0=dim_common*dima0_sort; 
      if (dima0>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       kn[13]->get_block(h3b_0+z->noab()*(p4b_0-z->noab()),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(h3b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_c=z->mem()->malloc_local_double(dimc); 
       z->sort_indices2(k_a0_sort,k_c,z->get_range(p4b),z->get_range(h3b),0,1,-1.0,false); 
       in[2]->add_block(h3b+z->noab()*(p4b-z->noab()),k_c); 
       z->mem()->free_local_double(k_c); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_40(){ 
 
long size=0L; 
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long h3b=0L;h3b<z->noab();++h3b) { 
  if (z->get_spin(p4b)==z->get_spin(h3b)) { 
   if ((z->get_sym(p4b)^z->get_sym(h3b))==(z->irrep_t()^z->irrep_v())) { 
    if (!z->restricted() || z->get_spin(p4b)+z->get_spin(h3b)!=4L) { 
     in[2]->input_offset(h3b+z->noab()*(p4b-z->noab()),size); 
     size+=z->get_range(p4b)*z->get_range(h3b); 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_41(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^(z->irrep_t()^z->irrep_v()))) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long h4b=h3b;h4b<z->noab();++h4b) { 
        for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
         if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(p5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(p5b))))==z->irrep_v()) { 
           long h3b_0,h4b_0,p1b_0,p5b_0; 
           z->restricted_4(h3b,h4b,p1b,p5b,h3b_0,h4b_0,p1b_0,p5b_0); 
           long h2b_1,p5b_1,h3b_1,h4b_1; 
           z->restricted_4(h2b,p5b,h3b,h4b,h2b_1,p5b_1,h3b_1,h4b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p5b); 
           long dima0_sort=z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (p1b<p5b) { 
             z->v2()->get_block(p5b_0+(z->nab())*(p1b_0+(z->nab())*(h4b_0+(z->nab())*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(p5b),2,3,1,0,+1.0,false); 
            } 
            else if (p5b<=p1b) { 
             z->v2()->get_block(p1b_0+(z->nab())*(p5b_0+(z->nab())*(h4b_0+(z->nab())*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p5b),z->get_range(p1b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(p5b_1-z->noab()+z->nvab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(p5b),z->get_range(h3b),z->get_range(h4b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h3b==h4b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,+0.5/0.5,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_41(){ 
 
long size=0L; 
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    if (z->get_spin(h2b)+z->get_spin(p5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
     if ((z->get_sym(h2b)^(z->get_sym(p5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_t()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
       in[2]->input_offset(h4b+z->noab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b))),size); 
       size+=z->get_range(h2b)*z->get_range(p5b)*z->get_range(h3b)*z->get_range(h4b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_42(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^(z->irrep_e()^z->irrep_v()))) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
        if (z->get_spin(h2b)+z->get_spin(h3b)==z->get_spin(p1b)+z->get_spin(q4b)) { 
         if ((z->get_sym(h2b)^(z->get_sym(h3b)^(z->get_sym(p1b)^z->get_sym(q4b))))==z->irrep_v()) { 
          long h2b_0,h3b_0,p1b_0,q4b_0; 
          z->restricted_4(h2b,h3b,p1b,q4b,h2b_0,h3b_0,p1b_0,q4b_0); 
          long q4b_1,h3b_1; 
          z->restricted_2(q4b,h3b,q4b_1,h3b_1); 
          long dim_common=z->get_range(h3b)*z->get_range(q4b); 
          long dima0_sort=z->get_range(h2b)*z->get_range(p1b); 
          long dima0=dim_common*dima0_sort; 
          long dima1_sort=1L; 
          long dima1=dim_common*dima1_sort; 
          if (dima0>0L && dima1>0L) { 
           double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
           double* k_a0=z->mem()->malloc_local_double(dima0); 
           if (h2b<h3b) { 
            z->v2()->get_block(q4b_0+(z->nab())*(p1b_0+(z->nab())*(h3b_0+(z->nab())*(h2b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(h3b),z->get_range(p1b),z->get_range(q4b),2,0,3,1,+1.0,false); 
           } 
           else if (h3b<=h2b) { 
            z->v2()->get_block(q4b_0+(z->nab())*(p1b_0+(z->nab())*(h2b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h2b),z->get_range(p1b),z->get_range(q4b),2,1,3,0,-1.0,false); 
           } 
           z->mem()->free_local_double(k_a0); 
           double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
           double* k_a1=z->mem()->malloc_local_double(dima1); 
           in[2]->get_block(h3b_1+z->noab()*(q4b_1-z->noab()-z->nvab()),k_a1); 
           z->sort_indices2(k_a1,k_a1_sort,z->get_range(q4b),z->get_range(h3b),0,1,+1.0,false); 
           z->mem()->free_local_double(k_a1); 
           double factor=1.0; 
           z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
           z->mem()->free_local_double(k_a1_sort); 
           z->mem()->free_local_double(k_a0_sort); 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p1b),z->get_range(h2b),1,0,+1.0,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_42(){ 
 
long size=0L; 
for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
 for (long h3b=0L;h3b<z->noab();++h3b) { 
  if (z->get_spin(q4b)==z->get_spin(h3b)) { 
   if ((z->get_sym(q4b)^z->get_sym(h3b))==(z->irrep_e()^z->irrep_v())) { 
    if (!z->restricted() || z->get_spin(q4b)+z->get_spin(h3b)!=4L) { 
     in[2]->input_offset(h3b+z->noab()*(q4b-z->noab()-z->nvab()),size); 
     size+=z->get_range(q4b)*z->get_range(h3b); 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_44(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_v()^(z->irrep_e()^z->irrep_v()))) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long h4b=h3b;h4b<z->noab();++h4b) { 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q5b))))==z->irrep_v()) { 
           long h3b_0,h4b_0,p1b_0,q5b_0; 
           z->restricted_4(h3b,h4b,p1b,q5b,h3b_0,h4b_0,p1b_0,q5b_0); 
           long h2b_1,q5b_1,h3b_1,h4b_1; 
           z->restricted_4(h2b,q5b,h3b,h4b,h2b_1,q5b_1,h3b_1,h4b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(h4b)*z->get_range(q5b); 
           long dima0_sort=z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->v2()->get_block(q5b_0+(z->nab())*(p1b_0+(z->nab())*(h4b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(q5b),2,3,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(h3b),z->get_range(h4b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h3b==h4b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,+0.5/0.5,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_44(){ 
 
long size=0L; 
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
     if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_e()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
       in[2]->input_offset(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),size); 
       size+=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_46(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b)))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^(z->irrep_y()^(z->irrep_t()^z->irrep_v())))) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h5b=0L;h5b<z->noab();++h5b) { 
         for (long h6b=h5b;h6b<z->noab();++h6b) { 
          if (z->get_spin(h5b)+z->get_spin(h6b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
           if ((z->get_sym(h5b)^(z->get_sym(h6b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
            long h5b_0,h6b_0,h1b_0,h2b_0; 
            z->restricted_4(h5b,h6b,h1b,h2b,h5b_0,h6b_0,h1b_0,h2b_0); 
            long h3b_1,h4b_1,h5b_1,h6b_1; 
            z->restricted_4(h3b,h4b,h5b,h6b,h3b_1,h4b_1,h5b_1,h6b_1); 
            long dim_common=z->get_range(h5b)*z->get_range(h6b); 
            long dima0_sort=z->get_range(h1b)*z->get_range(h2b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h3b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->xs2()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(h6b_0+z->noab()*(h5b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h6b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             in[2]->get_block(h6b_1+z->noab()*(h5b_1+z->noab()*(h4b_1+z->noab()*(h3b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h5b),z->get_range(h6b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (h5b==h6b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h3b),z->get_range(h2b),z->get_range(h1b),1,0,3,2,+0.5/0.5,false); 
        in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_46(){ 
 
long size=0L; 
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h5b=0L;h5b<z->noab();++h5b) { 
   for (long h6b=h5b;h6b<z->noab();++h6b) { 
    if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h5b)+z->get_spin(h6b)) { 
     if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h5b)^z->get_sym(h6b))))==(z->irrep_y()^(z->irrep_t()^z->irrep_v()))) { 
      if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h5b)+z->get_spin(h6b)!=8L) { 
       in[2]->input_offset(h6b+z->noab()*(h5b+z->noab()*(h4b+z->noab()*(h3b))),size); 
       size+=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h5b)*z->get_range(h6b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_48(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
    long tileoffset; 
    if (p1b<p2b) { 
     tileoffset=(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (p2b<=p1b) { 
     tileoffset=(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(p2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(p2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(p2b))))==(z->irrep_v()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(p2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q5b))))==z->irrep_v()) { 
           long h3b_0,h4b_0,p1b_0,q5b_0; 
           z->restricted_4(h3b,h4b,p1b,q5b,h3b_0,h4b_0,p1b_0,q5b_0); 
           long q5b_1,p2b_1; 
           z->restricted_2(q5b,p2b,q5b_1,p2b_1); 
           long dim_common=z->get_range(q5b); 
           long dima0_sort=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->v2()->get_block(q5b_0+(z->nab())*(p1b_0+(z->nab())*(h4b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(q5b),2,1,0,3,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[9]->get_block(p2b_1-z->noab()+z->nvab()*(q5b_1-z->noab()-z->nvab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(q5b),z->get_range(p2b),1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (p2b>=p1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(p1b),z->get_range(h4b),z->get_range(h3b),3,2,1,0,-1.0,false); 
         in[1]->add_block(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (p1b>=p2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(p1b),z->get_range(h4b),z->get_range(h3b),3,2,0,1,+1.0,false); 
         in[1]->add_block(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_49(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (p3b<p4b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab())))); 
    } 
    else if (p4b<=p3b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab())))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(p4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(p4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(p4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_t()^z->irrep_v())) { 
        long dimc=z->get_range(p3b)*z->get_range(p4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
         if (z->get_spin(p3b)+z->get_spin(p5b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
          if ((z->get_sym(p3b)^(z->get_sym(p5b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_t()) { 
           long p3b_0,p5b_0,h1b_0,h2b_0; 
           z->restricted_4(p3b,p5b,h1b,h2b,p3b_0,p5b_0,h1b_0,h2b_0); 
           long p4b_1,p5b_1; 
           z->restricted_2(p4b,p5b,p4b_1,p5b_1); 
           long dim_common=z->get_range(p5b); 
           long dima0_sort=z->get_range(p3b)*z->get_range(h1b)*z->get_range(h2b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (p3b<p5b) { 
             z->t2()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(p5b_0-z->noab()+z->nvab()*(p3b_0-z->noab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(p5b),z->get_range(h1b),z->get_range(h2b),3,2,0,1,+1.0,false); 
            } 
            else if (p5b<=p3b) { 
             z->t2()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(p3b_0-z->noab()+z->nvab()*(p5b_0-z->noab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(p3b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[11]->get_block(p5b_1-z->noab()+z->nvab()*(p4b_1-z->noab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(p4b),z->get_range(p5b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (p4b>=p3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p4b),z->get_range(h2b),z->get_range(h1b),z->get_range(p3b),3,0,2,1,-1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab()))),k_c); 
        } 
        if (p3b>=p4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p4b),z->get_range(h2b),z->get_range(h1b),z->get_range(p3b),0,3,2,1,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab()))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_5(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_y()^(z->irrep_e()^z->irrep_f()))) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long h4b=h3b;h4b<z->noab();++h4b) { 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q5b))))==z->irrep_y()) { 
           long h3b_0,h4b_0,p1b_0,q5b_0; 
           z->restricted_4(h3b,h4b,p1b,q5b,h3b_0,h4b_0,p1b_0,q5b_0); 
           long h2b_1,q5b_1,h3b_1,h4b_1; 
           z->restricted_4(h2b,q5b,h3b,h4b,h2b_1,q5b_1,h3b_1,h4b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(h4b)*z->get_range(q5b); 
           long dima0_sort=z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->ly()->get_block(q5b_0-z->noab()-z->nvab()+z->ncab()*(p1b_0-z->noab()+z->nvab()*(h4b_0+z->noab()*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(q5b),2,3,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(h3b),z->get_range(h4b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h3b==h4b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h2b),z->get_range(p1b),0,1,+0.5/0.5,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_50(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=0L;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
    long tileoffset; 
    if (h3b<h4b && p1b<p2b) { 
     tileoffset=(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (h3b<h4b && p2b<=p1b) { 
     tileoffset=(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (h4b<=h3b && p1b<p2b) { 
     tileoffset=(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b)))); 
    } 
    else if (h4b<=h3b && p2b<=p1b) { 
     tileoffset=(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b)))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(p2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(p2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(p2b))))==(z->irrep_v()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(p2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h5b=0L;h5b<z->noab();++h5b) { 
         for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
          if (z->get_spin(h3b)+z->get_spin(h5b)==z->get_spin(p1b)+z->get_spin(q6b)) { 
           if ((z->get_sym(h3b)^(z->get_sym(h5b)^(z->get_sym(p1b)^z->get_sym(q6b))))==z->irrep_v()) { 
            long h3b_0,h5b_0,p1b_0,q6b_0; 
            z->restricted_4(h3b,h5b,p1b,q6b,h3b_0,h5b_0,p1b_0,q6b_0); 
            long h4b_1,q6b_1,h5b_1,p2b_1; 
            z->restricted_4(h4b,q6b,h5b,p2b,h4b_1,q6b_1,h5b_1,p2b_1); 
            long dim_common=z->get_range(h5b)*z->get_range(q6b); 
            long dima0_sort=z->get_range(h3b)*z->get_range(p1b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h4b)*z->get_range(p2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h3b<h5b) { 
              z->v2()->get_block(q6b_0+(z->nab())*(p1b_0+(z->nab())*(h5b_0+(z->nab())*(h3b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h5b),z->get_range(p1b),z->get_range(q6b),2,0,3,1,+1.0,false); 
             } 
             else if (h5b<=h3b) { 
              z->v2()->get_block(q6b_0+(z->nab())*(p1b_0+(z->nab())*(h3b_0+(z->nab())*(h5b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h3b),z->get_range(p1b),z->get_range(q6b),2,1,3,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             kn[4]->get_block(p2b_1-z->noab()+z->nvab()*(h5b_1+z->noab()*(q6b_1-z->noab()-z->nvab()+z->ncab()*(h4b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(q6b),z->get_range(h5b),z->get_range(p2b),3,0,1,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b && p2b>=p1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),3,1,2,0,+1.0,false); 
         in[1]->add_block(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (h4b>=h3b && p1b>=p2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),3,1,0,2,-1.0,false); 
         in[1]->add_block(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (h3b>=h4b && p2b>=p1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),1,3,2,0,-1.0,false); 
         in[1]->add_block(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b))),k_c); 
        } 
        if (h3b>=h4b && p1b>=p2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(h4b),z->get_range(p1b),z->get_range(h3b),1,3,0,2,+1.0,false); 
         in[1]->add_block(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_51(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=0L;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (p3b<p4b && h1b<h2b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab())))); 
    } 
    else if (p3b<p4b && h2b<=h1b) { 
     tileoffset=(h1b+z->noab()*(h2b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab())))); 
    } 
    else if (p4b<=p3b && h1b<h2b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab())))); 
    } 
    else if (p4b<=p3b && h2b<=h1b) { 
     tileoffset=(h1b+z->noab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab())))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(p4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(p4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(p4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_t()^z->irrep_v())) { 
        long dimc=z->get_range(p3b)*z->get_range(p4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h6b=0L;h6b<z->noab();++h6b) { 
         for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
          if (z->get_spin(p3b)+z->get_spin(p5b)==z->get_spin(h1b)+z->get_spin(h6b)) { 
           if ((z->get_sym(p3b)^(z->get_sym(p5b)^(z->get_sym(h1b)^z->get_sym(h6b))))==z->irrep_t()) { 
            long p3b_0,p5b_0,h1b_0,h6b_0; 
            z->restricted_4(p3b,p5b,h1b,h6b,p3b_0,p5b_0,h1b_0,h6b_0); 
            long h6b_1,p4b_1,h2b_1,p5b_1; 
            z->restricted_4(h6b,p4b,h2b,p5b,h6b_1,p4b_1,h2b_1,p5b_1); 
            long dim_common=z->get_range(h6b)*z->get_range(p5b); 
            long dima0_sort=z->get_range(p3b)*z->get_range(h1b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(p4b)*z->get_range(h2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (p3b<p5b && h1b<h6b) { 
              z->t2()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(p5b_0-z->noab()+z->nvab()*(p3b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(p5b),z->get_range(h1b),z->get_range(h6b),2,0,1,3,+1.0,false); 
             } 
             else if (p3b<p5b && h6b<=h1b) { 
              z->t2()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(p5b_0-z->noab()+z->nvab()*(p3b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(p5b),z->get_range(h6b),z->get_range(h1b),3,0,1,2,-1.0,false); 
             } 
             else if (p5b<=p3b && h1b<h6b) { 
              z->t2()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(p3b_0-z->noab()+z->nvab()*(p5b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(p3b),z->get_range(h1b),z->get_range(h6b),2,1,0,3,-1.0,false); 
             } 
             else if (p5b<=p3b && h6b<=h1b) { 
              z->t2()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(p3b_0-z->noab()+z->nvab()*(p5b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(p3b),z->get_range(h6b),z->get_range(h1b),3,1,0,2,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             kn[6]->get_block(p5b_1-z->noab()+z->nvab()*(h2b_1+z->noab()*(p4b_1-z->noab()+z->nvab()*(h6b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(p4b),z->get_range(h2b),z->get_range(p5b),2,1,3,0,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (p4b>=p3b && h2b>=h1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p4b),z->get_range(h1b),z->get_range(p3b),3,1,2,0,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab()))),k_c); 
        } 
        if (p4b>=p3b && h1b>=h2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p4b),z->get_range(h1b),z->get_range(p3b),3,1,0,2,-1.0,false); 
         in[1]->add_block(h1b+z->noab()*(h2b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab()))),k_c); 
        } 
        if (p3b>=p4b && h2b>=h1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p4b),z->get_range(h1b),z->get_range(p3b),1,3,2,0,-1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab()))),k_c); 
        } 
        if (p3b>=p4b && h1b>=h2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p4b),z->get_range(h1b),z->get_range(p3b),1,3,0,2,+1.0,false); 
         in[1]->add_block(h1b+z->noab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab()))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_52(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
    long tileoffset; 
    if (p1b<p2b) { 
     tileoffset=(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (p2b<=p1b) { 
     tileoffset=(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(p2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(p2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(p2b))))==(z->irrep_y()^(z->irrep_e()^z->irrep_v()))) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(p2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q5b))))==z->irrep_y()) { 
           long h3b_0,h4b_0,p1b_0,q5b_0; 
           z->restricted_4(h3b,h4b,p1b,q5b,h3b_0,h4b_0,p1b_0,q5b_0); 
           long q5b_1,p2b_1; 
           z->restricted_2(q5b,p2b,q5b_1,p2b_1); 
           long dim_common=z->get_range(q5b); 
           long dima0_sort=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->ly()->get_block(q5b_0-z->noab()-z->nvab()+z->ncab()*(p1b_0-z->noab()+z->nvab()*(h4b_0+z->noab()*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(q5b),2,1,0,3,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(p2b_1-z->noab()+z->nvab()*(q5b_1-z->noab()-z->nvab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(q5b),z->get_range(p2b),1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (p2b>=p1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(p1b),z->get_range(h4b),z->get_range(h3b),3,2,1,0,+1.0,false); 
         in[1]->add_block(p2b-z->noab()+z->nvab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (p1b>=p2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p2b),z->get_range(p1b),z->get_range(h4b),z->get_range(h3b),3,2,0,1,-1.0,false); 
         in[1]->add_block(p1b-z->noab()+z->nvab()*(p2b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_52(){ 
 
long size=0L; 
for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
 for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
  if (z->get_spin(q5b)==z->get_spin(p2b)) { 
   if ((z->get_sym(q5b)^z->get_sym(p2b))==(z->irrep_e()^z->irrep_v())) { 
    if (!z->restricted() || z->get_spin(q5b)+z->get_spin(p2b)!=4L) { 
     in[2]->input_offset(p2b-z->noab()+z->nvab()*(q5b-z->noab()-z->nvab()),size); 
     size+=z->get_range(q5b)*z->get_range(p2b); 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_53(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (p3b<p4b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab())))); 
    } 
    else if (p4b<=p3b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab())))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(p4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(p4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(p4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(p3b)*z->get_range(p4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(p3b)+z->get_spin(q5b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
          if ((z->get_sym(p3b)^(z->get_sym(q5b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
           long p3b_0,q5b_0,h1b_0,h2b_0; 
           z->restricted_4(p3b,q5b,h1b,h2b,p3b_0,q5b_0,h1b_0,h2b_0); 
           long p4b_1,q5b_1; 
           z->restricted_2(p4b,q5b,p4b_1,q5b_1); 
           long dim_common=z->get_range(q5b); 
           long dima0_sort=z->get_range(p3b)*z->get_range(h1b)*z->get_range(h2b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->qy()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q5b),z->get_range(h1b),z->get_range(h2b),3,2,0,1,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(p4b_1-z->noab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(p4b),z->get_range(q5b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (p4b>=p3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p4b),z->get_range(h2b),z->get_range(h1b),z->get_range(p3b),3,0,2,1,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab()))),k_c); 
        } 
        if (p3b>=p4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p4b),z->get_range(h2b),z->get_range(h1b),z->get_range(p3b),0,3,2,1,-1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab()))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_53_0(){ 
      
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  long tileoffset; 
  tileoffset=(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q5b)!=4L) { 
    if (z->get_spin(p4b)==z->get_spin(q5b)) { 
     if ((z->get_sym(p4b)^z->get_sym(q5b))==z->irrep_v()) { 
      long dimc=z->get_range(p4b)*z->get_range(q5b); 
      long p4b_0,q5b_0; 
      z->restricted_2(p4b,q5b,p4b_0,q5b_0); 
      long dim_common=1L; 
      long dima0_sort=z->get_range(p4b)*z->get_range(q5b); 
      long dima0=dim_common*dima0_sort; 
      if (dima0>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       kn[0]->get_block(q5b_0-z->noab()-z->nvab()+z->ncab()*(p4b_0-z->noab()),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(q5b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_c=z->mem()->malloc_local_double(dimc); 
       z->sort_indices2(k_a0_sort,k_c,z->get_range(p4b),z->get_range(q5b),0,1,+1.0,false); 
       in[2]->add_block(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),k_c); 
       z->mem()->free_local_double(k_c); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_53_1(){ 
      
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  long tileoffset; 
  tileoffset=(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q5b)!=4L) { 
    if (z->get_spin(p4b)==z->get_spin(q5b)) { 
     if ((z->get_sym(p4b)^z->get_sym(q5b))==z->irrep_v()) { 
      long dimc=z->get_range(p4b)*z->get_range(q5b); 
      long p4b_0,q5b_0; 
      z->restricted_2(p4b,q5b,p4b_0,q5b_0); 
      long dim_common=1L; 
      long dima0_sort=z->get_range(p4b)*z->get_range(q5b); 
      long dima0=dim_common*dima0_sort; 
      if (dima0>0L) { 
       double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
       double* k_a0=z->mem()->malloc_local_double(dima0); 
       kn[10]->get_block(q5b_0-z->noab()-z->nvab()+z->ncab()*(p4b_0-z->noab()),k_a0); 
       z->sort_indices2(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(q5b),0,1,+1.0,false); 
       z->mem()->free_local_double(k_a0); 
       double* k_c=z->mem()->malloc_local_double(dimc); 
       z->sort_indices2(k_a0_sort,k_c,z->get_range(p4b),z->get_range(q5b),0,1,-1.0,false); 
       in[2]->add_block(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),k_c); 
       z->mem()->free_local_double(k_c); 
       z->mem()->free_local_double(k_a0_sort); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_53(){ 
 
long size=0L; 
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  if (z->get_spin(p4b)==z->get_spin(q5b)) { 
   if ((z->get_sym(p4b)^z->get_sym(q5b))==z->irrep_v()) { 
    if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q5b)!=4L) { 
     in[2]->input_offset(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),size); 
     size+=z->get_range(p4b)*z->get_range(q5b); 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_54(){ 
      
for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=0L;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (q3b<q4b && h1b<h2b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(q3b-z->noab()-z->nvab())))); 
    } 
    else if (q3b<q4b && h2b<=h1b) { 
     tileoffset=(h1b+z->noab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(q3b-z->noab()-z->nvab())))); 
    } 
    else if (q4b<=q3b && h1b<h2b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab())))); 
    } 
    else if (q4b<=q3b && h2b<=h1b) { 
     tileoffset=(h1b+z->noab()*(h2b+z->noab()*(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab())))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(q3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(q3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(q3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(q3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h6b=0L;h6b<z->noab();++h6b) { 
         for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
          if (z->get_spin(q3b)+z->get_spin(q5b)==z->get_spin(h1b)+z->get_spin(h6b)) { 
           if ((z->get_sym(q3b)^(z->get_sym(q5b)^(z->get_sym(h1b)^z->get_sym(h6b))))==z->irrep_e()) { 
            long q3b_0,q5b_0,h1b_0,h6b_0; 
            z->restricted_4(q3b,q5b,h1b,h6b,q3b_0,q5b_0,h1b_0,h6b_0); 
            long h6b_1,q4b_1,h2b_1,q5b_1; 
            z->restricted_4(h6b,q4b,h2b,q5b,h6b_1,q4b_1,h2b_1,q5b_1); 
            long dim_common=z->get_range(h6b)*z->get_range(q5b); 
            long dima0_sort=z->get_range(q3b)*z->get_range(h1b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(q4b)*z->get_range(h2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (q3b<q5b && h1b<h6b) { 
              z->qx()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q3b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q3b),z->get_range(q5b),z->get_range(h1b),z->get_range(h6b),2,0,1,3,+1.0,false); 
             } 
             else if (q3b<q5b && h6b<=h1b) { 
              z->qx()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q3b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q3b),z->get_range(q5b),z->get_range(h6b),z->get_range(h1b),3,0,1,2,-1.0,false); 
             } 
             else if (q5b<=q3b && h1b<h6b) { 
              z->qx()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(q3b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q3b),z->get_range(h1b),z->get_range(h6b),2,1,0,3,-1.0,false); 
             } 
             else if (q5b<=q3b && h6b<=h1b) { 
              z->qx()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(q3b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q3b),z->get_range(h6b),z->get_range(h1b),3,1,0,2,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             kn[3]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(h2b_1+z->noab()*(q4b_1-z->noab()-z->nvab()+z->ncab()*(h6b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(q4b),z->get_range(h2b),z->get_range(q5b),2,1,3,0,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (q4b>=q3b && h2b>=h1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(q4b),z->get_range(h1b),z->get_range(q3b),3,1,2,0,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(q3b-z->noab()-z->nvab()))),k_c); 
        } 
        if (q4b>=q3b && h1b>=h2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(q4b),z->get_range(h1b),z->get_range(q3b),3,1,0,2,-1.0,false); 
         in[1]->add_block(h1b+z->noab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(q3b-z->noab()-z->nvab()))),k_c); 
        } 
        if (q3b>=q4b && h2b>=h1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(q4b),z->get_range(h1b),z->get_range(q3b),1,3,2,0,-1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab()))),k_c); 
        } 
        if (q3b>=q4b && h1b>=h2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(q4b),z->get_range(h1b),z->get_range(q3b),1,3,0,2,+1.0,false); 
         in[1]->add_block(h1b+z->noab()*(h2b+z->noab()*(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab()))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_55(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=0L;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (h1b<h2b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    } 
    else if (h2b<=h1b) { 
     tileoffset=(h1b+z->noab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^(z->irrep_e()^z->irrep_v()))) { 
        long dimc=z->get_range(p3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h6b=0L;h6b<z->noab();++h6b) { 
         for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
          if (z->get_spin(q4b)+z->get_spin(q5b)==z->get_spin(h1b)+z->get_spin(h6b)) { 
           if ((z->get_sym(q4b)^(z->get_sym(q5b)^(z->get_sym(h1b)^z->get_sym(h6b))))==z->irrep_e()) { 
            long q4b_0,q5b_0,h1b_0,h6b_0; 
            z->restricted_4(q4b,q5b,h1b,h6b,q4b_0,q5b_0,h1b_0,h6b_0); 
            long h6b_1,p3b_1,h2b_1,q5b_1; 
            z->restricted_4(h6b,p3b,h2b,q5b,h6b_1,p3b_1,h2b_1,q5b_1); 
            long dim_common=z->get_range(h6b)*z->get_range(q5b); 
            long dima0_sort=z->get_range(q4b)*z->get_range(h1b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(p3b)*z->get_range(h2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (q4b<q5b && h1b<h6b) { 
              z->qx()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q5b),z->get_range(h1b),z->get_range(h6b),2,0,1,3,+1.0,false); 
             } 
             else if (q4b<q5b && h6b<=h1b) { 
              z->qx()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q5b),z->get_range(h6b),z->get_range(h1b),3,0,1,2,-1.0,false); 
             } 
             else if (q5b<=q4b && h1b<h6b) { 
              z->qx()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q4b),z->get_range(h1b),z->get_range(h6b),2,1,0,3,-1.0,false); 
             } 
             else if (q5b<=q4b && h6b<=h1b) { 
              z->qx()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q4b),z->get_range(h6b),z->get_range(h1b),3,1,0,2,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             in[2]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(h2b_1+z->noab()*(p3b_1-z->noab()+z->nvab()*(h6b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(p3b),z->get_range(h2b),z->get_range(q5b),2,1,3,0,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h2b>=h1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p3b),z->get_range(h1b),z->get_range(q4b),1,3,2,0,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        } 
        if (h1b>=h2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p3b),z->get_range(h1b),z->get_range(q4b),1,3,0,2,-1.0,false); 
         in[1]->add_block(h1b+z->noab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_55(){ 
 
long size=0L; 
for (long h6b=0L;h6b<z->noab();++h6b) { 
 for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
  for (long h2b=0L;h2b<z->noab();++h2b) { 
   for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
    if (z->get_spin(h6b)+z->get_spin(p3b)==z->get_spin(h2b)+z->get_spin(q5b)) { 
     if ((z->get_sym(h6b)^(z->get_sym(p3b)^(z->get_sym(h2b)^z->get_sym(q5b))))==(z->irrep_e()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(h6b)+z->get_spin(p3b)+z->get_spin(h2b)+z->get_spin(q5b)!=8L) { 
       in[2]->input_offset(q5b-z->noab()-z->nvab()+z->ncab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(h6b))),size); 
       size+=z->get_range(h6b)*z->get_range(p3b)*z->get_range(h2b)*z->get_range(q5b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_56(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=0L;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
    long tileoffset; 
    if (h3b<h4b) { 
     tileoffset=(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (h4b<=h3b) { 
     tileoffset=(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b)))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(q2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q2b))))==(z->irrep_v()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(q2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h5b=0L;h5b<z->noab();++h5b) { 
         for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
          if (z->get_spin(h3b)+z->get_spin(h5b)==z->get_spin(q2b)+z->get_spin(q6b)) { 
           if ((z->get_sym(h3b)^(z->get_sym(h5b)^(z->get_sym(q2b)^z->get_sym(q6b))))==z->irrep_v()) { 
            long h3b_0,h5b_0,q2b_0,q6b_0; 
            z->restricted_4(h3b,h5b,q2b,q6b,h3b_0,h5b_0,q2b_0,q6b_0); 
            long h4b_1,q6b_1,h5b_1,p1b_1; 
            z->restricted_4(h4b,q6b,h5b,p1b,h4b_1,q6b_1,h5b_1,p1b_1); 
            long dim_common=z->get_range(h5b)*z->get_range(q6b); 
            long dima0_sort=z->get_range(h3b)*z->get_range(q2b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h4b)*z->get_range(p1b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h3b<h5b && q2b<q6b) { 
              z->v2()->get_block(q6b_0+(z->nab())*(q2b_0+(z->nab())*(h5b_0+(z->nab())*(h3b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h5b),z->get_range(q2b),z->get_range(q6b),2,0,3,1,+1.0,false); 
             } 
             else if (h3b<h5b && q6b<=q2b) { 
              z->v2()->get_block(q2b_0+(z->nab())*(q6b_0+(z->nab())*(h5b_0+(z->nab())*(h3b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h5b),z->get_range(q6b),z->get_range(q2b),3,0,2,1,-1.0,false); 
             } 
             else if (h5b<=h3b && q2b<q6b) { 
              z->v2()->get_block(q6b_0+(z->nab())*(q2b_0+(z->nab())*(h3b_0+(z->nab())*(h5b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h3b),z->get_range(q2b),z->get_range(q6b),2,1,3,0,-1.0,false); 
             } 
             else if (h5b<=h3b && q6b<=q2b) { 
              z->v2()->get_block(q2b_0+(z->nab())*(q6b_0+(z->nab())*(h3b_0+(z->nab())*(h5b_0))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h3b),z->get_range(q6b),z->get_range(q2b),3,1,2,0,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             kn[4]->get_block(p1b_1-z->noab()+z->nvab()*(h5b_1+z->noab()*(q6b_1-z->noab()-z->nvab()+z->ncab()*(h4b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(q6b),z->get_range(h5b),z->get_range(p1b),3,0,1,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p1b),z->get_range(h4b),z->get_range(q2b),z->get_range(h3b),3,1,0,2,-1.0,false); 
         in[1]->add_block(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (h3b>=h4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(p1b),z->get_range(h4b),z->get_range(q2b),z->get_range(h3b),1,3,0,2,+1.0,false); 
         in[1]->add_block(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h3b+z->noab()*(h4b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_57(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=0L;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (h1b<h2b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    } 
    else if (h2b<=h1b) { 
     tileoffset=(h1b+z->noab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(p3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h6b=0L;h6b<z->noab();++h6b) { 
         for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
          if (z->get_spin(q4b)+z->get_spin(q5b)==z->get_spin(h1b)+z->get_spin(h6b)) { 
           if ((z->get_sym(q4b)^(z->get_sym(q5b)^(z->get_sym(h1b)^z->get_sym(h6b))))==z->irrep_e()) { 
            long q4b_0,q5b_0,h1b_0,h6b_0; 
            z->restricted_4(q4b,q5b,h1b,h6b,q4b_0,q5b_0,h1b_0,h6b_0); 
            long h6b_1,p3b_1,h2b_1,q5b_1; 
            z->restricted_4(h6b,p3b,h2b,q5b,h6b_1,p3b_1,h2b_1,q5b_1); 
            long dim_common=z->get_range(h6b)*z->get_range(q5b); 
            long dima0_sort=z->get_range(q4b)*z->get_range(h1b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(p3b)*z->get_range(h2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (q4b<q5b && h1b<h6b) { 
              z->qx()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q5b),z->get_range(h1b),z->get_range(h6b),2,0,1,3,+1.0,false); 
             } 
             else if (q4b<q5b && h6b<=h1b) { 
              z->qx()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q5b),z->get_range(h6b),z->get_range(h1b),3,0,1,2,-1.0,false); 
             } 
             else if (q5b<=q4b && h1b<h6b) { 
              z->qx()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q4b),z->get_range(h1b),z->get_range(h6b),2,1,0,3,-1.0,false); 
             } 
             else if (q5b<=q4b && h6b<=h1b) { 
              z->qx()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q4b),z->get_range(h6b),z->get_range(h1b),3,1,0,2,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             kn[5]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(h2b_1+z->noab()*(p3b_1-z->noab()+z->nvab()*(h6b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(p3b),z->get_range(h2b),z->get_range(q5b),2,1,3,0,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h2b>=h1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p3b),z->get_range(h1b),z->get_range(q4b),1,3,2,0,-1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        } 
        if (h1b>=h2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p3b),z->get_range(h1b),z->get_range(q4b),1,3,0,2,+1.0,false); 
         in[1]->add_block(h1b+z->noab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_58(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=0L;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (h1b<h2b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    } 
    else if (h2b<=h1b) { 
     tileoffset=(h1b+z->noab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(p3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h6b=0L;h6b<z->noab();++h6b) { 
         for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
          if (z->get_spin(p5b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h6b)) { 
           if ((z->get_sym(p5b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h6b))))==z->irrep_e()) { 
            long p5b_0,q4b_0,h1b_0,h6b_0; 
            z->restricted_4(p5b,q4b,h1b,h6b,p5b_0,q4b_0,h1b_0,h6b_0); 
            long h6b_1,p3b_1,h2b_1,p5b_1; 
            z->restricted_4(h6b,p3b,h2b,p5b,h6b_1,p3b_1,h2b_1,p5b_1); 
            long dim_common=z->get_range(h6b)*z->get_range(p5b); 
            long dima0_sort=z->get_range(q4b)*z->get_range(h1b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(p3b)*z->get_range(h2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h1b<h6b) { 
              z->qy()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(p5b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(q4b),z->get_range(h1b),z->get_range(h6b),2,1,0,3,+1.0,false); 
             } 
             else if (h6b<=h1b) { 
              z->qy()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(p5b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(q4b),z->get_range(h6b),z->get_range(h1b),3,1,0,2,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             kn[6]->get_block(p5b_1-z->noab()+z->nvab()*(h2b_1+z->noab()*(p3b_1-z->noab()+z->nvab()*(h6b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(p3b),z->get_range(h2b),z->get_range(p5b),2,1,3,0,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h2b>=h1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p3b),z->get_range(h1b),z->get_range(q4b),1,3,2,0,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        } 
        if (h1b>=h2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p3b),z->get_range(h1b),z->get_range(q4b),1,3,0,2,-1.0,false); 
         in[1]->add_block(h1b+z->noab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_59(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=0L;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (p3b<p4b && h1b<h2b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab())))); 
    } 
    else if (p3b<p4b && h2b<=h1b) { 
     tileoffset=(h1b+z->noab()*(h2b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab())))); 
    } 
    else if (p4b<=p3b && h1b<h2b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab())))); 
    } 
    else if (p4b<=p3b && h2b<=h1b) { 
     tileoffset=(h1b+z->noab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab())))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(p4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(p4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(p4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(p3b)*z->get_range(p4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h6b=0L;h6b<z->noab();++h6b) { 
         for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
          if (z->get_spin(p3b)+z->get_spin(q5b)==z->get_spin(h1b)+z->get_spin(h6b)) { 
           if ((z->get_sym(p3b)^(z->get_sym(q5b)^(z->get_sym(h1b)^z->get_sym(h6b))))==z->irrep_e()) { 
            long p3b_0,q5b_0,h1b_0,h6b_0; 
            z->restricted_4(p3b,q5b,h1b,h6b,p3b_0,q5b_0,h1b_0,h6b_0); 
            long h6b_1,p4b_1,h2b_1,q5b_1; 
            z->restricted_4(h6b,p4b,h2b,q5b,h6b_1,p4b_1,h2b_1,q5b_1); 
            long dim_common=z->get_range(h6b)*z->get_range(q5b); 
            long dima0_sort=z->get_range(p3b)*z->get_range(h1b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(p4b)*z->get_range(h2b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h1b<h6b) { 
              z->qy()->get_block(h6b_0+z->noab()*(h1b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q5b),z->get_range(h1b),z->get_range(h6b),2,0,1,3,+1.0,false); 
             } 
             else if (h6b<=h1b) { 
              z->qy()->get_block(h1b_0+z->noab()*(h6b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q5b),z->get_range(h6b),z->get_range(h1b),3,0,1,2,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             kn[5]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(h2b_1+z->noab()*(p4b_1-z->noab()+z->nvab()*(h6b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(p4b),z->get_range(h2b),z->get_range(q5b),2,1,3,0,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (p4b>=p3b && h2b>=h1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p4b),z->get_range(h1b),z->get_range(p3b),3,1,2,0,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab()))),k_c); 
        } 
        if (p4b>=p3b && h1b>=h2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p4b),z->get_range(h1b),z->get_range(p3b),3,1,0,2,-1.0,false); 
         in[1]->add_block(h1b+z->noab()*(h2b+z->noab()*(p4b-z->noab()+z->nvab()*(p3b-z->noab()))),k_c); 
        } 
        if (p3b>=p4b && h2b>=h1b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p4b),z->get_range(h1b),z->get_range(p3b),1,3,2,0,-1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab()))),k_c); 
        } 
        if (p3b>=p4b && h1b>=h2b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(p4b),z->get_range(h1b),z->get_range(p3b),1,3,0,2,+1.0,false); 
         in[1]->add_block(h1b+z->noab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(p4b-z->noab()))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_5_0(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    long tileoffset; 
    tileoffset=(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_e()^z->irrep_f())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
        long h2b_0,q5b_0,h3b_0,h4b_0; 
        z->restricted_4(h2b,q5b,h3b,h4b,h2b_0,q5b_0,h3b_0,h4b_0); 
        long dim_common=1L; 
        long dima0_sort=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
        long dima0=dim_common*dima0_sort; 
        if (dima0>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(h4b_0+(z->nab())*(h3b_0+(z->nab())*(q5b_0+(z->nab())*(h2b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(h3b),z->get_range(h4b),0,1,2,3,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_c=z->mem()->malloc_local_double(dimc); 
         z->sort_indices4(k_a0_sort,k_c,z->get_range(h2b),z->get_range(q5b),z->get_range(h3b),z->get_range(h4b),0,1,2,3,-1.0,false); 
         in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
         z->mem()->free_local_double(k_c); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_5(){ 
 
long size=0L; 
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
     if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_e()^z->irrep_f())) { 
      if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
       in[2]->input_offset(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),size); 
       size+=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_60(){ 
      
for (long q3b=z->noab()+z->nvab();q3b<z->nab();++q3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (q3b<q4b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(q3b-z->noab()-z->nvab())))); 
    } 
    else if (q4b<=q3b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab())))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(q3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(q3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(q3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(q3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(q3b)+z->get_spin(q5b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
          if ((z->get_sym(q3b)^(z->get_sym(q5b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
           long q3b_0,q5b_0,h1b_0,h2b_0; 
           z->restricted_4(q3b,q5b,h1b,h2b,q3b_0,q5b_0,h1b_0,h2b_0); 
           long q4b_1,q5b_1; 
           z->restricted_2(q4b,q5b,q4b_1,q5b_1); 
           long dim_common=z->get_range(q5b); 
           long dima0_sort=z->get_range(q3b)*z->get_range(h1b)*z->get_range(h2b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (q3b<q5b) { 
             z->qx()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q3b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q3b),z->get_range(q5b),z->get_range(h1b),z->get_range(h2b),3,2,0,1,+1.0,false); 
            } 
            else if (q5b<=q3b) { 
             z->qx()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(q3b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q3b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[7]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(q4b_1-z->noab()-z->nvab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(q4b),z->get_range(q5b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (q4b>=q3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(q4b),z->get_range(h2b),z->get_range(h1b),z->get_range(q3b),3,0,2,1,-1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(q3b-z->noab()-z->nvab()))),k_c); 
        } 
        if (q3b>=q4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(q4b),z->get_range(h2b),z->get_range(h1b),z->get_range(q3b),0,3,2,1,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q3b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab()))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_61(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^(z->irrep_e()^z->irrep_v()))) { 
        long dimc=z->get_range(p3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(q4b)+z->get_spin(q5b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
          if ((z->get_sym(q4b)^(z->get_sym(q5b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
           long q4b_0,q5b_0,h1b_0,h2b_0; 
           z->restricted_4(q4b,q5b,h1b,h2b,q4b_0,q5b_0,h1b_0,h2b_0); 
           long p3b_1,q5b_1; 
           z->restricted_2(p3b,q5b,p3b_1,q5b_1); 
           long dim_common=z->get_range(q5b); 
           long dima0_sort=z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p3b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (q4b<q5b) { 
             z->qx()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q5b),z->get_range(h1b),z->get_range(h2b),3,2,0,1,+1.0,false); 
            } 
            else if (q5b<=q4b) { 
             z->qx()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q4b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(p3b_1-z->noab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(p3b),z->get_range(q5b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(p3b),z->get_range(h2b),z->get_range(h1b),z->get_range(q4b),0,3,2,1,+1.0,false); 
        in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_61(){ 
 
long size=0L; 
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  if (z->get_spin(p3b)==z->get_spin(q5b)) { 
   if ((z->get_sym(p3b)^z->get_sym(q5b))==(z->irrep_e()^z->irrep_v())) { 
    if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q5b)!=4L) { 
     in[2]->input_offset(q5b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()),size); 
     size+=z->get_range(p3b)*z->get_range(q5b); 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_62(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
    long tileoffset; 
    tileoffset=(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(q2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q2b))))==(z->irrep_y()^(z->irrep_e()^z->irrep_v()))) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(q2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q5b))))==z->irrep_y()) { 
           long h3b_0,h4b_0,p1b_0,q5b_0; 
           z->restricted_4(h3b,h4b,p1b,q5b,h3b_0,h4b_0,p1b_0,q5b_0); 
           long q5b_1,q2b_1; 
           z->restricted_2(q5b,q2b,q5b_1,q2b_1); 
           long dim_common=z->get_range(q5b); 
           long dima0_sort=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->ly()->get_block(q5b_0-z->noab()-z->nvab()+z->ncab()*(p1b_0-z->noab()+z->nvab()*(h4b_0+z->noab()*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(q5b),2,1,0,3,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[2]->get_block(q2b_1-z->noab()-z->nvab()+z->ncab()*(q5b_1-z->noab()-z->nvab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(q5b),z->get_range(q2b),1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q2b),z->get_range(p1b),z->get_range(h4b),z->get_range(h3b),3,2,1,0,+1.0,false); 
        in[1]->add_block(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_1_62(){ 
 
long size=0L; 
for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
 for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
  if (z->get_spin(q5b)==z->get_spin(q2b)) { 
   if ((z->get_sym(q5b)^z->get_sym(q2b))==(z->irrep_e()^z->irrep_v())) { 
    if (!z->restricted() || z->get_spin(q5b)+z->get_spin(q2b)!=4L) { 
     in[2]->input_offset(q2b-z->noab()-z->nvab()+z->ncab()*(q5b-z->noab()-z->nvab()),size); 
     size+=z->get_range(q5b)*z->get_range(q2b); 
    } 
   } 
  } 
 } 
} 
in[2]->set_filesize(size); 
in[2]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_63(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
   for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
    long tileoffset; 
    tileoffset=(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b)))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(p1b)+z->get_spin(q2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q2b))))==(z->irrep_v()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b)*z->get_range(q2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(p1b)+z->get_spin(q5b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(p1b)^z->get_sym(q5b))))==z->irrep_v()) { 
           long h3b_0,h4b_0,p1b_0,q5b_0; 
           z->restricted_4(h3b,h4b,p1b,q5b,h3b_0,h4b_0,p1b_0,q5b_0); 
           long q5b_1,q2b_1; 
           z->restricted_2(q5b,q2b,q5b_1,q2b_1); 
           long dim_common=z->get_range(q5b); 
           long dima0_sort=z->get_range(h3b)*z->get_range(h4b)*z->get_range(p1b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->v2()->get_block(q5b_0+(z->nab())*(p1b_0+(z->nab())*(h4b_0+(z->nab())*(h3b_0))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p1b),z->get_range(q5b),2,1,0,3,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[7]->get_block(q2b_1-z->noab()-z->nvab()+z->ncab()*(q5b_1-z->noab()-z->nvab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(q5b),z->get_range(q2b),1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q2b),z->get_range(p1b),z->get_range(h4b),z->get_range(h3b),3,2,1,0,-1.0,false); 
        in[1]->add_block(q2b-z->noab()-z->nvab()+z->ncab()*(p1b-z->noab()+z->nvab()*(h4b+z->noab()*(h3b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_64(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(p3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(p3b)+z->get_spin(q5b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
          if ((z->get_sym(p3b)^(z->get_sym(q5b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
           long p3b_0,q5b_0,h1b_0,h2b_0; 
           z->restricted_4(p3b,q5b,h1b,h2b,p3b_0,q5b_0,h1b_0,h2b_0); 
           long q4b_1,q5b_1; 
           z->restricted_2(q4b,q5b,q4b_1,q5b_1); 
           long dim_common=z->get_range(q5b); 
           long dima0_sort=z->get_range(p3b)*z->get_range(h1b)*z->get_range(h2b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->qy()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q5b),z->get_range(h1b),z->get_range(h2b),3,2,0,1,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[8]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(q4b_1-z->noab()-z->nvab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(q4b),z->get_range(q5b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q4b),z->get_range(h2b),z->get_range(h1b),z->get_range(p3b),3,0,2,1,-1.0,false); 
        in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_65(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(p3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(q4b)+z->get_spin(q5b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
          if ((z->get_sym(q4b)^(z->get_sym(q5b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
           long q4b_0,q5b_0,h1b_0,h2b_0; 
           z->restricted_4(q4b,q5b,h1b,h2b,q4b_0,q5b_0,h1b_0,h2b_0); 
           long p3b_1,q5b_1; 
           z->restricted_2(p3b,q5b,p3b_1,q5b_1); 
           long dim_common=z->get_range(q5b); 
           long dima0_sort=z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p3b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (q4b<q5b) { 
             z->qx()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q5b),z->get_range(h1b),z->get_range(h2b),3,2,0,1,+1.0,false); 
            } 
            else if (q5b<=q4b) { 
             z->qx()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q4b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[10]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(p3b_1-z->noab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(p3b),z->get_range(q5b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(p3b),z->get_range(h2b),z->get_range(h1b),z->get_range(q4b),0,3,2,1,+1.0,false); 
        in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_66(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(p3b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(p3b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(p3b)*z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
         if (z->get_spin(p5b)+z->get_spin(q4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
          if ((z->get_sym(p5b)^(z->get_sym(q4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
           long p5b_0,q4b_0,h1b_0,h2b_0; 
           z->restricted_4(p5b,q4b,h1b,h2b,p5b_0,q4b_0,h1b_0,h2b_0); 
           long p3b_1,p5b_1; 
           z->restricted_2(p3b,p5b,p3b_1,p5b_1); 
           long dim_common=z->get_range(p5b); 
           long dima0_sort=z->get_range(q4b)*z->get_range(h1b)*z->get_range(h2b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p3b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->qy()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(p5b_0-z->noab()))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(q4b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[11]->get_block(p5b_1-z->noab()+z->nvab()*(p3b_1-z->noab()),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(p3b),z->get_range(p5b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(p3b),z->get_range(h2b),z->get_range(h1b),z->get_range(q4b),0,3,2,1,-1.0,false); 
        in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_68(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    tileoffset=(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b)))); 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h5b=0L;h5b<z->noab();++h5b) { 
         for (long h6b=h5b;h6b<z->noab();++h6b) { 
          if (z->get_spin(h5b)+z->get_spin(h6b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
           if ((z->get_sym(h5b)^(z->get_sym(h6b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
            long h5b_0,h6b_0,h1b_0,h2b_0; 
            z->restricted_4(h5b,h6b,h1b,h2b,h5b_0,h6b_0,h1b_0,h2b_0); 
            long h3b_1,h4b_1,h5b_1,h6b_1; 
            z->restricted_4(h3b,h4b,h5b,h6b,h3b_1,h4b_1,h5b_1,h6b_1); 
            long dim_common=z->get_range(h5b)*z->get_range(h6b); 
            long dima0_sort=z->get_range(h1b)*z->get_range(h2b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h3b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->vr2()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(h6b_0+(z->nab())*(h5b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h6b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             kn[14]->get_block(h6b_1+z->noab()*(h5b_1+z->noab()*(h4b_1+z->noab()*(h3b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h5b),z->get_range(h6b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (h5b==h6b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h3b),z->get_range(h2b),z->get_range(h1b),1,0,3,2,+0.5/0.5,false); 
        in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_69(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=0L;h4b<z->noab();++h4b) { 
  for (long h1b=0L;h1b<z->noab();++h1b) { 
   for (long h2b=h1b;h2b<z->noab();++h2b) { 
    long tileoffset; 
    if (h3b<h4b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (h4b<=h3b) { 
     tileoffset=(h2b+z->noab()*(h1b+z->noab()*(h3b+z->noab()*(h4b)))); 
    } 
    if (in[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h1b)+z->get_spin(h2b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h1b)^z->get_sym(h2b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h1b)*z->get_range(h2b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h5b=0L;h5b<z->noab();++h5b) { 
         if (z->get_spin(h3b)+z->get_spin(h5b)==z->get_spin(h1b)+z->get_spin(h2b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h5b)^(z->get_sym(h1b)^z->get_sym(h2b))))==z->irrep_e()) { 
           long h3b_0,h5b_0,h1b_0,h2b_0; 
           z->restricted_4(h3b,h5b,h1b,h2b,h3b_0,h5b_0,h1b_0,h2b_0); 
           long h4b_1,h5b_1; 
           z->restricted_2(h4b,h5b,h4b_1,h5b_1); 
           long dim_common=z->get_range(h5b); 
           long dima0_sort=z->get_range(h3b)*z->get_range(h1b)*z->get_range(h2b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (h3b<h5b) { 
             z->vr2()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(h5b_0+(z->nab())*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h5b),z->get_range(h1b),z->get_range(h2b),3,2,0,1,+1.0,false); 
            } 
            else if (h5b<=h3b) { 
             z->vr2()->get_block(h2b_0+z->noab()*(h1b_0+z->noab()*(h3b_0+(z->nab())*(h5b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h5b),z->get_range(h3b),z->get_range(h1b),z->get_range(h2b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[12]->get_block(h5b_1+z->noab()*(h4b_1),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(h5b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h1b),z->get_range(h3b),3,0,2,1,-1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (h3b>=h4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h1b),z->get_range(h3b),0,3,2,1,+1.0,false); 
         in[1]->add_block(h2b+z->noab()*(h1b+z->noab()*(h3b+z->noab()*(h4b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_1_9(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
  long tileoffset; 
  tileoffset=(p1b-z->noab()+z->nvab()*(h2b)); 
  if (in[1]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p1b)!=4L) { 
    if (z->get_spin(h2b)==z->get_spin(p1b)) { 
     if ((z->get_sym(h2b)^z->get_sym(p1b))==(z->irrep_y()^z->irrep_e())) { 
      long dimc=z->get_range(h2b)*z->get_range(p1b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h3b=0L;h3b<z->noab();++h3b) { 
       for (long h4b=0L;h4b<z->noab();++h4b) { 
        for (long h5b=h4b;h5b<z->noab();++h5b) { 
         if (z->get_spin(h2b)+z->get_spin(h3b)==z->get_spin(h4b)+z->get_spin(h5b)) { 
          if ((z->get_sym(h2b)^(z->get_sym(h3b)^(z->get_sym(h4b)^z->get_sym(h5b))))==z->irrep_y()) { 
           long h2b_0,h3b_0,h4b_0,h5b_0; 
           z->restricted_4(h2b,h3b,h4b,h5b,h2b_0,h3b_0,h4b_0,h5b_0); 
           long h4b_1,h5b_1,h3b_1,p1b_1; 
           z->restricted_4(h4b,h5b,h3b,p1b,h4b_1,h5b_1,h3b_1,p1b_1); 
           long dim_common=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h5b); 
           long dima0_sort=z->get_range(h2b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p1b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (h2b<h3b) { 
             z->glambda2()->get_block(h5b_0+z->noab()*(h4b_0+z->noab()*(h3b_0+z->noab()*(h2b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(h3b),z->get_range(h4b),z->get_range(h5b),0,3,2,1,+1.0,false); 
            } 
            else if (h3b<=h2b) { 
             z->glambda2()->get_block(h5b_0+z->noab()*(h4b_0+z->noab()*(h2b_0+z->noab()*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h2b),z->get_range(h4b),z->get_range(h5b),1,3,2,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            z->vd2()->get_block(p1b_1+(z->nab())*(h3b_1+(z->nab())*(h5b_1+z->noab()*(h4b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(h5b),z->get_range(h3b),z->get_range(p1b),3,1,0,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h4b==h5b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p1b),z->get_range(h2b),1,0,-0.5/0.5,false); 
      in[1]->add_block(p1b-z->noab()+z->nvab()*(h2b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_10(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=0L;h4b<z->noab();++h4b) { 
    long tileoffset; 
    if (h3b<h4b) { 
     tileoffset=(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    } 
    else if (h4b<=h3b) { 
     tileoffset=(h3b+z->noab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    } 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_t()^z->irrep_v())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
         if (z->get_spin(p6b)==z->get_spin(h3b)) { 
          if ((z->get_sym(p6b)^z->get_sym(h3b))==z->irrep_t()) { 
           long p6b_0,h3b_0; 
           z->restricted_2(p6b,h3b,p6b_0,h3b_0); 
           long h2b_1,q5b_1,h4b_1,p6b_1; 
           z->restricted_4(h2b,q5b,h4b,p6b,h2b_1,q5b_1,h4b_1,p6b_1); 
           long dim_common=z->get_range(p6b); 
           long dima0_sort=z->get_range(h3b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->t1()->get_block(h3b_0+z->noab()*(p6b_0-z->noab()),k_a0); 
            z->sort_indices2(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(h3b),1,0,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[3]->get_block(p6b_1-z->noab()+z->nvab()*(h4b_1+z->noab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(h4b),z->get_range(p6b),2,1,0,3,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(q5b),z->get_range(h2b),z->get_range(h3b),2,1,3,0,+1.0,false); 
         in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        } 
        if (h3b>=h4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(q5b),z->get_range(h2b),z->get_range(h3b),2,1,0,3,-1.0,false); 
         in[2]->add_block(h3b+z->noab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_10_0(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h4b=0L;h4b<z->noab();++h4b) { 
   for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
    long tileoffset; 
    tileoffset=(p6b-z->noab()+z->nvab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    if (in[3]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h4b)+z->get_spin(p6b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h4b)+z->get_spin(p6b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h4b)^z->get_sym(p6b))))==z->irrep_v()) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h4b)*z->get_range(p6b); 
        long h2b_0,q5b_0,h4b_0,p6b_0; 
        z->restricted_4(h2b,q5b,h4b,p6b,h2b_0,q5b_0,h4b_0,p6b_0); 
        long dim_common=1L; 
        long dima0_sort=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h4b)*z->get_range(p6b); 
        long dima0=dim_common*dima0_sort; 
        if (dima0>0L) { 
         double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
         double* k_a0=z->mem()->malloc_local_double(dima0); 
         z->v2()->get_block(p6b_0+(z->nab())*(h4b_0+(z->nab())*(q5b_0+(z->nab())*(h2b_0))),k_a0); 
         z->sort_indices4(k_a0,k_a0_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(h4b),z->get_range(p6b),0,1,2,3,+1.0,false); 
         z->mem()->free_local_double(k_a0); 
         double* k_c=z->mem()->malloc_local_double(dimc); 
         z->sort_indices4(k_a0_sort,k_c,z->get_range(h2b),z->get_range(q5b),z->get_range(h4b),z->get_range(p6b),0,1,2,3,+1.0,false); 
         in[3]->add_block(p6b-z->noab()+z->nvab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
         z->mem()->free_local_double(k_c); 
         z->mem()->free_local_double(k_a0_sort); 
        } 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_2_10(){ 
 
long size=0L; 
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h4b=0L;h4b<z->noab();++h4b) { 
   for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
    if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h4b)+z->get_spin(p6b)) { 
     if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h4b)^z->get_sym(p6b))))==(z->irrep_t()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h4b)+z->get_spin(p6b)!=8L) { 
       in[3]->input_offset(p6b-z->noab()+z->nvab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),size); 
       size+=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h4b)*z->get_range(p6b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[3]->set_filesize(size); 
in[3]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_11(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    long tileoffset; 
    tileoffset=(h4b+z->noab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(p5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(p5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_t()^z->irrep_y())) { 
        long dimc=z->get_range(h2b)*z->get_range(p5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h6b=0L;h6b<z->noab();++h6b) { 
         if (z->get_spin(p5b)==z->get_spin(h6b)) { 
          if ((z->get_sym(p5b)^z->get_sym(h6b))==z->irrep_t()) { 
           long p5b_0,h6b_0; 
           z->restricted_2(p5b,h6b,p5b_0,h6b_0); 
           long h2b_1,h6b_1,h3b_1,h4b_1; 
           z->restricted_4(h2b,h6b,h3b,h4b,h2b_1,h6b_1,h3b_1,h4b_1); 
           long dim_common=z->get_range(h6b); 
           long dima0_sort=z->get_range(p5b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b)*z->get_range(h3b)*z->get_range(h4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->t1()->get_block(h6b_0+z->noab()*(p5b_0-z->noab()),k_a0); 
            z->sort_indices2(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(h6b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (h2b<h6b) { 
             z->glambda2()->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(h6b_1+z->noab()*(h2b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h6b),z->get_range(h3b),z->get_range(h4b),3,2,0,1,+1.0,false); 
            } 
            else if (h6b<=h2b) { 
             z->glambda2()->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(h2b_1+z->noab()*(h6b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h2b),z->get_range(h3b),z->get_range(h4b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h3b),z->get_range(h2b),z->get_range(p5b),2,3,1,0,+0.5,false); 
        in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_23(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
    long tileoffset; 
    tileoffset=(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p5b)+z->get_spin(h3b)+z->get_spin(q4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(p5b)==z->get_spin(h3b)+z->get_spin(q4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(p5b)^(z->get_sym(h3b)^z->get_sym(q4b))))==(z->irrep_t()^z->irrep_y())) { 
        long dimc=z->get_range(h2b)*z->get_range(p5b)*z->get_range(h3b)*z->get_range(q4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h7b=0L;h7b<z->noab();++h7b) { 
         for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
          if (z->get_spin(p5b)+z->get_spin(p6b)==z->get_spin(h3b)+z->get_spin(h7b)) { 
           if ((z->get_sym(p5b)^(z->get_sym(p6b)^(z->get_sym(h3b)^z->get_sym(h7b))))==z->irrep_t()) { 
            long p5b_0,p6b_0,h3b_0,h7b_0; 
            z->restricted_4(p5b,p6b,h3b,h7b,p5b_0,p6b_0,h3b_0,h7b_0); 
            long h2b_1,h7b_1,p6b_1,q4b_1; 
            z->restricted_4(h2b,h7b,p6b,q4b,h2b_1,h7b_1,p6b_1,q4b_1); 
            long dim_common=z->get_range(h7b)*z->get_range(p6b); 
            long dima0_sort=z->get_range(p5b)*z->get_range(h3b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h2b)*z->get_range(q4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (p5b<p6b && h3b<h7b) { 
              z->t2()->get_block(h7b_0+z->noab()*(h3b_0+z->noab()*(p6b_0-z->noab()+z->nvab()*(p5b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(p6b),z->get_range(h3b),z->get_range(h7b),2,0,1,3,+1.0,false); 
             } 
             else if (p5b<p6b && h7b<=h3b) { 
              z->t2()->get_block(h3b_0+z->noab()*(h7b_0+z->noab()*(p6b_0-z->noab()+z->nvab()*(p5b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(p6b),z->get_range(h7b),z->get_range(h3b),3,0,1,2,-1.0,false); 
             } 
             else if (p6b<=p5b && h3b<h7b) { 
              z->t2()->get_block(h7b_0+z->noab()*(h3b_0+z->noab()*(p5b_0-z->noab()+z->nvab()*(p6b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(p5b),z->get_range(h3b),z->get_range(h7b),2,1,0,3,-1.0,false); 
             } 
             else if (p6b<=p5b && h7b<=h3b) { 
              z->t2()->get_block(h3b_0+z->noab()*(h7b_0+z->noab()*(p5b_0-z->noab()+z->nvab()*(p6b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(p5b),z->get_range(h7b),z->get_range(h3b),3,1,0,2,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h2b<h7b) { 
              z->ly()->get_block(q4b_1-z->noab()-z->nvab()+z->ncab()*(p6b_1-z->noab()+z->nvab()*(h7b_1+z->noab()*(h2b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h7b),z->get_range(p6b),z->get_range(q4b),3,0,2,1,+1.0,false); 
             } 
             else if (h7b<=h2b) { 
              z->ly()->get_block(q4b_1-z->noab()-z->nvab()+z->ncab()*(p6b_1-z->noab()+z->nvab()*(h2b_1+z->noab()*(h7b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h2b),z->get_range(p6b),z->get_range(q4b),3,1,2,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q4b),z->get_range(h2b),z->get_range(h3b),z->get_range(p5b),1,3,2,0,+1.0,false); 
        in[2]->add_block(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_24(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    long tileoffset; 
    tileoffset=(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_t()^z->irrep_v())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
         for (long p7b=p6b;p7b<z->noab()+z->nvab();++p7b) { 
          if (z->get_spin(p6b)+z->get_spin(p7b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
           if ((z->get_sym(p6b)^(z->get_sym(p7b)^(z->get_sym(h3b)^z->get_sym(h4b))))==z->irrep_t()) { 
            long p6b_0,p7b_0,h3b_0,h4b_0; 
            z->restricted_4(p6b,p7b,h3b,h4b,p6b_0,p7b_0,h3b_0,h4b_0); 
            long h2b_1,q5b_1,p6b_1,p7b_1; 
            z->restricted_4(h2b,q5b,p6b,p7b,h2b_1,q5b_1,p6b_1,p7b_1); 
            long dim_common=z->get_range(p6b)*z->get_range(p7b); 
            long dima0_sort=z->get_range(h3b)*z->get_range(h4b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h2b)*z->get_range(q5b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->t2()->get_block(h4b_0+z->noab()*(h3b_0+z->noab()*(p7b_0-z->noab()+z->nvab()*(p6b_0-z->noab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(p7b),z->get_range(h3b),z->get_range(h4b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             z->v2()->get_block(p7b_1+(z->nab())*(p6b_1+(z->nab())*(q5b_1+(z->nab())*(h2b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(p6b),z->get_range(p7b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (p6b==p7b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q5b),z->get_range(h2b),z->get_range(h4b),z->get_range(h3b),1,0,3,2,-0.5/0.5,false); 
        in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_32(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=0L;h4b<z->noab();++h4b) { 
    long tileoffset; 
    if (h3b<h4b) { 
     tileoffset=(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    } 
    else if (h4b<=h3b) { 
     tileoffset=(h3b+z->noab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    } 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h7b=0L;h7b<z->noab();++h7b) { 
         for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
          if (z->get_spin(q5b)+z->get_spin(q6b)==z->get_spin(h3b)+z->get_spin(h7b)) { 
           if ((z->get_sym(q5b)^(z->get_sym(q6b)^(z->get_sym(h3b)^z->get_sym(h7b))))==z->irrep_e()) { 
            long q5b_0,q6b_0,h3b_0,h7b_0; 
            z->restricted_4(q5b,q6b,h3b,h7b,q5b_0,q6b_0,h3b_0,h7b_0); 
            long h2b_1,h7b_1,h4b_1,q6b_1; 
            z->restricted_4(h2b,h7b,h4b,q6b,h2b_1,h7b_1,h4b_1,q6b_1); 
            long dim_common=z->get_range(h7b)*z->get_range(q6b); 
            long dima0_sort=z->get_range(q5b)*z->get_range(h3b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h2b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (q5b<q6b && h3b<h7b) { 
              z->qx()->get_block(h7b_0+z->noab()*(h3b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q6b),z->get_range(h3b),z->get_range(h7b),2,0,1,3,+1.0,false); 
             } 
             else if (q5b<q6b && h7b<=h3b) { 
              z->qx()->get_block(h3b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q6b),z->get_range(h7b),z->get_range(h3b),3,0,1,2,-1.0,false); 
             } 
             else if (q6b<=q5b && h3b<h7b) { 
              z->qx()->get_block(h7b_0+z->noab()*(h3b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q5b),z->get_range(h3b),z->get_range(h7b),2,1,0,3,-1.0,false); 
             } 
             else if (q6b<=q5b && h7b<=h3b) { 
              z->qx()->get_block(h3b_0+z->noab()*(h7b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q5b),z->get_range(h7b),z->get_range(h3b),3,1,0,2,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h2b<h7b) { 
              z->v2()->get_block(q6b_1+(z->nab())*(h4b_1+(z->nab())*(h7b_1+(z->nab())*(h2b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h7b),z->get_range(h4b),z->get_range(q6b),2,0,3,1,+1.0,false); 
             } 
             else if (h7b<=h2b) { 
              z->v2()->get_block(q6b_1+(z->nab())*(h4b_1+(z->nab())*(h2b_1+(z->nab())*(h7b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h2b),z->get_range(h4b),z->get_range(q6b),2,1,3,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h3b),z->get_range(q5b),1,3,2,0,+1.0,false); 
         in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        } 
        if (h3b>=h4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h3b),z->get_range(q5b),1,3,0,2,-1.0,false); 
         in[2]->add_block(h3b+z->noab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_33(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=0L;h4b<z->noab();++h4b) { 
    long tileoffset; 
    if (h3b<h4b) { 
     tileoffset=(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    } 
    else if (h4b<=h3b) { 
     tileoffset=(h3b+z->noab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    } 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h7b=0L;h7b<z->noab();++h7b) { 
         for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
          if (z->get_spin(p6b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h7b)) { 
           if ((z->get_sym(p6b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h7b))))==z->irrep_e()) { 
            long p6b_0,q5b_0,h3b_0,h7b_0; 
            z->restricted_4(p6b,q5b,h3b,h7b,p6b_0,q5b_0,h3b_0,h7b_0); 
            long h2b_1,h7b_1,h4b_1,p6b_1; 
            z->restricted_4(h2b,h7b,h4b,p6b,h2b_1,h7b_1,h4b_1,p6b_1); 
            long dim_common=z->get_range(h7b)*z->get_range(p6b); 
            long dima0_sort=z->get_range(q5b)*z->get_range(h3b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h2b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h3b<h7b) { 
              z->qy()->get_block(h7b_0+z->noab()*(h3b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(p6b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(q5b),z->get_range(h3b),z->get_range(h7b),2,1,0,3,+1.0,false); 
             } 
             else if (h7b<=h3b) { 
              z->qy()->get_block(h3b_0+z->noab()*(h7b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(p6b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(q5b),z->get_range(h7b),z->get_range(h3b),3,1,0,2,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h2b<h7b) { 
              z->v2()->get_block(p6b_1+(z->nab())*(h4b_1+(z->nab())*(h7b_1+(z->nab())*(h2b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h7b),z->get_range(h4b),z->get_range(p6b),2,0,3,1,+1.0,false); 
             } 
             else if (h7b<=h2b) { 
              z->v2()->get_block(p6b_1+(z->nab())*(h4b_1+(z->nab())*(h2b_1+(z->nab())*(h7b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h2b),z->get_range(h4b),z->get_range(p6b),2,1,3,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h3b),z->get_range(q5b),1,3,2,0,-1.0,false); 
         in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        } 
        if (h3b>=h4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h3b),z->get_range(q5b),1,3,0,2,+1.0,false); 
         in[2]->add_block(h3b+z->noab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_35(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
    long tileoffset; 
    tileoffset=(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(q4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(q4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(q4b))))==(z->irrep_e()^z->irrep_y())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(q4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h7b=0L;h7b<z->noab();++h7b) { 
         for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
          if (z->get_spin(p6b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h7b)) { 
           if ((z->get_sym(p6b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h7b))))==z->irrep_e()) { 
            long p6b_0,q5b_0,h3b_0,h7b_0; 
            z->restricted_4(p6b,q5b,h3b,h7b,p6b_0,q5b_0,h3b_0,h7b_0); 
            long h2b_1,h7b_1,p6b_1,q4b_1; 
            z->restricted_4(h2b,h7b,p6b,q4b,h2b_1,h7b_1,p6b_1,q4b_1); 
            long dim_common=z->get_range(h7b)*z->get_range(p6b); 
            long dima0_sort=z->get_range(q5b)*z->get_range(h3b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h2b)*z->get_range(q4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h3b<h7b) { 
              z->qy()->get_block(h7b_0+z->noab()*(h3b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(p6b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(q5b),z->get_range(h3b),z->get_range(h7b),2,1,0,3,+1.0,false); 
             } 
             else if (h7b<=h3b) { 
              z->qy()->get_block(h3b_0+z->noab()*(h7b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(p6b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(q5b),z->get_range(h7b),z->get_range(h3b),3,1,0,2,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h2b<h7b) { 
              z->ly()->get_block(q4b_1-z->noab()-z->nvab()+z->ncab()*(p6b_1-z->noab()+z->nvab()*(h7b_1+z->noab()*(h2b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h7b),z->get_range(p6b),z->get_range(q4b),3,0,2,1,+1.0,false); 
             } 
             else if (h7b<=h2b) { 
              z->ly()->get_block(q4b_1-z->noab()-z->nvab()+z->ncab()*(p6b_1-z->noab()+z->nvab()*(h2b_1+z->noab()*(h7b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h2b),z->get_range(p6b),z->get_range(q4b),3,1,2,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q4b),z->get_range(h2b),z->get_range(h3b),z->get_range(q5b),1,3,2,0,-1.0,false); 
        in[2]->add_block(q4b-z->noab()-z->nvab()+z->ncab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_39(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    long tileoffset; 
    tileoffset=(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_t()^z->irrep_e())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h6b=0L;h6b<z->noab();++h6b) { 
         for (long h7b=h6b;h7b<z->noab();++h7b) { 
          if (z->get_spin(h6b)+z->get_spin(h7b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
           if ((z->get_sym(h6b)^(z->get_sym(h7b)^(z->get_sym(h3b)^z->get_sym(h4b))))==z->irrep_t()) { 
            long h6b_0,h7b_0,h3b_0,h4b_0; 
            z->restricted_4(h6b,h7b,h3b,h4b,h6b_0,h7b_0,h3b_0,h4b_0); 
            long h2b_1,q5b_1,h6b_1,h7b_1; 
            z->restricted_4(h2b,q5b,h6b,h7b,h2b_1,q5b_1,h6b_1,h7b_1); 
            long dim_common=z->get_range(h6b)*z->get_range(h7b); 
            long dima0_sort=z->get_range(h3b)*z->get_range(h4b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h2b)*z->get_range(q5b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->gt2()->get_block(h4b_0+z->noab()*(h3b_0+z->noab()*(h7b_0+z->noab()*(h6b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h6b),z->get_range(h7b),z->get_range(h3b),z->get_range(h4b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             z->vr2()->get_block(h7b_1+z->noab()*(h6b_1+z->noab()*(q5b_1+(z->nab())*(h2b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(h6b),z->get_range(h7b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (h6b==h7b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q5b),z->get_range(h2b),z->get_range(h4b),z->get_range(h3b),1,0,3,2,-0.5/0.5,false); 
        in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_40(){ 
      
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long h3b=0L;h3b<z->noab();++h3b) { 
  long tileoffset; 
  tileoffset=(h3b+z->noab()*(p4b-z->noab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p4b)+z->get_spin(h3b)!=4L) { 
    if (z->get_spin(p4b)==z->get_spin(h3b)) { 
     if ((z->get_sym(p4b)^z->get_sym(h3b))==(z->irrep_t()^z->irrep_v())) { 
      long dimc=z->get_range(p4b)*z->get_range(h3b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h5b=0L;h5b<z->noab();++h5b) { 
       if (z->get_spin(p4b)==z->get_spin(h5b)) { 
        if ((z->get_sym(p4b)^z->get_sym(h5b))==z->irrep_t()) { 
         long p4b_0,h5b_0; 
         z->restricted_2(p4b,h5b,p4b_0,h5b_0); 
         long h5b_1,h3b_1; 
         z->restricted_2(h5b,h3b,h5b_1,h3b_1); 
         long dim_common=z->get_range(h5b); 
         long dima0_sort=z->get_range(p4b); 
         long dima0=dim_common*dima0_sort; 
         long dima1_sort=z->get_range(h3b); 
         long dima1=dim_common*dima1_sort; 
         if (dima0>0L && dima1>0L) { 
          double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
          double* k_a0=z->mem()->malloc_local_double(dima0); 
          z->t1()->get_block(h5b_0+z->noab()*(p4b_0-z->noab()),k_a0); 
          z->sort_indices2(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(h5b),0,1,+1.0,false); 
          z->mem()->free_local_double(k_a0); 
          double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
          double* k_a1=z->mem()->malloc_local_double(dima1); 
          kn[12]->get_block(h3b_1+z->noab()*(h5b_1),k_a1); 
          z->sort_indices2(k_a1,k_a1_sort,z->get_range(h5b),z->get_range(h3b),1,0,+1.0,false); 
          z->mem()->free_local_double(k_a1); 
          double factor=1.0; 
          z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
          z->mem()->free_local_double(k_a1_sort); 
          z->mem()->free_local_double(k_a0_sort); 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h3b),z->get_range(p4b),1,0,-1.0,false); 
      in[2]->add_block(h3b+z->noab()*(p4b-z->noab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_41(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    long tileoffset; 
    tileoffset=(h4b+z->noab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(p5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(p5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_t()^z->irrep_v())) { 
        long dimc=z->get_range(h2b)*z->get_range(p5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h6b=0L;h6b<z->noab();++h6b) { 
         if (z->get_spin(p5b)==z->get_spin(h6b)) { 
          if ((z->get_sym(p5b)^z->get_sym(h6b))==z->irrep_t()) { 
           long p5b_0,h6b_0; 
           z->restricted_2(p5b,h6b,p5b_0,h6b_0); 
           long h2b_1,h6b_1,h3b_1,h4b_1; 
           z->restricted_4(h2b,h6b,h3b,h4b,h2b_1,h6b_1,h3b_1,h4b_1); 
           long dim_common=z->get_range(h6b); 
           long dima0_sort=z->get_range(p5b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b)*z->get_range(h3b)*z->get_range(h4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->t1()->get_block(h6b_0+z->noab()*(p5b_0-z->noab()),k_a0); 
            z->sort_indices2(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(h6b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (h2b<h6b) { 
             kn[14]->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(h6b_1+z->noab()*(h2b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h6b),z->get_range(h3b),z->get_range(h4b),3,2,0,1,+1.0,false); 
            } 
            else if (h6b<=h2b) { 
             kn[14]->get_block(h4b_1+z->noab()*(h3b_1+z->noab()*(h2b_1+z->noab()*(h6b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h2b),z->get_range(h3b),z->get_range(h4b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h3b),z->get_range(h2b),z->get_range(p5b),2,3,1,0,+0.5,false); 
        in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_42(){ 
      
for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
 for (long h3b=0L;h3b<z->noab();++h3b) { 
  long tileoffset; 
  tileoffset=(h3b+z->noab()*(q4b-z->noab()-z->nvab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(q4b)+z->get_spin(h3b)!=4L) { 
    if (z->get_spin(q4b)==z->get_spin(h3b)) { 
     if ((z->get_sym(q4b)^z->get_sym(h3b))==(z->irrep_e()^z->irrep_v())) { 
      long dimc=z->get_range(q4b)*z->get_range(h3b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h6b=0L;h6b<z->noab();++h6b) { 
       for (long h7b=h6b;h7b<z->noab();++h7b) { 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(q4b)+z->get_spin(q5b)==z->get_spin(h6b)+z->get_spin(h7b)) { 
          if ((z->get_sym(q4b)^(z->get_sym(q5b)^(z->get_sym(h6b)^z->get_sym(h7b))))==z->irrep_e()) { 
           long q4b_0,q5b_0,h6b_0,h7b_0; 
           z->restricted_4(q4b,q5b,h6b,h7b,q4b_0,q5b_0,h6b_0,h7b_0); 
           long h6b_1,h7b_1,h3b_1,q5b_1; 
           z->restricted_4(h6b,h7b,h3b,q5b,h6b_1,h7b_1,h3b_1,q5b_1); 
           long dim_common=z->get_range(h6b)*z->get_range(h7b)*z->get_range(q5b); 
           long dima0_sort=z->get_range(q4b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h3b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (q4b<q5b) { 
             z->qx()->get_block(h7b_0+z->noab()*(h6b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q5b),z->get_range(h6b),z->get_range(h7b),0,1,3,2,+1.0,false); 
            } 
            else if (q5b<=q4b) { 
             z->qx()->get_block(h7b_0+z->noab()*(h6b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q4b),z->get_range(h6b),z->get_range(h7b),1,0,3,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[2]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(h3b_1+z->noab()*(h7b_1+z->noab()*(h6b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h7b),z->get_range(h3b),z->get_range(q5b),2,3,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h6b==h7b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h3b),z->get_range(q4b),1,0,-0.5/0.5,false); 
      in[2]->add_block(h3b+z->noab()*(q4b-z->noab()-z->nvab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_44(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=0L;h4b<z->noab();++h4b) { 
    long tileoffset; 
    if (h3b<h4b) { 
     tileoffset=(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    } 
    else if (h4b<=h3b) { 
     tileoffset=(h3b+z->noab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    } 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h7b=0L;h7b<z->noab();++h7b) { 
         for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
          if (z->get_spin(q5b)+z->get_spin(q6b)==z->get_spin(h3b)+z->get_spin(h7b)) { 
           if ((z->get_sym(q5b)^(z->get_sym(q6b)^(z->get_sym(h3b)^z->get_sym(h7b))))==z->irrep_e()) { 
            long q5b_0,q6b_0,h3b_0,h7b_0; 
            z->restricted_4(q5b,q6b,h3b,h7b,q5b_0,q6b_0,h3b_0,h7b_0); 
            long h2b_1,h7b_1,h4b_1,q6b_1; 
            z->restricted_4(h2b,h7b,h4b,q6b,h2b_1,h7b_1,h4b_1,q6b_1); 
            long dim_common=z->get_range(h7b)*z->get_range(q6b); 
            long dima0_sort=z->get_range(q5b)*z->get_range(h3b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h2b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (q5b<q6b && h3b<h7b) { 
              z->qx()->get_block(h7b_0+z->noab()*(h3b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q6b),z->get_range(h3b),z->get_range(h7b),2,0,1,3,+1.0,false); 
             } 
             else if (q5b<q6b && h7b<=h3b) { 
              z->qx()->get_block(h3b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q6b),z->get_range(h7b),z->get_range(h3b),3,0,1,2,-1.0,false); 
             } 
             else if (q6b<=q5b && h3b<h7b) { 
              z->qx()->get_block(h7b_0+z->noab()*(h3b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q5b),z->get_range(h3b),z->get_range(h7b),2,1,0,3,-1.0,false); 
             } 
             else if (q6b<=q5b && h7b<=h3b) { 
              z->qx()->get_block(h3b_0+z->noab()*(h7b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q5b),z->get_range(h7b),z->get_range(h3b),3,1,0,2,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h2b<h7b) { 
              kn[2]->get_block(q6b_1-z->noab()-z->nvab()+z->ncab()*(h4b_1+z->noab()*(h7b_1+z->noab()*(h2b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h7b),z->get_range(h4b),z->get_range(q6b),2,0,3,1,+1.0,false); 
             } 
             else if (h7b<=h2b) { 
              kn[2]->get_block(q6b_1-z->noab()-z->nvab()+z->ncab()*(h4b_1+z->noab()*(h2b_1+z->noab()*(h7b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h2b),z->get_range(h4b),z->get_range(q6b),2,1,3,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h3b),z->get_range(q5b),1,3,2,0,+1.0,false); 
         in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        } 
        if (h3b>=h4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h3b),z->get_range(q5b),1,3,0,2,-1.0,false); 
         in[2]->add_block(h3b+z->noab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_45(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=0L;h4b<z->noab();++h4b) { 
    long tileoffset; 
    if (h3b<h4b) { 
     tileoffset=(h4b+z->noab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b)))); 
    } 
    else if (h4b<=h3b) { 
     tileoffset=(h3b+z->noab()*(h4b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b)))); 
    } 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(p5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(p5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(p5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(h2b)*z->get_range(p5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h7b=0L;h7b<z->noab();++h7b) { 
         for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
          if (z->get_spin(p5b)+z->get_spin(q6b)==z->get_spin(h3b)+z->get_spin(h7b)) { 
           if ((z->get_sym(p5b)^(z->get_sym(q6b)^(z->get_sym(h3b)^z->get_sym(h7b))))==z->irrep_e()) { 
            long p5b_0,q6b_0,h3b_0,h7b_0; 
            z->restricted_4(p5b,q6b,h3b,h7b,p5b_0,q6b_0,h3b_0,h7b_0); 
            long h2b_1,h7b_1,h4b_1,q6b_1; 
            z->restricted_4(h2b,h7b,h4b,q6b,h2b_1,h7b_1,h4b_1,q6b_1); 
            long dim_common=z->get_range(h7b)*z->get_range(q6b); 
            long dima0_sort=z->get_range(p5b)*z->get_range(h3b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h2b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h3b<h7b) { 
              z->qy()->get_block(h7b_0+z->noab()*(h3b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(p5b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(q6b),z->get_range(h3b),z->get_range(h7b),2,0,1,3,+1.0,false); 
             } 
             else if (h7b<=h3b) { 
              z->qy()->get_block(h3b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(p5b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p5b),z->get_range(q6b),z->get_range(h7b),z->get_range(h3b),3,0,1,2,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h2b<h7b) { 
              kn[2]->get_block(q6b_1-z->noab()-z->nvab()+z->ncab()*(h4b_1+z->noab()*(h7b_1+z->noab()*(h2b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h7b),z->get_range(h4b),z->get_range(q6b),2,0,3,1,+1.0,false); 
             } 
             else if (h7b<=h2b) { 
              kn[2]->get_block(q6b_1-z->noab()-z->nvab()+z->ncab()*(h4b_1+z->noab()*(h2b_1+z->noab()*(h7b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h2b),z->get_range(h4b),z->get_range(q6b),2,1,3,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h3b),z->get_range(p5b),1,3,2,0,+1.0,false); 
         in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b))),k_c); 
        } 
        if (h3b>=h4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h2b),z->get_range(h3b),z->get_range(p5b),1,3,0,2,-1.0,false); 
         in[2]->add_block(h3b+z->noab()*(h4b+z->noab()*(p5b-z->noab()+z->nvab()*(h2b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_46(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=0L;h4b<z->noab();++h4b) { 
  for (long h5b=0L;h5b<z->noab();++h5b) { 
   for (long h6b=h5b;h6b<z->noab();++h6b) { 
    long tileoffset; 
    if (h3b<h4b) { 
     tileoffset=(h6b+z->noab()*(h5b+z->noab()*(h4b+z->noab()*(h3b)))); 
    } 
    else if (h4b<=h3b) { 
     tileoffset=(h6b+z->noab()*(h5b+z->noab()*(h3b+z->noab()*(h4b)))); 
    } 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h5b)+z->get_spin(h6b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h5b)+z->get_spin(h6b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h5b)^z->get_sym(h6b))))==(z->irrep_y()^(z->irrep_t()^z->irrep_v()))) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h5b)*z->get_range(h6b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h7b=0L;h7b<z->noab();++h7b) { 
         if (z->get_spin(h3b)+z->get_spin(h7b)==z->get_spin(h5b)+z->get_spin(h6b)) { 
          if ((z->get_sym(h3b)^(z->get_sym(h7b)^(z->get_sym(h5b)^z->get_sym(h6b))))==z->irrep_y()) { 
           long h3b_0,h7b_0,h5b_0,h6b_0; 
           z->restricted_4(h3b,h7b,h5b,h6b,h3b_0,h7b_0,h5b_0,h6b_0); 
           long h4b_1,h7b_1; 
           z->restricted_2(h4b,h7b,h4b_1,h7b_1); 
           long dim_common=z->get_range(h7b); 
           long dima0_sort=z->get_range(h3b)*z->get_range(h5b)*z->get_range(h6b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (h3b<h7b) { 
             z->glambda2()->get_block(h6b_0+z->noab()*(h5b_0+z->noab()*(h7b_0+z->noab()*(h3b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h3b),z->get_range(h7b),z->get_range(h5b),z->get_range(h6b),3,2,0,1,+1.0,false); 
            } 
            else if (h7b<=h3b) { 
             z->glambda2()->get_block(h6b_0+z->noab()*(h5b_0+z->noab()*(h3b_0+z->noab()*(h7b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h7b),z->get_range(h3b),z->get_range(h5b),z->get_range(h6b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            in[3]->get_block(h7b_1+z->noab()*(h4b_1),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(h7b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        if (h4b>=h3b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h6b),z->get_range(h5b),z->get_range(h3b),3,0,2,1,+1.0,false); 
         in[2]->add_block(h6b+z->noab()*(h5b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
        } 
        if (h3b>=h4b) { 
         z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h6b),z->get_range(h5b),z->get_range(h3b),0,3,2,1,-1.0,false); 
         in[2]->add_block(h6b+z->noab()*(h5b+z->noab()*(h3b+z->noab()*(h4b))),k_c); 
        } 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_2_46(){ 
 
long size=0L; 
for (long h4b=0L;h4b<z->noab();++h4b) { 
 for (long h7b=0L;h7b<z->noab();++h7b) { 
  if (z->get_spin(h4b)==z->get_spin(h7b)) { 
   if ((z->get_sym(h4b)^z->get_sym(h7b))==(z->irrep_t()^z->irrep_v())) { 
    if (!z->restricted() || z->get_spin(h4b)+z->get_spin(h7b)!=4L) { 
     in[3]->input_offset(h7b+z->noab()*(h4b),size); 
     size+=z->get_range(h4b)*z->get_range(h7b); 
    } 
   } 
  } 
 } 
} 
in[3]->set_filesize(size); 
in[3]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_47(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h5b=0L;h5b<z->noab();++h5b) { 
   for (long h6b=h5b;h6b<z->noab();++h6b) { 
    long tileoffset; 
    tileoffset=(h6b+z->noab()*(h5b+z->noab()*(h4b+z->noab()*(h3b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h5b)+z->get_spin(h6b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h5b)+z->get_spin(h6b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h5b)^z->get_sym(h6b))))==(z->irrep_y()^(z->irrep_t()^z->irrep_v()))) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h5b)*z->get_range(h6b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h7b=0L;h7b<z->noab();++h7b) { 
         for (long h8b=h7b;h8b<z->noab();++h8b) { 
          if (z->get_spin(h7b)+z->get_spin(h8b)==z->get_spin(h5b)+z->get_spin(h6b)) { 
           if ((z->get_sym(h7b)^(z->get_sym(h8b)^(z->get_sym(h5b)^z->get_sym(h6b))))==z->irrep_y()) { 
            long h7b_0,h8b_0,h5b_0,h6b_0; 
            z->restricted_4(h7b,h8b,h5b,h6b,h7b_0,h8b_0,h5b_0,h6b_0); 
            long h3b_1,h4b_1,h7b_1,h8b_1; 
            z->restricted_4(h3b,h4b,h7b,h8b,h3b_1,h4b_1,h7b_1,h8b_1); 
            long dim_common=z->get_range(h7b)*z->get_range(h8b); 
            long dima0_sort=z->get_range(h5b)*z->get_range(h6b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h3b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->glambda2()->get_block(h6b_0+z->noab()*(h5b_0+z->noab()*(h8b_0+z->noab()*(h7b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(h5b),z->get_range(h6b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             in[3]->get_block(h8b_1+z->noab()*(h7b_1+z->noab()*(h4b_1+z->noab()*(h3b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h7b),z->get_range(h8b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (h7b==h8b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h3b),z->get_range(h6b),z->get_range(h5b),1,0,3,2,+0.5/0.5,false); 
        in[2]->add_block(h6b+z->noab()*(h5b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::offset_smith_2_47(){ 
 
long size=0L; 
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h7b=0L;h7b<z->noab();++h7b) { 
   for (long h8b=h7b;h8b<z->noab();++h8b) { 
    if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
     if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h7b)^z->get_sym(h8b))))==(z->irrep_t()^z->irrep_v())) { 
      if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h7b)+z->get_spin(h8b)!=8L) { 
       in[3]->input_offset(h8b+z->noab()*(h7b+z->noab()*(h4b+z->noab()*(h3b))),size); 
       size+=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h7b)*z->get_range(h8b); 
      } 
     } 
    } 
   } 
  } 
 } 
} 
in[3]->set_filesize(size); 
in[3]->createfile(); 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_5(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h3b=0L;h3b<z->noab();++h3b) { 
   for (long h4b=h3b;h4b<z->noab();++h4b) { 
    long tileoffset; 
    tileoffset=(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h3b)+z->get_spin(h4b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h3b)^z->get_sym(h4b))))==(z->irrep_e()^z->irrep_f())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
         if (z->get_spin(q5b)+z->get_spin(q6b)==z->get_spin(h3b)+z->get_spin(h4b)) { 
          if ((z->get_sym(q5b)^(z->get_sym(q6b)^(z->get_sym(h3b)^z->get_sym(h4b))))==z->irrep_e()) { 
           long q5b_0,q6b_0,h3b_0,h4b_0; 
           z->restricted_4(q5b,q6b,h3b,h4b,q5b_0,q6b_0,h3b_0,h4b_0); 
           long h2b_1,q6b_1; 
           z->restricted_2(h2b,q6b,h2b_1,q6b_1); 
           long dim_common=z->get_range(q6b); 
           long dima0_sort=z->get_range(q5b)*z->get_range(h3b)*z->get_range(h4b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (q5b<q6b) { 
             z->qx()->get_block(h4b_0+z->noab()*(h3b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q6b),z->get_range(h3b),z->get_range(h4b),3,2,0,1,+1.0,false); 
            } 
            else if (q6b<=q5b) { 
             z->qx()->get_block(h4b_0+z->noab()*(h3b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q5b),z->get_range(h3b),z->get_range(h4b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            z->f1()->get_block(q6b_1+(z->nab())*(h2b_1),k_a1); 
            z->sort_indices2(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q6b),0,1,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h2b),z->get_range(h4b),z->get_range(h3b),z->get_range(q5b),0,3,2,1,+1.0,false); 
        in[2]->add_block(h4b+z->noab()*(h3b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_52(){ 
      
for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
 for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
  long tileoffset; 
  tileoffset=(p2b-z->noab()+z->nvab()*(q5b-z->noab()-z->nvab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(q5b)+z->get_spin(p2b)!=4L) { 
    if (z->get_spin(q5b)==z->get_spin(p2b)) { 
     if ((z->get_sym(q5b)^z->get_sym(p2b))==(z->irrep_e()^z->irrep_v())) { 
      long dimc=z->get_range(q5b)*z->get_range(p2b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h7b=0L;h7b<z->noab();++h7b) { 
       for (long h8b=h7b;h8b<z->noab();++h8b) { 
        for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
         if (z->get_spin(q5b)+z->get_spin(q6b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
          if ((z->get_sym(q5b)^(z->get_sym(q6b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_e()) { 
           long q5b_0,q6b_0,h7b_0,h8b_0; 
           z->restricted_4(q5b,q6b,h7b,h8b,q5b_0,q6b_0,h7b_0,h8b_0); 
           long h7b_1,h8b_1,p2b_1,q6b_1; 
           z->restricted_4(h7b,h8b,p2b,q6b,h7b_1,h8b_1,p2b_1,q6b_1); 
           long dim_common=z->get_range(h7b)*z->get_range(h8b)*z->get_range(q6b); 
           long dima0_sort=z->get_range(q5b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (q5b<q6b) { 
             z->qx()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q6b),z->get_range(h7b),z->get_range(h8b),0,1,3,2,+1.0,false); 
            } 
            else if (q6b<=q5b) { 
             z->qx()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q5b),z->get_range(h7b),z->get_range(h8b),1,0,3,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            z->v2()->get_block(q6b_1+(z->nab())*(p2b_1+(z->nab())*(h8b_1+(z->nab())*(h7b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(p2b),z->get_range(q6b),2,3,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h7b==h8b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p2b),z->get_range(q5b),1,0,-0.5/0.5,false); 
      in[2]->add_block(p2b-z->noab()+z->nvab()*(q5b-z->noab()-z->nvab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_55(){ 
      
for (long h6b=0L;h6b<z->noab();++h6b) { 
 for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
  for (long h2b=0L;h2b<z->noab();++h2b) { 
   for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
    long tileoffset; 
    tileoffset=(q5b-z->noab()-z->nvab()+z->ncab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(h6b)))); 
    if (in[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h6b)+z->get_spin(p3b)+z->get_spin(h2b)+z->get_spin(q5b)!=8L) { 
      if (z->get_spin(h6b)+z->get_spin(p3b)==z->get_spin(h2b)+z->get_spin(q5b)) { 
       if ((z->get_sym(h6b)^(z->get_sym(p3b)^(z->get_sym(h2b)^z->get_sym(q5b))))==(z->irrep_e()^z->irrep_v())) { 
        long dimc=z->get_range(h6b)*z->get_range(p3b)*z->get_range(h2b)*z->get_range(q5b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h8b=0L;h8b<z->noab();++h8b) { 
         for (long q7b=z->noab()+z->nvab();q7b<z->nab();++q7b) { 
          if (z->get_spin(p3b)+z->get_spin(q7b)==z->get_spin(h2b)+z->get_spin(h8b)) { 
           if ((z->get_sym(p3b)^(z->get_sym(q7b)^(z->get_sym(h2b)^z->get_sym(h8b))))==z->irrep_e()) { 
            long p3b_0,q7b_0,h2b_0,h8b_0; 
            z->restricted_4(p3b,q7b,h2b,h8b,p3b_0,q7b_0,h2b_0,h8b_0); 
            long h6b_1,h8b_1,q5b_1,q7b_1; 
            z->restricted_4(h6b,h8b,q5b,q7b,h6b_1,h8b_1,q5b_1,q7b_1); 
            long dim_common=z->get_range(h8b)*z->get_range(q7b); 
            long dima0_sort=z->get_range(p3b)*z->get_range(h2b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h6b)*z->get_range(q5b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h2b<h8b) { 
              z->qy()->get_block(h8b_0+z->noab()*(h2b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q7b),z->get_range(h2b),z->get_range(h8b),2,0,1,3,+1.0,false); 
             } 
             else if (h8b<=h2b) { 
              z->qy()->get_block(h2b_0+z->noab()*(h8b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q7b),z->get_range(h8b),z->get_range(h2b),3,0,1,2,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h6b<h8b && q5b<q7b) { 
              z->v2()->get_block(q7b_1+(z->nab())*(q5b_1+(z->nab())*(h8b_1+(z->nab())*(h6b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h8b),z->get_range(q5b),z->get_range(q7b),2,0,3,1,+1.0,false); 
             } 
             else if (h6b<h8b && q7b<=q5b) { 
              z->v2()->get_block(q5b_1+(z->nab())*(q7b_1+(z->nab())*(h8b_1+(z->nab())*(h6b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h8b),z->get_range(q7b),z->get_range(q5b),3,0,2,1,-1.0,false); 
             } 
             else if (h8b<=h6b && q5b<q7b) { 
              z->v2()->get_block(q7b_1+(z->nab())*(q5b_1+(z->nab())*(h6b_1+(z->nab())*(h8b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h8b),z->get_range(h6b),z->get_range(q5b),z->get_range(q7b),2,1,3,0,-1.0,false); 
             } 
             else if (h8b<=h6b && q7b<=q5b) { 
              z->v2()->get_block(q5b_1+(z->nab())*(q7b_1+(z->nab())*(h6b_1+(z->nab())*(h8b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h8b),z->get_range(h6b),z->get_range(q7b),z->get_range(q5b),3,1,2,0,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q5b),z->get_range(h6b),z->get_range(h2b),z->get_range(p3b),1,3,2,0,-1.0,false); 
        in[2]->add_block(q5b-z->noab()-z->nvab()+z->ncab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(h6b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_61(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  long tileoffset; 
  tileoffset=(q5b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p3b)+z->get_spin(q5b)!=4L) { 
    if (z->get_spin(p3b)==z->get_spin(q5b)) { 
     if ((z->get_sym(p3b)^z->get_sym(q5b))==(z->irrep_e()^z->irrep_v())) { 
      long dimc=z->get_range(p3b)*z->get_range(q5b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h7b=0L;h7b<z->noab();++h7b) { 
       for (long h8b=h7b;h8b<z->noab();++h8b) { 
        for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
         if (z->get_spin(p3b)+z->get_spin(q6b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
          if ((z->get_sym(p3b)^(z->get_sym(q6b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_e()) { 
           long p3b_0,q6b_0,h7b_0,h8b_0; 
           z->restricted_4(p3b,q6b,h7b,h8b,p3b_0,q6b_0,h7b_0,h8b_0); 
           long h7b_1,h8b_1,q5b_1,q6b_1; 
           z->restricted_4(h7b,h8b,q5b,q6b,h7b_1,h8b_1,q5b_1,q6b_1); 
           long dim_common=z->get_range(h7b)*z->get_range(h8b)*z->get_range(q6b); 
           long dima0_sort=z->get_range(p3b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q5b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->qy()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q6b),z->get_range(h7b),z->get_range(h8b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (q5b<q6b) { 
             z->v2()->get_block(q6b_1+(z->nab())*(q5b_1+(z->nab())*(h8b_1+(z->nab())*(h7b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(q5b),z->get_range(q6b),2,3,1,0,+1.0,false); 
            } 
            else if (q6b<=q5b) { 
             z->v2()->get_block(q5b_1+(z->nab())*(q6b_1+(z->nab())*(h8b_1+(z->nab())*(h7b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(q6b),z->get_range(q5b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h7b==h8b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(q5b),z->get_range(p3b),1,0,+0.5/0.5,false); 
      in[2]->add_block(q5b-z->noab()-z->nvab()+z->ncab()*(p3b-z->noab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_2_62(){ 
      
for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
 for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
  long tileoffset; 
  tileoffset=(q2b-z->noab()-z->nvab()+z->ncab()*(q5b-z->noab()-z->nvab())); 
  if (in[2]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(q5b)+z->get_spin(q2b)!=4L) { 
    if (z->get_spin(q5b)==z->get_spin(q2b)) { 
     if ((z->get_sym(q5b)^z->get_sym(q2b))==(z->irrep_e()^z->irrep_v())) { 
      long dimc=z->get_range(q5b)*z->get_range(q2b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h7b=0L;h7b<z->noab();++h7b) { 
       for (long h8b=h7b;h8b<z->noab();++h8b) { 
        for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
         if (z->get_spin(q5b)+z->get_spin(q6b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
          if ((z->get_sym(q5b)^(z->get_sym(q6b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_e()) { 
           long q5b_0,q6b_0,h7b_0,h8b_0; 
           z->restricted_4(q5b,q6b,h7b,h8b,q5b_0,q6b_0,h7b_0,h8b_0); 
           long h7b_1,h8b_1,q2b_1,q6b_1; 
           z->restricted_4(h7b,h8b,q2b,q6b,h7b_1,h8b_1,q2b_1,q6b_1); 
           long dim_common=z->get_range(h7b)*z->get_range(h8b)*z->get_range(q6b); 
           long dima0_sort=z->get_range(q5b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (q5b<q6b) { 
             z->qx()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q6b),z->get_range(h7b),z->get_range(h8b),0,1,3,2,+1.0,false); 
            } 
            else if (q6b<=q5b) { 
             z->qx()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q5b),z->get_range(h7b),z->get_range(h8b),1,0,3,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (q2b<q6b) { 
             z->v2()->get_block(q6b_1+(z->nab())*(q2b_1+(z->nab())*(h8b_1+(z->nab())*(h7b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(q2b),z->get_range(q6b),2,3,1,0,+1.0,false); 
            } 
            else if (q6b<=q2b) { 
             z->v2()->get_block(q2b_1+(z->nab())*(q6b_1+(z->nab())*(h8b_1+(z->nab())*(h7b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(q6b),z->get_range(q2b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h7b==h8b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(q2b),z->get_range(q5b),1,0,-0.5/0.5,false); 
      in[2]->add_block(q2b-z->noab()-z->nvab()+z->ncab()*(q5b-z->noab()-z->nvab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_3_21(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  for (long h4b=0L;h4b<z->noab();++h4b) { 
   for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
    long tileoffset; 
    tileoffset=(p6b-z->noab()+z->nvab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b)))); 
    if (in[3]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(q5b)+z->get_spin(h4b)+z->get_spin(p6b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(q5b)==z->get_spin(h4b)+z->get_spin(p6b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(q5b)^(z->get_sym(h4b)^z->get_sym(p6b))))==(z->irrep_t()^z->irrep_v())) { 
        long dimc=z->get_range(h2b)*z->get_range(q5b)*z->get_range(h4b)*z->get_range(p6b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long p7b=z->noab();p7b<z->noab()+z->nvab();++p7b) { 
         if (z->get_spin(p7b)==z->get_spin(h4b)) { 
          if ((z->get_sym(p7b)^z->get_sym(h4b))==z->irrep_t()) { 
           long p7b_0,h4b_0; 
           z->restricted_2(p7b,h4b,p7b_0,h4b_0); 
           long h2b_1,q5b_1,p6b_1,p7b_1; 
           z->restricted_4(h2b,q5b,p6b,p7b,h2b_1,q5b_1,p6b_1,p7b_1); 
           long dim_common=z->get_range(p7b); 
           long dima0_sort=z->get_range(h4b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b)*z->get_range(q5b)*z->get_range(p6b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->t1()->get_block(h4b_0+z->noab()*(p7b_0-z->noab()),k_a0); 
            z->sort_indices2(k_a0,k_a0_sort,z->get_range(p7b),z->get_range(h4b),1,0,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (p6b<p7b) { 
             z->v2()->get_block(p7b_1+(z->nab())*(p6b_1+(z->nab())*(q5b_1+(z->nab())*(h2b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(p6b),z->get_range(p7b),2,1,0,3,+1.0,false); 
            } 
            else if (p7b<=p6b) { 
             z->v2()->get_block(p6b_1+(z->nab())*(p7b_1+(z->nab())*(q5b_1+(z->nab())*(h2b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(q5b),z->get_range(p7b),z->get_range(p6b),3,1,0,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(p6b),z->get_range(q5b),z->get_range(h2b),z->get_range(h4b),2,1,3,0,-0.5,false); 
        in[3]->add_block(p6b-z->noab()+z->nvab()*(h4b+z->noab()*(q5b-z->noab()-z->nvab()+z->ncab()*(h2b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_3_46(){ 
      
for (long h4b=0L;h4b<z->noab();++h4b) { 
 for (long h7b=0L;h7b<z->noab();++h7b) { 
  long tileoffset; 
  tileoffset=(h7b+z->noab()*(h4b)); 
  if (in[3]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h4b)+z->get_spin(h7b)!=4L) { 
    if (z->get_spin(h4b)==z->get_spin(h7b)) { 
     if ((z->get_sym(h4b)^z->get_sym(h7b))==(z->irrep_t()^z->irrep_v())) { 
      long dimc=z->get_range(h4b)*z->get_range(h7b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h10b=0L;h10b<z->noab();++h10b) { 
       for (long p8b=z->noab();p8b<z->noab()+z->nvab();++p8b) { 
        for (long p9b=p8b;p9b<z->noab()+z->nvab();++p9b) { 
         if (z->get_spin(p8b)+z->get_spin(p9b)==z->get_spin(h7b)+z->get_spin(h10b)) { 
          if ((z->get_sym(p8b)^(z->get_sym(p9b)^(z->get_sym(h7b)^z->get_sym(h10b))))==z->irrep_t()) { 
           long p8b_0,p9b_0,h7b_0,h10b_0; 
           z->restricted_4(p8b,p9b,h7b,h10b,p8b_0,p9b_0,h7b_0,h10b_0); 
           long h4b_1,h10b_1,p8b_1,p9b_1; 
           z->restricted_4(h4b,h10b,p8b,p9b,h4b_1,h10b_1,p8b_1,p9b_1); 
           long dim_common=z->get_range(h10b)*z->get_range(p8b)*z->get_range(p9b); 
           long dima0_sort=z->get_range(h7b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (h7b<h10b) { 
             z->t2()->get_block(h10b_0+z->noab()*(h7b_0+z->noab()*(p9b_0-z->noab()+z->nvab()*(p8b_0-z->noab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(p8b),z->get_range(p9b),z->get_range(h7b),z->get_range(h10b),2,1,0,3,+1.0,false); 
            } 
            else if (h10b<=h7b) { 
             z->t2()->get_block(h7b_0+z->noab()*(h10b_0+z->noab()*(p9b_0-z->noab()+z->nvab()*(p8b_0-z->noab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(p8b),z->get_range(p9b),z->get_range(h10b),z->get_range(h7b),3,1,0,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (h4b<h10b) { 
             z->v2()->get_block(p9b_1+(z->nab())*(p8b_1+(z->nab())*(h10b_1+(z->nab())*(h4b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(h10b),z->get_range(p8b),z->get_range(p9b),0,3,2,1,+1.0,false); 
            } 
            else if (h10b<=h4b) { 
             z->v2()->get_block(p9b_1+(z->nab())*(p8b_1+(z->nab())*(h4b_1+(z->nab())*(h10b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h10b),z->get_range(h4b),z->get_range(p8b),z->get_range(p9b),1,3,2,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (p8b==p9b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h4b),z->get_range(h7b),0,1,-0.5/0.5,false); 
      in[3]->add_block(h7b+z->noab()*(h4b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_3_47(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h7b=0L;h7b<z->noab();++h7b) { 
   for (long h8b=h7b;h8b<z->noab();++h8b) { 
    long tileoffset; 
    tileoffset=(h8b+z->noab()*(h7b+z->noab()*(h4b+z->noab()*(h3b)))); 
    if (in[3]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h7b)+z->get_spin(h8b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h7b)^z->get_sym(h8b))))==(z->irrep_t()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h7b)*z->get_range(h8b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long p9b=z->noab();p9b<z->noab()+z->nvab();++p9b) { 
         for (long p10b=p9b;p10b<z->noab()+z->nvab();++p10b) { 
          if (z->get_spin(p9b)+z->get_spin(p10b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
           if ((z->get_sym(p9b)^(z->get_sym(p10b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_t()) { 
            long p9b_0,p10b_0,h7b_0,h8b_0; 
            z->restricted_4(p9b,p10b,h7b,h8b,p9b_0,p10b_0,h7b_0,h8b_0); 
            long h3b_1,h4b_1,p9b_1,p10b_1; 
            z->restricted_4(h3b,h4b,p9b,p10b,h3b_1,h4b_1,p9b_1,p10b_1); 
            long dim_common=z->get_range(p9b)*z->get_range(p10b); 
            long dima0_sort=z->get_range(h7b)*z->get_range(h8b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h3b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->t2()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(p10b_0-z->noab()+z->nvab()*(p9b_0-z->noab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(p9b),z->get_range(p10b),z->get_range(h7b),z->get_range(h8b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             z->v2()->get_block(p10b_1+(z->nab())*(p9b_1+(z->nab())*(h4b_1+(z->nab())*(h3b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(p9b),z->get_range(p10b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (p9b==p10b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h3b),z->get_range(h8b),z->get_range(h7b),1,0,3,2,+0.5/0.5,false); 
        in[3]->add_block(h8b+z->noab()*(h7b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k0(){ 
      
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  long tileoffset; 
  tileoffset=(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab())); 
  if (kn[0]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q5b)!=4L) { 
    if (z->get_spin(p4b)==z->get_spin(q5b)) { 
     if ((z->get_sym(p4b)^z->get_sym(q5b))==(z->irrep_t()^z->irrep_y())) { 
      long dimc=z->get_range(p4b)*z->get_range(q5b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h7b=0L;h7b<z->noab();++h7b) { 
       for (long h8b=h7b;h8b<z->noab();++h8b) { 
        for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
         if (z->get_spin(p4b)+z->get_spin(p6b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
          if ((z->get_sym(p4b)^(z->get_sym(p6b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_t()) { 
           long p4b_0,p6b_0,h7b_0,h8b_0; 
           z->restricted_4(p4b,p6b,h7b,h8b,p4b_0,p6b_0,h7b_0,h8b_0); 
           long h7b_1,h8b_1,p6b_1,q5b_1; 
           z->restricted_4(h7b,h8b,p6b,q5b,h7b_1,h8b_1,p6b_1,q5b_1); 
           long dim_common=z->get_range(h7b)*z->get_range(h8b)*z->get_range(p6b); 
           long dima0_sort=z->get_range(p4b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q5b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (p4b<p6b) { 
             z->t2()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(p6b_0-z->noab()+z->nvab()*(p4b_0-z->noab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(p6b),z->get_range(h7b),z->get_range(h8b),0,1,3,2,+1.0,false); 
            } 
            else if (p6b<=p4b) { 
             z->t2()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(p4b_0-z->noab()+z->nvab()*(p6b_0-z->noab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(p4b),z->get_range(h7b),z->get_range(h8b),1,0,3,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            z->ly()->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(p6b_1-z->noab()+z->nvab()*(h8b_1+z->noab()*(h7b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(p6b),z->get_range(q5b),3,2,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h7b==h8b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(q5b),z->get_range(p4b),1,0,+0.5/0.5,false); 
      kn[0]->add_block(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k1(){ 
      
for (long h4b=0L;h4b<z->noab();++h4b) { 
 for (long h8b=h4b;h8b<z->noab();++h8b) { 
  for (long h6b=0L;h6b<z->noab();++h6b) { 
   for (long h7b=h6b;h7b<z->noab();++h7b) { 
    long tileoffset; 
    tileoffset=(h7b+z->noab()*(h6b+z->noab()*(h8b+z->noab()*(h4b)))); 
    if (kn[1]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h4b)+z->get_spin(h8b)+z->get_spin(h6b)+z->get_spin(h7b)!=8L) { 
      if (z->get_spin(h4b)+z->get_spin(h8b)==z->get_spin(h6b)+z->get_spin(h7b)) { 
       if ((z->get_sym(h4b)^(z->get_sym(h8b)^(z->get_sym(h6b)^z->get_sym(h7b))))==(z->irrep_y()^z->irrep_e())) { 
        long dimc=z->get_range(h4b)*z->get_range(h8b)*z->get_range(h6b)*z->get_range(h7b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h9b=0L;h9b<z->noab();++h9b) { 
         for (long h10b=h9b;h10b<z->noab();++h10b) { 
          if (z->get_spin(h4b)+z->get_spin(h8b)==z->get_spin(h9b)+z->get_spin(h10b)) { 
           if ((z->get_sym(h4b)^(z->get_sym(h8b)^(z->get_sym(h9b)^z->get_sym(h10b))))==z->irrep_y()) { 
            long h4b_0,h8b_0,h9b_0,h10b_0; 
            z->restricted_4(h4b,h8b,h9b,h10b,h4b_0,h8b_0,h9b_0,h10b_0); 
            long h9b_1,h10b_1,h6b_1,h7b_1; 
            z->restricted_4(h9b,h10b,h6b,h7b,h9b_1,h10b_1,h6b_1,h7b_1); 
            long dim_common=z->get_range(h9b)*z->get_range(h10b); 
            long dima0_sort=z->get_range(h4b)*z->get_range(h8b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h6b)*z->get_range(h7b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->glambda2()->get_block(h10b_0+z->noab()*(h9b_0+z->noab()*(h8b_0+z->noab()*(h4b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h4b),z->get_range(h8b),z->get_range(h9b),z->get_range(h10b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             z->xs2()->get_block(h7b_1+z->noab()*(h6b_1+z->noab()*(h10b_1+z->noab()*(h9b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h9b),z->get_range(h10b),z->get_range(h6b),z->get_range(h7b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (h9b==h10b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h7b),z->get_range(h6b),z->get_range(h8b),z->get_range(h4b),3,2,1,0,+0.5/0.5,false); 
        kn[1]->add_block(h7b+z->noab()*(h6b+z->noab()*(h8b+z->noab()*(h4b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k10(){ 
      
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  long tileoffset; 
  tileoffset=(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab())); 
  if (kn[10]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p4b)+z->get_spin(q5b)!=4L) { 
    if (z->get_spin(p4b)==z->get_spin(q5b)) { 
     if ((z->get_sym(p4b)^z->get_sym(q5b))==(z->irrep_e()^z->irrep_y())) { 
      long dimc=z->get_range(p4b)*z->get_range(q5b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h7b=0L;h7b<z->noab();++h7b) { 
       for (long h8b=h7b;h8b<z->noab();++h8b) { 
        for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
         if (z->get_spin(p4b)+z->get_spin(q6b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
          if ((z->get_sym(p4b)^(z->get_sym(q6b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_e()) { 
           long p4b_0,q6b_0,h7b_0,h8b_0; 
           z->restricted_4(p4b,q6b,h7b,h8b,p4b_0,q6b_0,h7b_0,h8b_0); 
           long h7b_1,h8b_1,q5b_1,q6b_1; 
           z->restricted_4(h7b,h8b,q5b,q6b,h7b_1,h8b_1,q5b_1,q6b_1); 
           long dim_common=z->get_range(h7b)*z->get_range(h8b)*z->get_range(q6b); 
           long dima0_sort=z->get_range(p4b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q5b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->qy()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(p4b_0-z->noab()))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(q6b),z->get_range(h7b),z->get_range(h8b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (q5b<q6b) { 
             z->lx()->get_block(q6b_1-z->noab()-z->nvab()+z->ncab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h8b_1+z->noab()*(h7b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(q5b),z->get_range(q6b),2,3,1,0,+1.0,false); 
            } 
            else if (q6b<=q5b) { 
             z->lx()->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(q6b_1-z->noab()-z->nvab()+z->ncab()*(h8b_1+z->noab()*(h7b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(q6b),z->get_range(q5b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h7b==h8b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(q5b),z->get_range(p4b),1,0,+0.5/0.5,false); 
      kn[10]->add_block(q5b-z->noab()-z->nvab()+z->ncab()*(p4b-z->noab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k11(){ 
      
for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
 for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
  long tileoffset; 
  tileoffset=(p5b-z->noab()+z->nvab()*(p3b-z->noab())); 
  if (kn[11]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p3b)+z->get_spin(p5b)!=4L) { 
    if (z->get_spin(p3b)==z->get_spin(p5b)) { 
     if ((z->get_sym(p3b)^z->get_sym(p5b))==(z->irrep_e()^z->irrep_y())) { 
      long dimc=z->get_range(p3b)*z->get_range(p5b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h7b=0L;h7b<z->noab();++h7b) { 
       for (long h8b=h7b;h8b<z->noab();++h8b) { 
        for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
         if (z->get_spin(p3b)+z->get_spin(q6b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
          if ((z->get_sym(p3b)^(z->get_sym(q6b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_e()) { 
           long p3b_0,q6b_0,h7b_0,h8b_0; 
           z->restricted_4(p3b,q6b,h7b,h8b,p3b_0,q6b_0,h7b_0,h8b_0); 
           long h7b_1,h8b_1,p5b_1,q6b_1; 
           z->restricted_4(h7b,h8b,p5b,q6b,h7b_1,h8b_1,p5b_1,q6b_1); 
           long dim_common=z->get_range(h7b)*z->get_range(h8b)*z->get_range(q6b); 
           long dima0_sort=z->get_range(p3b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p5b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->qy()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q6b),z->get_range(h7b),z->get_range(h8b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            z->ly()->get_block(q6b_1-z->noab()-z->nvab()+z->ncab()*(p5b_1-z->noab()+z->nvab()*(h8b_1+z->noab()*(h7b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(p5b),z->get_range(q6b),2,3,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h7b==h8b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p5b),z->get_range(p3b),1,0,+0.5/0.5,false); 
      kn[11]->add_block(p5b-z->noab()+z->nvab()*(p3b-z->noab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k12(){ 
      
for (long h4b=0L;h4b<z->noab();++h4b) { 
 for (long h5b=0L;h5b<z->noab();++h5b) { 
  long tileoffset; 
  tileoffset=(h5b+z->noab()*(h4b)); 
  if (kn[12]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(h4b)+z->get_spin(h5b)!=4L) { 
    if (z->get_spin(h4b)==z->get_spin(h5b)) { 
     if ((z->get_sym(h4b)^z->get_sym(h5b))==(z->irrep_t()^z->irrep_v())) { 
      long dimc=z->get_range(h4b)*z->get_range(h5b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h6b=0L;h6b<z->noab();++h6b) { 
       for (long h7b=h6b;h7b<z->noab();++h7b) { 
        for (long h8b=0L;h8b<z->noab();++h8b) { 
         if (z->get_spin(h6b)+z->get_spin(h7b)==z->get_spin(h5b)+z->get_spin(h8b)) { 
          if ((z->get_sym(h6b)^(z->get_sym(h7b)^(z->get_sym(h5b)^z->get_sym(h8b))))==z->irrep_t()) { 
           long h6b_0,h7b_0,h5b_0,h8b_0; 
           z->restricted_4(h6b,h7b,h5b,h8b,h6b_0,h7b_0,h5b_0,h8b_0); 
           long h4b_1,h8b_1,h6b_1,h7b_1; 
           z->restricted_4(h4b,h8b,h6b,h7b,h4b_1,h8b_1,h6b_1,h7b_1); 
           long dim_common=z->get_range(h6b)*z->get_range(h7b)*z->get_range(h8b); 
           long dima0_sort=z->get_range(h5b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h4b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (h5b<h8b) { 
             z->gt2()->get_block(h8b_0+z->noab()*(h5b_0+z->noab()*(h7b_0+z->noab()*(h6b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h6b),z->get_range(h7b),z->get_range(h5b),z->get_range(h8b),2,3,1,0,+1.0,false); 
            } 
            else if (h8b<=h5b) { 
             z->gt2()->get_block(h5b_0+z->noab()*(h8b_0+z->noab()*(h7b_0+z->noab()*(h6b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h6b),z->get_range(h7b),z->get_range(h8b),z->get_range(h5b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (h4b<h8b) { 
             kn[1]->get_block(h7b_1+z->noab()*(h6b_1+z->noab()*(h8b_1+z->noab()*(h4b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(h8b),z->get_range(h6b),z->get_range(h7b),0,1,3,2,+1.0,false); 
            } 
            else if (h8b<=h4b) { 
             kn[1]->get_block(h7b_1+z->noab()*(h6b_1+z->noab()*(h4b_1+z->noab()*(h8b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h8b),z->get_range(h4b),z->get_range(h6b),z->get_range(h7b),1,0,3,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h6b==h7b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h4b),z->get_range(h5b),0,1,+0.5/0.5,false); 
      kn[12]->add_block(h5b+z->noab()*(h4b),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k13(){ 
      
for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
 for (long h3b=0L;h3b<z->noab();++h3b) { 
  long tileoffset; 
  tileoffset=(h3b+z->noab()*(p4b-z->noab())); 
  if (kn[13]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(p4b)+z->get_spin(h3b)!=4L) { 
    if (z->get_spin(p4b)==z->get_spin(h3b)) { 
     if ((z->get_sym(p4b)^z->get_sym(h3b))==(z->irrep_e()^z->irrep_v())) { 
      long dimc=z->get_range(p4b)*z->get_range(h3b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h6b=0L;h6b<z->noab();++h6b) { 
       for (long h7b=h6b;h7b<z->noab();++h7b) { 
        for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
         if (z->get_spin(p4b)+z->get_spin(q5b)==z->get_spin(h6b)+z->get_spin(h7b)) { 
          if ((z->get_sym(p4b)^(z->get_sym(q5b)^(z->get_sym(h6b)^z->get_sym(h7b))))==z->irrep_e()) { 
           long p4b_0,q5b_0,h6b_0,h7b_0; 
           z->restricted_4(p4b,q5b,h6b,h7b,p4b_0,q5b_0,h6b_0,h7b_0); 
           long h6b_1,h7b_1,h3b_1,q5b_1; 
           z->restricted_4(h6b,h7b,h3b,q5b,h6b_1,h7b_1,h3b_1,q5b_1); 
           long dim_common=z->get_range(h6b)*z->get_range(h7b)*z->get_range(q5b); 
           long dima0_sort=z->get_range(p4b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h3b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->qy()->get_block(h7b_0+z->noab()*(h6b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(p4b_0-z->noab()))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(q5b),z->get_range(h6b),z->get_range(h7b),0,1,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            kn[2]->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(h3b_1+z->noab()*(h7b_1+z->noab()*(h6b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h7b),z->get_range(h3b),z->get_range(q5b),2,3,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h6b==h7b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(h3b),z->get_range(p4b),1,0,+0.5/0.5,false); 
      kn[13]->add_block(h3b+z->noab()*(p4b-z->noab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k14(){ 
      
for (long h3b=0L;h3b<z->noab();++h3b) { 
 for (long h4b=h3b;h4b<z->noab();++h4b) { 
  for (long h5b=0L;h5b<z->noab();++h5b) { 
   for (long h6b=h5b;h6b<z->noab();++h6b) { 
    long tileoffset; 
    tileoffset=(h6b+z->noab()*(h5b+z->noab()*(h4b+z->noab()*(h3b)))); 
    if (kn[14]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h3b)+z->get_spin(h4b)+z->get_spin(h5b)+z->get_spin(h6b)!=8L) { 
      if (z->get_spin(h3b)+z->get_spin(h4b)==z->get_spin(h5b)+z->get_spin(h6b)) { 
       if ((z->get_sym(h3b)^(z->get_sym(h4b)^(z->get_sym(h5b)^z->get_sym(h6b))))==(z->irrep_t()^z->irrep_v())) { 
        long dimc=z->get_range(h3b)*z->get_range(h4b)*z->get_range(h5b)*z->get_range(h6b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h7b=0L;h7b<z->noab();++h7b) { 
         for (long h8b=h7b;h8b<z->noab();++h8b) { 
          if (z->get_spin(h7b)+z->get_spin(h8b)==z->get_spin(h5b)+z->get_spin(h6b)) { 
           if ((z->get_sym(h7b)^(z->get_sym(h8b)^(z->get_sym(h5b)^z->get_sym(h6b))))==z->irrep_t()) { 
            long h7b_0,h8b_0,h5b_0,h6b_0; 
            z->restricted_4(h7b,h8b,h5b,h6b,h7b_0,h8b_0,h5b_0,h6b_0); 
            long h3b_1,h4b_1,h7b_1,h8b_1; 
            z->restricted_4(h3b,h4b,h7b,h8b,h3b_1,h4b_1,h7b_1,h8b_1); 
            long dim_common=z->get_range(h7b)*z->get_range(h8b); 
            long dima0_sort=z->get_range(h5b)*z->get_range(h6b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h3b)*z->get_range(h4b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             z->gt2()->get_block(h6b_0+z->noab()*(h5b_0+z->noab()*(h8b_0+z->noab()*(h7b_0))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(h5b),z->get_range(h6b),3,2,1,0,+1.0,false); 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             kn[1]->get_block(h8b_1+z->noab()*(h7b_1+z->noab()*(h4b_1+z->noab()*(h3b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h3b),z->get_range(h4b),z->get_range(h7b),z->get_range(h8b),1,0,3,2,+1.0,false); 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             if (h7b==h8b) { 
              factor=factor/2.0; 
             } 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(h4b),z->get_range(h3b),z->get_range(h6b),z->get_range(h5b),1,0,3,2,+0.5/0.5,false); 
        kn[14]->add_block(h6b+z->noab()*(h5b+z->noab()*(h4b+z->noab()*(h3b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k2(){ 
      
for (long h2b=0L;h2b<z->noab();++h2b) { 
 for (long h7b=h2b;h7b<z->noab();++h7b) { 
  for (long h4b=0L;h4b<z->noab();++h4b) { 
   for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
    long tileoffset; 
    tileoffset=(q6b-z->noab()-z->nvab()+z->ncab()*(h4b+z->noab()*(h7b+z->noab()*(h2b)))); 
    if (kn[2]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h2b)+z->get_spin(h7b)+z->get_spin(h4b)+z->get_spin(q6b)!=8L) { 
      if (z->get_spin(h2b)+z->get_spin(h7b)==z->get_spin(h4b)+z->get_spin(q6b)) { 
       if ((z->get_sym(h2b)^(z->get_sym(h7b)^(z->get_sym(h4b)^z->get_sym(q6b))))==(z->irrep_t()^z->irrep_y())) { 
        long dimc=z->get_range(h2b)*z->get_range(h7b)*z->get_range(h4b)*z->get_range(q6b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long p8b=z->noab();p8b<z->noab()+z->nvab();++p8b) { 
         if (z->get_spin(p8b)==z->get_spin(h4b)) { 
          if ((z->get_sym(p8b)^z->get_sym(h4b))==z->irrep_t()) { 
           long p8b_0,h4b_0; 
           z->restricted_2(p8b,h4b,p8b_0,h4b_0); 
           long h2b_1,h7b_1,p8b_1,q6b_1; 
           z->restricted_4(h2b,h7b,p8b,q6b,h2b_1,h7b_1,p8b_1,q6b_1); 
           long dim_common=z->get_range(p8b); 
           long dima0_sort=z->get_range(h4b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(h2b)*z->get_range(h7b)*z->get_range(q6b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->t1()->get_block(h4b_0+z->noab()*(p8b_0-z->noab()),k_a0); 
            z->sort_indices2(k_a0,k_a0_sort,z->get_range(p8b),z->get_range(h4b),1,0,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            z->ly()->get_block(q6b_1-z->noab()-z->nvab()+z->ncab()*(p8b_1-z->noab()+z->nvab()*(h7b_1+z->noab()*(h2b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h2b),z->get_range(h7b),z->get_range(p8b),z->get_range(q6b),3,1,0,2,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q6b),z->get_range(h7b),z->get_range(h2b),z->get_range(h4b),2,1,3,0,+1.0,false); 
        kn[2]->add_block(q6b-z->noab()-z->nvab()+z->ncab()*(h4b+z->noab()*(h7b+z->noab()*(h2b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k3(){ 
      
for (long h6b=0L;h6b<z->noab();++h6b) { 
 for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
  for (long h2b=0L;h2b<z->noab();++h2b) { 
   for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
    long tileoffset; 
    tileoffset=(q5b-z->noab()-z->nvab()+z->ncab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(h6b)))); 
    if (kn[3]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h6b)+z->get_spin(q4b)+z->get_spin(h2b)+z->get_spin(q5b)!=8L) { 
      if (z->get_spin(h6b)+z->get_spin(q4b)==z->get_spin(h2b)+z->get_spin(q5b)) { 
       if ((z->get_sym(h6b)^(z->get_sym(q4b)^(z->get_sym(h2b)^z->get_sym(q5b))))==(z->irrep_e()^z->irrep_y())) { 
        long dimc=z->get_range(h6b)*z->get_range(q4b)*z->get_range(h2b)*z->get_range(q5b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h8b=0L;h8b<z->noab();++h8b) { 
         for (long q7b=z->noab()+z->nvab();q7b<z->nab();++q7b) { 
          if (z->get_spin(q4b)+z->get_spin(q7b)==z->get_spin(h2b)+z->get_spin(h8b)) { 
           if ((z->get_sym(q4b)^(z->get_sym(q7b)^(z->get_sym(h2b)^z->get_sym(h8b))))==z->irrep_e()) { 
            long q4b_0,q7b_0,h2b_0,h8b_0; 
            z->restricted_4(q4b,q7b,h2b,h8b,q4b_0,q7b_0,h2b_0,h8b_0); 
            long h6b_1,h8b_1,q5b_1,q7b_1; 
            z->restricted_4(h6b,h8b,q5b,q7b,h6b_1,h8b_1,q5b_1,q7b_1); 
            long dim_common=z->get_range(h8b)*z->get_range(q7b); 
            long dima0_sort=z->get_range(q4b)*z->get_range(h2b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h6b)*z->get_range(q5b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (q4b<q7b && h2b<h8b) { 
              z->qx()->get_block(h8b_0+z->noab()*(h2b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q7b),z->get_range(h2b),z->get_range(h8b),2,0,1,3,+1.0,false); 
             } 
             else if (q4b<q7b && h8b<=h2b) { 
              z->qx()->get_block(h2b_0+z->noab()*(h8b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(q4b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q4b),z->get_range(q7b),z->get_range(h8b),z->get_range(h2b),3,0,1,2,-1.0,false); 
             } 
             else if (q7b<=q4b && h2b<h8b) { 
              z->qx()->get_block(h8b_0+z->noab()*(h2b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(q7b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q7b),z->get_range(q4b),z->get_range(h2b),z->get_range(h8b),2,1,0,3,-1.0,false); 
             } 
             else if (q7b<=q4b && h8b<=h2b) { 
              z->qx()->get_block(h2b_0+z->noab()*(h8b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(q7b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q7b),z->get_range(q4b),z->get_range(h8b),z->get_range(h2b),3,1,0,2,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h6b<h8b && q5b<q7b) { 
              z->lx()->get_block(q7b_1-z->noab()-z->nvab()+z->ncab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h8b_1+z->noab()*(h6b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h8b),z->get_range(q5b),z->get_range(q7b),2,0,3,1,+1.0,false); 
             } 
             else if (h6b<h8b && q7b<=q5b) { 
              z->lx()->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(q7b_1-z->noab()-z->nvab()+z->ncab()*(h8b_1+z->noab()*(h6b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h8b),z->get_range(q7b),z->get_range(q5b),3,0,2,1,-1.0,false); 
             } 
             else if (h8b<=h6b && q5b<q7b) { 
              z->lx()->get_block(q7b_1-z->noab()-z->nvab()+z->ncab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h6b_1+z->noab()*(h8b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h8b),z->get_range(h6b),z->get_range(q5b),z->get_range(q7b),2,1,3,0,-1.0,false); 
             } 
             else if (h8b<=h6b && q7b<=q5b) { 
              z->lx()->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(q7b_1-z->noab()-z->nvab()+z->ncab()*(h6b_1+z->noab()*(h8b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h8b),z->get_range(h6b),z->get_range(q7b),z->get_range(q5b),3,1,2,0,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q5b),z->get_range(h6b),z->get_range(h2b),z->get_range(q4b),1,3,2,0,+1.0,false); 
        kn[3]->add_block(q5b-z->noab()-z->nvab()+z->ncab()*(h2b+z->noab()*(q4b-z->noab()-z->nvab()+z->ncab()*(h6b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k4(){ 
      
for (long h4b=0L;h4b<z->noab();++h4b) { 
 for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
  for (long h5b=0L;h5b<z->noab();++h5b) { 
   for (long p1b=z->noab();p1b<z->noab()+z->nvab();++p1b) { 
    long tileoffset; 
    tileoffset=(p1b-z->noab()+z->nvab()*(h5b+z->noab()*(q6b-z->noab()-z->nvab()+z->ncab()*(h4b)))); 
    if (kn[4]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h4b)+z->get_spin(q6b)+z->get_spin(h5b)+z->get_spin(p1b)!=8L) { 
      if (z->get_spin(h4b)+z->get_spin(q6b)==z->get_spin(h5b)+z->get_spin(p1b)) { 
       if ((z->get_sym(h4b)^(z->get_sym(q6b)^(z->get_sym(h5b)^z->get_sym(p1b))))==(z->irrep_e()^z->irrep_y())) { 
        long dimc=z->get_range(h4b)*z->get_range(q6b)*z->get_range(h5b)*z->get_range(p1b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h8b=0L;h8b<z->noab();++h8b) { 
         for (long q7b=z->noab()+z->nvab();q7b<z->nab();++q7b) { 
          if (z->get_spin(q6b)+z->get_spin(q7b)==z->get_spin(h5b)+z->get_spin(h8b)) { 
           if ((z->get_sym(q6b)^(z->get_sym(q7b)^(z->get_sym(h5b)^z->get_sym(h8b))))==z->irrep_e()) { 
            long q6b_0,q7b_0,h5b_0,h8b_0; 
            z->restricted_4(q6b,q7b,h5b,h8b,q6b_0,q7b_0,h5b_0,h8b_0); 
            long h4b_1,h8b_1,p1b_1,q7b_1; 
            z->restricted_4(h4b,h8b,p1b,q7b,h4b_1,h8b_1,p1b_1,q7b_1); 
            long dim_common=z->get_range(h8b)*z->get_range(q7b); 
            long dima0_sort=z->get_range(q6b)*z->get_range(h5b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h4b)*z->get_range(p1b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (q6b<q7b && h5b<h8b) { 
              z->qx()->get_block(h8b_0+z->noab()*(h5b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q7b),z->get_range(h5b),z->get_range(h8b),2,0,1,3,+1.0,false); 
             } 
             else if (q6b<q7b && h8b<=h5b) { 
              z->qx()->get_block(h5b_0+z->noab()*(h8b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q7b),z->get_range(h8b),z->get_range(h5b),3,0,1,2,-1.0,false); 
             } 
             else if (q7b<=q6b && h5b<h8b) { 
              z->qx()->get_block(h8b_0+z->noab()*(h5b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q7b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q7b),z->get_range(q6b),z->get_range(h5b),z->get_range(h8b),2,1,0,3,-1.0,false); 
             } 
             else if (q7b<=q6b && h8b<=h5b) { 
              z->qx()->get_block(h5b_0+z->noab()*(h8b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q7b_0-z->noab()-z->nvab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(q7b),z->get_range(q6b),z->get_range(h8b),z->get_range(h5b),3,1,0,2,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h4b<h8b) { 
              z->ly()->get_block(q7b_1-z->noab()-z->nvab()+z->ncab()*(p1b_1-z->noab()+z->nvab()*(h8b_1+z->noab()*(h4b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h4b),z->get_range(h8b),z->get_range(p1b),z->get_range(q7b),2,0,3,1,+1.0,false); 
             } 
             else if (h8b<=h4b) { 
              z->ly()->get_block(q7b_1-z->noab()-z->nvab()+z->ncab()*(p1b_1-z->noab()+z->nvab()*(h4b_1+z->noab()*(h8b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h8b),z->get_range(h4b),z->get_range(p1b),z->get_range(q7b),2,1,3,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(p1b),z->get_range(h4b),z->get_range(h5b),z->get_range(q6b),1,3,2,0,+1.0,false); 
        kn[4]->add_block(p1b-z->noab()+z->nvab()*(h5b+z->noab()*(q6b-z->noab()-z->nvab()+z->ncab()*(h4b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k5(){ 
      
for (long h6b=0L;h6b<z->noab();++h6b) { 
 for (long p4b=z->noab();p4b<z->noab()+z->nvab();++p4b) { 
  for (long h2b=0L;h2b<z->noab();++h2b) { 
   for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
    long tileoffset; 
    tileoffset=(q5b-z->noab()-z->nvab()+z->ncab()*(h2b+z->noab()*(p4b-z->noab()+z->nvab()*(h6b)))); 
    if (kn[5]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h6b)+z->get_spin(p4b)+z->get_spin(h2b)+z->get_spin(q5b)!=8L) { 
      if (z->get_spin(h6b)+z->get_spin(p4b)==z->get_spin(h2b)+z->get_spin(q5b)) { 
       if ((z->get_sym(h6b)^(z->get_sym(p4b)^(z->get_sym(h2b)^z->get_sym(q5b))))==(z->irrep_e()^z->irrep_y())) { 
        long dimc=z->get_range(h6b)*z->get_range(p4b)*z->get_range(h2b)*z->get_range(q5b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h8b=0L;h8b<z->noab();++h8b) { 
         for (long q7b=z->noab()+z->nvab();q7b<z->nab();++q7b) { 
          if (z->get_spin(p4b)+z->get_spin(q7b)==z->get_spin(h2b)+z->get_spin(h8b)) { 
           if ((z->get_sym(p4b)^(z->get_sym(q7b)^(z->get_sym(h2b)^z->get_sym(h8b))))==z->irrep_e()) { 
            long p4b_0,q7b_0,h2b_0,h8b_0; 
            z->restricted_4(p4b,q7b,h2b,h8b,p4b_0,q7b_0,h2b_0,h8b_0); 
            long h6b_1,h8b_1,q5b_1,q7b_1; 
            z->restricted_4(h6b,h8b,q5b,q7b,h6b_1,h8b_1,q5b_1,q7b_1); 
            long dim_common=z->get_range(h8b)*z->get_range(q7b); 
            long dima0_sort=z->get_range(p4b)*z->get_range(h2b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h6b)*z->get_range(q5b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h2b<h8b) { 
              z->qy()->get_block(h8b_0+z->noab()*(h2b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(p4b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(q7b),z->get_range(h2b),z->get_range(h8b),2,0,1,3,+1.0,false); 
             } 
             else if (h8b<=h2b) { 
              z->qy()->get_block(h2b_0+z->noab()*(h8b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(p4b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p4b),z->get_range(q7b),z->get_range(h8b),z->get_range(h2b),3,0,1,2,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h6b<h8b && q5b<q7b) { 
              z->lx()->get_block(q7b_1-z->noab()-z->nvab()+z->ncab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h8b_1+z->noab()*(h6b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h8b),z->get_range(q5b),z->get_range(q7b),2,0,3,1,+1.0,false); 
             } 
             else if (h6b<h8b && q7b<=q5b) { 
              z->lx()->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(q7b_1-z->noab()-z->nvab()+z->ncab()*(h8b_1+z->noab()*(h6b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h8b),z->get_range(q7b),z->get_range(q5b),3,0,2,1,-1.0,false); 
             } 
             else if (h8b<=h6b && q5b<q7b) { 
              z->lx()->get_block(q7b_1-z->noab()-z->nvab()+z->ncab()*(q5b_1-z->noab()-z->nvab()+z->ncab()*(h6b_1+z->noab()*(h8b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h8b),z->get_range(h6b),z->get_range(q5b),z->get_range(q7b),2,1,3,0,-1.0,false); 
             } 
             else if (h8b<=h6b && q7b<=q5b) { 
              z->lx()->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(q7b_1-z->noab()-z->nvab()+z->ncab()*(h6b_1+z->noab()*(h8b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h8b),z->get_range(h6b),z->get_range(q7b),z->get_range(q5b),3,1,2,0,+1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(q5b),z->get_range(h6b),z->get_range(h2b),z->get_range(p4b),1,3,2,0,+1.0,false); 
        kn[5]->add_block(q5b-z->noab()-z->nvab()+z->ncab()*(h2b+z->noab()*(p4b-z->noab()+z->nvab()*(h6b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k6(){ 
      
for (long h6b=0L;h6b<z->noab();++h6b) { 
 for (long p3b=z->noab();p3b<z->noab()+z->nvab();++p3b) { 
  for (long h2b=0L;h2b<z->noab();++h2b) { 
   for (long p5b=z->noab();p5b<z->noab()+z->nvab();++p5b) { 
    long tileoffset; 
    tileoffset=(p5b-z->noab()+z->nvab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(h6b)))); 
    if (kn[6]->is_this_local(tileoffset)) { 
     if (!z->restricted() || z->get_spin(h6b)+z->get_spin(p3b)+z->get_spin(h2b)+z->get_spin(p5b)!=8L) { 
      if (z->get_spin(h6b)+z->get_spin(p3b)==z->get_spin(h2b)+z->get_spin(p5b)) { 
       if ((z->get_sym(h6b)^(z->get_sym(p3b)^(z->get_sym(h2b)^z->get_sym(p5b))))==(z->irrep_e()^z->irrep_y())) { 
        long dimc=z->get_range(h6b)*z->get_range(p3b)*z->get_range(h2b)*z->get_range(p5b); 
        double* k_c_sort=z->mem()->malloc_local_double(dimc); 
        std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
        for (long h8b=0L;h8b<z->noab();++h8b) { 
         for (long q7b=z->noab()+z->nvab();q7b<z->nab();++q7b) { 
          if (z->get_spin(p3b)+z->get_spin(q7b)==z->get_spin(h2b)+z->get_spin(h8b)) { 
           if ((z->get_sym(p3b)^(z->get_sym(q7b)^(z->get_sym(h2b)^z->get_sym(h8b))))==z->irrep_e()) { 
            long p3b_0,q7b_0,h2b_0,h8b_0; 
            z->restricted_4(p3b,q7b,h2b,h8b,p3b_0,q7b_0,h2b_0,h8b_0); 
            long h6b_1,h8b_1,p5b_1,q7b_1; 
            z->restricted_4(h6b,h8b,p5b,q7b,h6b_1,h8b_1,p5b_1,q7b_1); 
            long dim_common=z->get_range(h8b)*z->get_range(q7b); 
            long dima0_sort=z->get_range(p3b)*z->get_range(h2b); 
            long dima0=dim_common*dima0_sort; 
            long dima1_sort=z->get_range(h6b)*z->get_range(p5b); 
            long dima1=dim_common*dima1_sort; 
            if (dima0>0L && dima1>0L) { 
             double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
             double* k_a0=z->mem()->malloc_local_double(dima0); 
             if (h2b<h8b) { 
              z->qy()->get_block(h8b_0+z->noab()*(h2b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q7b),z->get_range(h2b),z->get_range(h8b),2,0,1,3,+1.0,false); 
             } 
             else if (h8b<=h2b) { 
              z->qy()->get_block(h2b_0+z->noab()*(h8b_0+z->noab()*(q7b_0-z->noab()-z->nvab()+z->ncab()*(p3b_0-z->noab()))),k_a0); 
              z->sort_indices4(k_a0,k_a0_sort,z->get_range(p3b),z->get_range(q7b),z->get_range(h8b),z->get_range(h2b),3,0,1,2,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a0); 
             double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
             double* k_a1=z->mem()->malloc_local_double(dima1); 
             if (h6b<h8b) { 
              z->ly()->get_block(q7b_1-z->noab()-z->nvab()+z->ncab()*(p5b_1-z->noab()+z->nvab()*(h8b_1+z->noab()*(h6b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h6b),z->get_range(h8b),z->get_range(p5b),z->get_range(q7b),2,0,3,1,+1.0,false); 
             } 
             else if (h8b<=h6b) { 
              z->ly()->get_block(q7b_1-z->noab()-z->nvab()+z->ncab()*(p5b_1-z->noab()+z->nvab()*(h6b_1+z->noab()*(h8b_1))),k_a1); 
              z->sort_indices4(k_a1,k_a1_sort,z->get_range(h8b),z->get_range(h6b),z->get_range(p5b),z->get_range(q7b),2,1,3,0,-1.0,false); 
             } 
             z->mem()->free_local_double(k_a1); 
             double factor=1.0; 
             z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
             z->mem()->free_local_double(k_a1_sort); 
             z->mem()->free_local_double(k_a0_sort); 
            } 
           } 
          } 
         } 
        } 
        double* k_c=z->mem()->malloc_local_double(dimc); 
        z->sort_indices4(k_c_sort,k_c,z->get_range(p5b),z->get_range(h6b),z->get_range(h2b),z->get_range(p3b),1,3,2,0,+1.0,false); 
        kn[6]->add_block(p5b-z->noab()+z->nvab()*(h2b+z->noab()*(p3b-z->noab()+z->nvab()*(h6b))),k_c); 
        z->mem()->free_local_double(k_c); 
        z->mem()->free_local_double(k_c_sort); 
       } 
      } 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k7(){ 
      
for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
 for (long q2b=z->noab()+z->nvab();q2b<z->nab();++q2b) { 
  long tileoffset; 
  tileoffset=(q2b-z->noab()-z->nvab()+z->ncab()*(q5b-z->noab()-z->nvab())); 
  if (kn[7]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(q5b)+z->get_spin(q2b)!=4L) { 
    if (z->get_spin(q5b)==z->get_spin(q2b)) { 
     if ((z->get_sym(q5b)^z->get_sym(q2b))==(z->irrep_e()^z->irrep_y())) { 
      long dimc=z->get_range(q5b)*z->get_range(q2b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h7b=0L;h7b<z->noab();++h7b) { 
       for (long h8b=h7b;h8b<z->noab();++h8b) { 
        for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
         if (z->get_spin(q5b)+z->get_spin(q6b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
          if ((z->get_sym(q5b)^(z->get_sym(q6b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_e()) { 
           long q5b_0,q6b_0,h7b_0,h8b_0; 
           z->restricted_4(q5b,q6b,h7b,h8b,q5b_0,q6b_0,h7b_0,h8b_0); 
           long h7b_1,h8b_1,q2b_1,q6b_1; 
           z->restricted_4(h7b,h8b,q2b,q6b,h7b_1,h8b_1,q2b_1,q6b_1); 
           long dim_common=z->get_range(h7b)*z->get_range(h8b)*z->get_range(q6b); 
           long dima0_sort=z->get_range(q5b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (q5b<q6b) { 
             z->qx()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q6b),z->get_range(h7b),z->get_range(h8b),0,1,3,2,+1.0,false); 
            } 
            else if (q6b<=q5b) { 
             z->qx()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q5b),z->get_range(h7b),z->get_range(h8b),1,0,3,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            if (q2b<q6b) { 
             z->lx()->get_block(q6b_1-z->noab()-z->nvab()+z->ncab()*(q2b_1-z->noab()-z->nvab()+z->ncab()*(h8b_1+z->noab()*(h7b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(q2b),z->get_range(q6b),2,3,1,0,+1.0,false); 
            } 
            else if (q6b<=q2b) { 
             z->lx()->get_block(q2b_1-z->noab()-z->nvab()+z->ncab()*(q6b_1-z->noab()-z->nvab()+z->ncab()*(h8b_1+z->noab()*(h7b_1))),k_a1); 
             z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(q6b),z->get_range(q2b),3,2,1,0,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h7b==h8b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(q2b),z->get_range(q5b),1,0,+0.5/0.5,false); 
      kn[7]->add_block(q2b-z->noab()-z->nvab()+z->ncab()*(q5b-z->noab()-z->nvab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k8(){ 
      
for (long q4b=z->noab()+z->nvab();q4b<z->nab();++q4b) { 
 for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
  long tileoffset; 
  tileoffset=(q5b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab())); 
  if (kn[8]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(q4b)+z->get_spin(q5b)!=4L) { 
    if (z->get_spin(q4b)==z->get_spin(q5b)) { 
     if ((z->get_sym(q4b)^z->get_sym(q5b))==(z->irrep_e()^z->irrep_y())) { 
      long dimc=z->get_range(q4b)*z->get_range(q5b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h7b=0L;h7b<z->noab();++h7b) { 
       for (long h8b=h7b;h8b<z->noab();++h8b) { 
        for (long p6b=z->noab();p6b<z->noab()+z->nvab();++p6b) { 
         if (z->get_spin(p6b)+z->get_spin(q4b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
          if ((z->get_sym(p6b)^(z->get_sym(q4b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_e()) { 
           long p6b_0,q4b_0,h7b_0,h8b_0; 
           z->restricted_4(p6b,q4b,h7b,h8b,p6b_0,q4b_0,h7b_0,h8b_0); 
           long h7b_1,h8b_1,p6b_1,q5b_1; 
           z->restricted_4(h7b,h8b,p6b,q5b,h7b_1,h8b_1,p6b_1,q5b_1); 
           long dim_common=z->get_range(h7b)*z->get_range(h8b)*z->get_range(p6b); 
           long dima0_sort=z->get_range(q4b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(q5b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            z->qy()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q4b_0-z->noab()-z->nvab()+z->ncab()*(p6b_0-z->noab()))),k_a0); 
            z->sort_indices4(k_a0,k_a0_sort,z->get_range(p6b),z->get_range(q4b),z->get_range(h7b),z->get_range(h8b),1,0,3,2,+1.0,false); 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            z->ly()->get_block(q5b_1-z->noab()-z->nvab()+z->ncab()*(p6b_1-z->noab()+z->nvab()*(h8b_1+z->noab()*(h7b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(p6b),z->get_range(q5b),3,2,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h7b==h8b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(q5b),z->get_range(q4b),1,0,+0.5/0.5,false); 
      kn[8]->add_block(q5b-z->noab()-z->nvab()+z->ncab()*(q4b-z->noab()-z->nvab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 
  
void LAMBDA_ENERGY::smith_k9(){ 
      
for (long q5b=z->noab()+z->nvab();q5b<z->nab();++q5b) { 
 for (long p2b=z->noab();p2b<z->noab()+z->nvab();++p2b) { 
  long tileoffset; 
  tileoffset=(p2b-z->noab()+z->nvab()*(q5b-z->noab()-z->nvab())); 
  if (kn[9]->is_this_local(tileoffset)) { 
   if (!z->restricted() || z->get_spin(q5b)+z->get_spin(p2b)!=4L) { 
    if (z->get_spin(q5b)==z->get_spin(p2b)) { 
     if ((z->get_sym(q5b)^z->get_sym(p2b))==(z->irrep_e()^z->irrep_y())) { 
      long dimc=z->get_range(q5b)*z->get_range(p2b); 
      double* k_c_sort=z->mem()->malloc_local_double(dimc); 
      std::fill(k_c_sort,k_c_sort+(size_t)dimc,0.0); 
      for (long h7b=0L;h7b<z->noab();++h7b) { 
       for (long h8b=h7b;h8b<z->noab();++h8b) { 
        for (long q6b=z->noab()+z->nvab();q6b<z->nab();++q6b) { 
         if (z->get_spin(q5b)+z->get_spin(q6b)==z->get_spin(h7b)+z->get_spin(h8b)) { 
          if ((z->get_sym(q5b)^(z->get_sym(q6b)^(z->get_sym(h7b)^z->get_sym(h8b))))==z->irrep_e()) { 
           long q5b_0,q6b_0,h7b_0,h8b_0; 
           z->restricted_4(q5b,q6b,h7b,h8b,q5b_0,q6b_0,h7b_0,h8b_0); 
           long h7b_1,h8b_1,p2b_1,q6b_1; 
           z->restricted_4(h7b,h8b,p2b,q6b,h7b_1,h8b_1,p2b_1,q6b_1); 
           long dim_common=z->get_range(h7b)*z->get_range(h8b)*z->get_range(q6b); 
           long dima0_sort=z->get_range(q5b); 
           long dima0=dim_common*dima0_sort; 
           long dima1_sort=z->get_range(p2b); 
           long dima1=dim_common*dima1_sort; 
           if (dima0>0L && dima1>0L) { 
            double* k_a0_sort=z->mem()->malloc_local_double(dima0); 
            double* k_a0=z->mem()->malloc_local_double(dima0); 
            if (q5b<q6b) { 
             z->qx()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q6b_0-z->noab()-z->nvab()+z->ncab()*(q5b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q5b),z->get_range(q6b),z->get_range(h7b),z->get_range(h8b),0,1,3,2,+1.0,false); 
            } 
            else if (q6b<=q5b) { 
             z->qx()->get_block(h8b_0+z->noab()*(h7b_0+z->noab()*(q5b_0-z->noab()-z->nvab()+z->ncab()*(q6b_0-z->noab()-z->nvab()))),k_a0); 
             z->sort_indices4(k_a0,k_a0_sort,z->get_range(q6b),z->get_range(q5b),z->get_range(h7b),z->get_range(h8b),1,0,3,2,-1.0,false); 
            } 
            z->mem()->free_local_double(k_a0); 
            double* k_a1_sort=z->mem()->malloc_local_double(dima1); 
            double* k_a1=z->mem()->malloc_local_double(dima1); 
            z->ly()->get_block(q6b_1-z->noab()-z->nvab()+z->ncab()*(p2b_1-z->noab()+z->nvab()*(h8b_1+z->noab()*(h7b_1))),k_a1); 
            z->sort_indices4(k_a1,k_a1_sort,z->get_range(h7b),z->get_range(h8b),z->get_range(p2b),z->get_range(q6b),2,3,1,0,+1.0,false); 
            z->mem()->free_local_double(k_a1); 
            double factor=1.0; 
            if (h7b==h8b) { 
             factor=factor/2.0; 
            } 
            z->smith_dgemm(dima0_sort,dima1_sort,dim_common,factor,k_a0_sort,dim_common,k_a1_sort,dim_common,1.0,k_c_sort,dima0_sort); 
            z->mem()->free_local_double(k_a1_sort); 
            z->mem()->free_local_double(k_a0_sort); 
           } 
          } 
         } 
        } 
       } 
      } 
      double* k_c=z->mem()->malloc_local_double(dimc); 
      z->sort_indices2(k_c_sort,k_c,z->get_range(p2b),z->get_range(q5b),1,0,+0.5/0.5,false); 
      kn[9]->add_block(p2b-z->noab()+z->nvab()*(q5b-z->noab()-z->nvab()),k_c); 
      z->mem()->free_local_double(k_c); 
      z->mem()->free_local_double(k_c_sort); 
     } 
    } 
   } 
  } 
 } 
} 
z->mem()->sync(); 
} 

